"use strict";(self.webpackChunkwb=self.webpackChunkwb||[]).push([[179],{1547:(e,t,n)=>{var r=n(5893),s=n(745),o=n(7294),a=(n(9701),n(2162),n(8247),n(4877),n(3379)),i=n.n(a),l=n(7795),c=n.n(l),d=n(569),u=n.n(d),h=n(3565),p=n.n(h),x=n(9216),m=n.n(x),g=n(4589),f=n.n(g),j=n(1424),b={};b.styleTagTransform=f(),b.setAttributes=p(),b.insert=u().bind(null,"head"),b.domAPI=c(),b.insertStyleElement=m(),i()(j.Z,b),j.Z&&j.Z.locals&&j.Z.locals;var v=n(9655),y=n(9250),w=n(344),I=n(2433),C=n(2658),k=n(2599);const Z=()=>{const e=nr(),{items:t}=(e=>{const t=(0,y.UO)(),n=(0,y.TH)(),r=(0,y.HJ)(),s=(0,o.useMemo)((()=>r.location?r.location.pathname:n.pathname),[r.location,n.pathname]),a=(0,o.useMemo)((()=>e.map((e=>{var t;const n=null!==(t=e.defaultParams)&&void 0!==t?t:{},r=(0,k.Gn)(e.path,n);return Object.assign(Object.assign({},e),{pattern:e.path,defaultParams:n,path:r})}))),[e]),i=(0,o.useMemo)((()=>a.map((e=>{const n=(0,k.Gn)(e.pattern,Object.assign(Object.assign({},e.defaultParams),t)),r=Boolean((0,k.LX)(n,s));return Object.assign(Object.assign({},e),{active:r})}))),[a,s,r]),l=(0,o.useMemo)((()=>i.map((e=>Object.assign(Object.assign({},e),{previous:e.path===n.pathname})))),[i,s,r]),{activeItem:c,activeIndex:d}=(0,o.useMemo)((()=>{for(let e=0;e<l.length;e++)if(l[e].active)return{activeItem:l[e],activeIndex:e};return{activeItem:null,activeIndex:null}}),[l]);return{items:l,active:c,index:d}})(e);return(0,r.jsx)(w.Z,{container:!0,sx:{backgroundColor:"primary.main",color:"primary.contrastText",px:2},children:t.map((e=>{const t=e.active;return(0,r.jsx)(I.Z,{component:t?"div":v.OL,to:t?void 0:e.path,children:(0,r.jsx)(C.Z,{variant:"inherit",children:e.name})},e.path)}))})};var O=n(3906);const S=()=>(0,r.jsxs)(w.Z,{container:!0,spacing:2,disableEqualOverflow:!0,sx:{flexDirection:"column",flexGrow:1,overflow:"hidden",p:2},children:[(0,r.jsx)(w.Z,{children:(0,r.jsx)(O.Z,{sx:{mx:-2,mt:-2},children:(0,r.jsx)(Z,{})})}),(0,r.jsx)(w.Z,{sx:{display:"flex",flexGrow:1,flexDirection:"column",width:"100%"},children:(0,r.jsx)(y.j3,{})})]}),P=o.memo(S),E=()=>((0,y.lk)(),(0,r.jsxs)(C.Z,{variant:"h6",children:["Что то пошло не так...",(0,r.jsx)(v.OL,{to:"/",children:"На главную"})]}));var T=n(9542);const D=["standard","statistics"],M=D.reduce(((e,t)=>(e[t]=t,e)),{}),B="tokens",q="servers",R=D.reduce(((e,t)=>(e[t]="",e)),{}),G={[M.standard]:"https://suppliers-api.wildberries.ru",[M.statistics]:"https://statistics-api.wildberries.ru"},z=D.reduce(((e,t)=>(e[t]={token:"",server:"",setToken:()=>{},setServer:()=>{},ready:!1},e)),{}),A=o.createContext(z),L=e=>{let{children:t=null}=e;const[n,s]=(0,o.useState)((()=>{const e=(()=>{var e;const t=null!==(e=localStorage.getItem(B))&&void 0!==e?e:"";let n;try{if(n=JSON.parse(t),"object"!=typeof n)throw new Error("invalid storage value")}catch(e){n={}}const r=n;return D.reduce(((e,t)=>{const n=r[t];return e[t]="string"==typeof n?n:R[t],e}),{})})(),t=(()=>{var e;const t=null!==(e=localStorage.getItem(q))&&void 0!==e?e:"";let n;try{if(n=JSON.parse(t),"object"!=typeof n)throw new Error("invalid storage value")}catch(e){n={}}const r=n;return D.reduce(((e,t)=>{const n=r[t];return e[t]="string"==typeof n?n:G[t],e}),{})})();return D.reduce(((n,r)=>(n[r]={token:e[r],server:t[r]},n)),{})})),a=(0,o.useCallback)((e=>t=>n=>{s((r=>r[t][e]===n?r:Object.assign(Object.assign({},r),{[t]:Object.assign(Object.assign({},r[t]),{[e]:n})})))}),[s]),i=(0,o.useMemo)((()=>D.reduce(((e,t)=>(e[t]=""!==n[t].token&&""!==n[t].server,e)),{})),[n]),l=(0,o.useMemo)((()=>D.reduce(((e,t)=>(e[t]=Object.assign(Object.assign({},n[t]),{ready:i[t],setToken:a("token")(t),setServer:a("server")(t)}),e)),{})),[n,i,a]);return(0,o.useEffect)((()=>{const e=D.reduce(((e,t)=>(e[t]=n[t].token,e)),{}),t=D.reduce(((e,t)=>(e[t]=n[t].server,e)),{});(e=>{localStorage.setItem(B,JSON.stringify(e))})(e),(e=>{localStorage.setItem(q,JSON.stringify(e))})(t)}),[n]),(0,r.jsx)(A.Provider,{value:l,children:t})},N=o.memo(L),H=()=>(0,o.useContext)(A),F=()=>{const e=H();return(0,r.jsxs)(w.Z,{container:!0,spacing:2,sx:{flexDirection:"column",justifyContent:"center"},children:[(0,r.jsx)(w.Z,{children:(0,r.jsx)(T.Z,{label:"Api ключ",value:e.standard.token,onChange:t=>{e.standard.setToken(t.target.value)},error:!e.standard.token})}),(0,r.jsx)(w.Z,{children:(0,r.jsx)(T.Z,{label:"Api ключ статистики",value:e.statistics.token,onChange:t=>{e.statistics.setToken(t.target.value)},error:!e.statistics.token})}),(0,r.jsx)(w.Z,{children:(0,r.jsx)(T.Z,{label:"Адрес сервера",value:e.standard.server,onChange:t=>{e.standard.setServer(t.target.value)},error:!e.standard.server})}),(0,r.jsx)(w.Z,{children:(0,r.jsx)(T.Z,{label:"Адрес сервера статистики",value:e.statistics.server,onChange:t=>{e.statistics.setServer(t.target.value)},error:!e.statistics.server})})]})},U=()=>(0,r.jsx)(F,{}),W=o.memo(U),_="cards",J={cards:{fromList:[],byVendorIds:[]},setCards:()=>{},busy:!0,setBusy:()=>{}},Q=o.createContext(J),V=e=>{let{children:t}=e;const[n,s]=(0,o.useState)(!1),[a,i]=(0,o.useState)((()=>{const e=localStorage.getItem(_);if(e)try{return JSON.parse(e)}catch(e){return J.cards}return J.cards})),l=(0,o.useMemo)((()=>({cards:a,setCards:i,busy:n,setBusy:s})),[a,i,n,s]);return(0,o.useEffect)((()=>{localStorage.setItem(_,JSON.stringify(a))}),[a]),(0,r.jsx)(Q.Provider,{value:l,children:t})},X=o.memo(V),$=()=>(0,o.useContext)(Q);var K=n(2574);const Y={data:{headers:{},rows:[]},setData:()=>{}},ee=o.createContext(Y),te=e=>{let{children:t}=e;const[n,s]=(0,o.useState)(Y.data),a=(0,o.useMemo)((()=>({data:n,setData:s})),[n,s]);return(0,r.jsx)(ee.Provider,{value:a,children:t})},ne=o.memo(te),re=()=>(0,o.useContext)(ee),se={wbId:{name:"Артикул WB",toPrintable:e=>e.toString()},supplierId:{name:"Артикул поставщика"},sizeWb:{name:"Размер"},barcode:{name:"Штрихкод"}},oe=e=>{let{cards:t}=e;const{setData:n}=re(),s=(0,o.useCallback)((()=>{const e=t.byVendorIds.reduce(((e,t)=>(e.push(...t.sizes.map((e=>(1!==e.skus.length&&console.error("у товара ".concat(t.vendorCode,"(wbId: ").concat(t.nmID,") у размера ").concat(e.techSize,"(").concat(e.wbSize,") количество штрихкодов ").concat(e.skus.length,"!")),{wbId:t.nmID,supplierId:t.vendorCode,sizeWb:e.techSize,barcode:e.skus.join(",")})))),e)),[]);n({filename:"cards",headers:se,rows:e})}),[t]);return(0,r.jsx)(K.Z,{onClick:s,children:"Заполнить таблицу штрихкодами карточек"})};class ae extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Ошибка сети")}}class ie extends ae{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Таймаут запроса")}}class le extends ae{constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Неспецифический код HTTP ответа"),this.serverResponse=e}}class ce extends le{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Неизвестная ошибка сервера")}}class de extends le{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Неизвестная ошибка запроса")}}class ue extends de{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Некорректный запрос")}}class he extends de{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Пользователь не аутентифицирован")}}class pe extends de{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Доступ запрещен")}}class xe extends de{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Ресурс не найден")}}class me extends ce{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Внутренняя ошибка сервера")}}class ge extends ce{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сервер временно не доступен")}}class fe extends ce{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сервер не отвечает")}}class je extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Ответ сервера имеет неверный формат")}}const be={},ve=(15e3,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Object.assign(Object.assign({},be),t);return new Promise(((t,r)=>{let s=!1;const o=setTimeout((()=>{s=!0,r(new ie)}),15e3);return fetch(e,n).finally((()=>{s||clearTimeout(o)})).then((e=>t(e))).catch((()=>{r(new ae)}))})).then((e=>{if(e.ok&&200===e.status)return e;if(400===e.status)throw new ue(e);if(401===e.status)throw new he(e);if(403===e.status)throw new pe(e);if(404===e.status)throw new xe(e);if(500===e.status)throw new me(e);if(502===e.status)throw new fe(e);if(503===e.status)throw new ge(e);if(e.status>=500)throw new ce(e);if(e.status>=400)throw new de(e);throw new le(e)}))});const ye=e=>{const t={},n=e.split("&");for(let e=0;e<n.length;e++){const r=n[e].split("=");if(r.length>2)throw new Error("invalid query passed for convertQueryToObject");const s=decodeURIComponent(r[0]);2===r.length?t[s]=decodeURIComponent(r[1]):t[s]=""}return t},we=e=>{const t=[],n=Object.keys(e);for(let r=0;r<n.length;r++)t.push(encodeURIComponent(n[r])+"="+encodeURIComponent(e[n[r]]));return t.join("&")},Ie="Authorization",Ce=/(?<=(?:\/|^):)[a-zA-Z0-9]{1,}(?=\/|$)/g,ke=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{url:n,restParameters:r}=Pe(e,t);return Oe(e,((e,t)=>{const s={"Content-type":"application/json"},o=t?Object.assign(Object.assign({},s),{[Ie]:t}):s;return Se(((e,t,n)=>{const r={method:"GET",headers:t};return ve(((e,t)=>{const n=e.split("?");if(n.length>2)throw new Error("invalid uri passed for buildQueryString");let r;r=2===n.length?Object.assign(Object.assign({},ye(n[1])),t):Object.assign({},t);const s=we(r);return s?n[0]+"?"+s:n[0]})(e,n),r)})(e+n,o,r))}))},Ze=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{url:n,restParameters:r}=Pe(e,t);return Oe(e,((e,t)=>{const s={"Content-type":"application/json"},o=t?Object.assign(Object.assign({},s),{[Ie]:t}):s;return Se(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={method:"POST",headers:t,body:JSON.stringify(n)};return ve(e,r)}(e+n,o,r))}))},Oe=(e,t)=>({request:t,endpoint:e}),Se=e=>e.then((e=>e.json().catch((()=>{throw new je})))),Pe=(e,t)=>{var n;const r=null!==(n=e.match(Ce))&&void 0!==n?n:[];r.forEach(((e,t,n)=>{if(n.indexOf(e)!==t)throw new Error("path has more than one parameter :".concat(e))}));const s=Object.assign({},t),o={};for(let e=0;e<r.length;e++){const t=r[e];if(!(t in s))throw new Error("path parameter value for :".concat(t," not found"));const n=s[t];if(delete s[t],"string"!=typeof n&&"number"!=typeof n)throw new Error("path parameter value for :".concat(t," has improper type (").concat(typeof n,")"));o[t]="string"==typeof n?n:n.toString()}return{url:e.split("/").map((e=>{for(let t=0;t<r.length;t++){const n=r[t];if(e===":".concat(n))return o[n]}return e})).join("/"),restParameters:s}},Ee={sort:{cursor:{limit:1e3},filter:{withPhoto:-1}}},Te=()=>Object.assign(Object.assign({},(()=>{const{request:e,endpoint:t}=Ze("/content/v1/cards/cursor/list",Ee);return{request:(t,n)=>e(t,n).then((e=>{if(e.error)throw e;return e})),endpoint:t,client:M.standard}})()),{title:"Получить карточки списком"}),De=e=>{const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return Object.keys(t)},Me=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(e=>{const t=[];for(let n=0;n<e.length;n+=90){const r=e.slice(n,n+90);t.push(r)}return t})(De(t)).map((e=>Be(e)))},Be=e=>Object.assign(Object.assign({},(e=>{const t={allowedCategoriesOnly:!1,vendorCodes:[...e]},{request:n,endpoint:r}=Ze("/content/v1/cards/filter",t);return{request:(e,t)=>n(e,t),endpoint:r,client:M.standard}})(e)),{title:"Получить карточки по артикулам ".concat(e.join(", "))}),qe="ожидает",Re="выполнено",Ge="ошибка",ze=class{constructor(e){this.intervalGenerator=e,this.queue=[],this.timeoutHandler=null}rejectTasksById(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Error("group task fail");const n=this.queue.filter((t=>t.groupId===e)),r=n.length;return n.forEach((e=>{e.task.fail(t)})),this.queue=this.queue.filter((t=>t.groupId!==e)),r}addTask(e,t){let n,r=()=>{};const s=new Promise(((e,t)=>{n=e,r=t}));return this.pushToQueue({task:{run:()=>{n(e())},fail:r},groupId:t}),s.catch((e=>{throw this.rejectTasksById(t),e}))}pushToQueue(){this.queue.length<1&&null===this.timeoutHandler&&setTimeout((()=>{this.runTask()}),100),this.queue.push(...arguments)}runTask(){if(null!==this.timeoutHandler)return;const e=this.queue.shift();e?(e.task.run(),this.timeoutHandler=setTimeout((()=>{this.timeoutHandler=null,this.runTask()}),this.intervalGenerator())):this.timeoutHandler=null}},Ae=class{constructor(e){this.intervalGenerator=e,this.queueMap={}}addTask(e,t,n){return this.ensureQueueMapHasKey(e),this.queueMap[e].addTask(t,n).catch((e=>{throw this.rejectTasksById(n,new Error("group task fail")),e}))}rejectTasksById(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Error("group task fail");return Object.keys(this.queueMap).reduce(((n,r)=>n+this.queueMap[r].rejectTasksById(e,t)),0)}ensureQueueMapHasKey(e){this.queueMap[e]||(this.queueMap[e]=new ze(this.intervalGenerator))}},Le=function*(){let e=0,t=0,n=0;for(;;)yield"".concat((new Date).getTime(),"-").concat(n,"-").concat(t,"-").concat(e),e++,e===Number.MAX_SAFE_INTEGER&&(t++,e=0),t===Number.MAX_SAFE_INTEGER&&(n++,t=0),n===Number.MAX_SAFE_INTEGER&&(n=0)}(),Ne=()=>Le.next().value,He=function*(){for(;;)yield 3e3*Math.random()+2e3}(),Fe={[M.standard]:()=>He.next().value,[M.statistics]:()=>6e4},Ue=[M.standard];var We=n(7582);const _e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";const n=[],r=Object.keys(e);for(let s=0;s<r.length;s++){const o=r[s],a=e[o],i=t,l=(a[i],(0,We._T)(a,["symbol"==typeof i?i:i+""]));n.push(Object.assign(Object.assign({},l),{[t]:o}))}return n},Je={[M.standard]:new Ae(Fe.standard),[M.statistics]:new Ae(Fe.statistics)},Qe={},Ve=new Error("api queue is not ready"),Xe=e=>({queue:[],addTask:e=>Promise.reject(Ve),addTasks:()=>Promise.reject(Ve)}),$e=o.createContext(Xe),Ke=e=>{let{children:t}=e;const n=H(),[s,a]=(0,o.useState)(Qe),i=(0,o.useCallback)(((e,t,n,r,s)=>{a((o=>{const a=Object.assign({},o),i=new Date;return a[e]={component:t,client:n,endpoint:r,created:i,title:s,status:qe,statusDate:i},a}))}),[a]),l=(0,o.useCallback)(((e,t)=>{a((n=>n[e].status===t?n:Object.assign(Object.assign({},n),{[e]:Object.assign(Object.assign({},n[e]),{status:t,statusDate:new Date})})))}),[a]),c=(0,o.useCallback)((e=>function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ne();const s=t.client,o=Ne();i(o,e,s,t.endpoint,t.title);const a=-1===Ue.indexOf(s)?t.endpoint:"";return Je[t.client].addTask(a,(()=>t.request(n[s].server,n[s].token)),r).catch((e=>{throw D.forEach((e=>Je[e].rejectTasksById(r))),l(o,Ge),e})).then((e=>(l(o,Re),e)))}),[n,Ne,a]),d=(0,o.useCallback)((e=>function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ne();const r=t.map((t=>c(e)(t,n)));return Promise.all(r)}),[c,Ne]),u=(0,o.useCallback)((e=>({queue:_e(s),addTask:c(e),addTasks:d(e)})),[s,c,d]);return(0,r.jsx)($e.Provider,{value:u,children:t})},Ye=o.memo(Ke),et=e=>(0,o.useContext)($e)(e),tt=e=>{const t=e.reduce(((e,t)=>(e[t.vendorCode]=t,e)),{}),n=[],r=Object.keys(t);for(let e=0;e<r.length;e++)n.push(t[r[e]]);return n},nt=e=>{let{apiClientIsReady:t}=e;const{setCards:n,busy:s,setBusy:a}=$(),{queue:i,addTask:l,addTasks:c}=et("cards"),d=(0,o.useCallback)((()=>new Promise(((e,t)=>{const n=Te();l(n).then((n=>{const r=n.data.cards,s=r.map((e=>e.vendorCode)),o=Me(...s);c(o).then((t=>{const n=t.reduce(((e,t)=>(e.push(...t.data),e)),[]);e({fromList:r,byVendorIds:tt(n)})})).catch((e=>{t(e)}))})).catch((e=>{t(e)}))}))),[Te,Me,l,c,tt]),u=(0,o.useCallback)((()=>{Te(),a(!0),d().finally((()=>{a(!1)})).then((e=>{n(e)}))}),[n]),h=!t,{secondsLeft:p}=((e,t)=>{if(e.filter((e=>e.component===t&&e.status===qe)).length<1)return{busy:!1,secondsLeft:0};const n=D.reduce(((n,r)=>{let s=0;for(let e=0;e<50;e++)s+=Fe[r]();s/=50;const o=e.filter((e=>e.client===r&&e.status===qe));if(-1!==Ue.indexOf(r)){for(let e=0;e<o.length;e++)if(o[e].component===t)return n[r]={interval:s,tasksCount:o.length-e},n;return n[r]={interval:s,tasksCount:0},n}const a=o.filter((e=>e.component===t)).reduce(((e,t)=>(e[t.endpoint]=t.endpoint,e)),{}),i=Object.keys(a).reduce(((e,n)=>{const r=o.filter((e=>e.endpoint===n));let s=0;for(let e=0;e<r.length;e++)if(o[e].component===t){s=r.length-e;break}return s>e?s:e}),0);return n[r]={interval:s,tasksCount:i},n}),{}),r=D.reduce(((e,t)=>{const r=n[t].interval*n[t].tasksCount;return r>e?r:e}),0);return{busy:!0,secondsLeft:Math.round(r/1e3)}})(i,"cards");return(0,r.jsxs)(r.Fragment,{children:[JSON.stringify(p),(0,r.jsx)(K.Z,{onClick:u,disabled:h||s,children:"загрузить карточки"})]})},rt=e=>{let{apiClientIsReady:t}=e;const{cards:n}=$();return(0,r.jsxs)(w.Z,{container:!0,spacing:2,sx:{flexDirection:"column",justifyContent:"center"},children:[(0,r.jsxs)(w.Z,{container:!0,spacing:2,columns:2,sx:{alignItems:"end"},children:[(0,r.jsx)(w.Z,{xs:1,children:(0,r.jsx)(T.Z,{label:"Карточек в списке",value:n.fromList.length})}),(0,r.jsx)(w.Z,{xs:1,children:(0,r.jsx)(T.Z,{label:"Карточек по коду поставщика",value:n.byVendorIds.length})})]}),(0,r.jsx)(w.Z,{children:(0,r.jsx)(nt,{apiClientIsReady:t})}),(0,r.jsx)(w.Z,{children:(0,r.jsx)(oe,{cards:n})})]})},st=()=>{const{standard:e}=H();return(0,r.jsx)(rt,{apiClientIsReady:e.ready})},ot=o.memo(st),at="supplies",it={},lt={supplies:it,setSupplies:()=>{},clearSupplies:()=>{},removeSupplies:()=>{},busy:!0,setBusy:()=>{}},ct=o.createContext(lt),dt=e=>{let{children:t}=e;const[n,s]=(0,o.useState)(!1),[a,i]=(0,o.useState)((()=>{const e=localStorage.getItem(at);if(e)try{return JSON.parse(e)}catch(e){return lt.supplies}return lt.supplies})),l=(0,o.useCallback)((()=>{i(it)}),[i]),c=(0,o.useCallback)((e=>{i((t=>{const n=Object.assign({},t);let r=!1;for(let t=0;t<e.length;t++){const s=e[t];n[s]&&(delete n[s],r=!0)}return r?n:t}))}),[i]),d=(0,o.useCallback)((e=>{i((t=>{const n=Object.assign({},t);return e.forEach((e=>{n[e.id]=e})),n}))}),[i]),u=(0,o.useMemo)((()=>({supplies:a,setSupplies:d,clearSupplies:l,removeSupplies:c,busy:n,setBusy:s})),[a,d,l,c,n,s]);return(0,o.useEffect)((()=>{localStorage.setItem(at,JSON.stringify(a))}),[a]),(0,r.jsx)(ct.Provider,{value:u,children:t})},ut=o.memo(dt),ht=()=>(0,o.useContext)(ct);var pt=n(4680),xt=n(2440),mt=n(576),gt=n(6867),ft=n(8619),jt=n(8885),bt=n(2887),vt=n(9334);const yt=e=>{const t=new Date(e);return"".concat(t.toLocaleTimeString()," ").concat(t.toLocaleDateString())},wt=e=>{const t=e.reduce(((e,t)=>(e[t.toISOString()]=t,e)),{}),n=[],r=Object.keys(t);for(let e=0;e<r.length;e++)n.push(t[r[e]]);return n};var It=n(594),Ct=n(4295),kt=n.n(Ct);const Zt=/^[^./\\]{1,}$/,Ot=/^[^./\\]{1,}\.xlsx$/i,St=e=>{const t=[],n=Object.keys(e);for(let r=0;r<n.length;r++)t.push(Object.assign({id:n[r]},e[n[r]]));return t.sort(((e,t)=>{var n,r,s,o;const a=null!==(n=e.order)&&void 0!==n?n:0,i=null!==(r=t.order)&&void 0!==r?r:0;return null!==(s=null!=a?a:0<i)&&void 0!==s&&s?1:null!==(o=null!=a?a:0>i)&&void 0!==o&&o||e.name<t.name?-1:t.name<e.name?1:0})),t.map((e=>e.id))},Pt=e=>{var t;const{filename:n="без_имени",headers:r,rows:s}=e,o=St(r),a=new(kt().Workbook),i=a.addWorksheet("Лист 1"),l={style:"thin",color:"black"};i.columns=o.map((e=>({key:e,header:r[e].name,width:-1}))),i.getRow(1).eachCell((e=>{e.style={border:{top:l,left:l,right:l,bottom:l},alignment:{vertical:"middle",horizontal:"center",wrapText:!0},font:{bold:!0}}})),i.addRows(s.map((e=>{const t={};for(let n=0;n<o.length;n++){const s=o[n],a=r[s];t[s]=a.toExcel?a.toExcel(e[s]):e[s]}return t})));const c={};for(let e=0;e<o.length;e++)c[o[e]]=null!==(t=r[o[e]].width)&&void 0!==t?t:"auto";return Mt(i,c),((e,t)=>{let n=t;return n.match(Zt)||n.match(Ot)||(n="invalid_file_name"),n.match(Zt)&&(n+=".xlsx"),e.writeBuffer().then((e=>{const t=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=document.createElement("a");return r.href=URL.createObjectURL(t),r.download=n,r.click(),URL.revokeObjectURL(r.href),!0}))})(a.xlsx,n)},Et=Pt,Tt=new ze((()=>1e3)),Dt=e=>Tt.addTask((()=>Pt(e)),Ne()),Mt=(e,t)=>{e.columns.forEach((e=>{const n=t[e.key];if("auto"!==n)return void(e.width=n);const r=e.values.map((e=>e.toString().length)),s=Math.max(...r.filter((e=>"number"==typeof e)));e.width=s+6}))},Bt=new Error("exporter is not ready"),qt={exportNow:()=>Promise.reject(Bt),exportEnqueue:()=>Promise.reject(Bt)},Rt=o.createContext(qt),Gt=e=>{let{children:t}=e;const n=(0,o.useMemo)((()=>({exportNow:Et,exportEnqueue:Dt})),[Et,Dt]);return(0,r.jsx)(Rt.Provider,{value:n,children:t})},zt=o.memo(Gt),At=()=>(0,o.useContext)(Rt),Lt={orderId:{name:"№ задания",order:0,toPrintable:e=>String(e)},supplyId:{name:"QR-код поставки",order:10},sticker:{name:"Стикер",order:15},supplyName:{name:"Название поставки",order:20},orderDate:{name:"Дата создания",order:30,toPrintable:yt,toExcel:yt},supplyBarcodeScanDate:{name:"Дата сканирования ШК ТТН",order:40,toPrintable:yt,toExcel:yt},name:{name:"Наименование",order:50},sizeTech:{name:"Размер",order:60},color:{name:"Цает",order:70},price:{name:"Стоимость",order:72,toPrintable:e=>(e/100).toFixed(2),toExcel:e=>Number((e/100).toFixed(2))},currency:{name:"Валюта",order:74,toPrintable:e=>643===e?"₽":"?",toExcel:e=>643===e?"₽":"?"},wbId:{name:"Артикул Wildberries",order:80,toPrintable:e=>String(e)},supplierId:{name:"Артикул продавца",order:90},srid:{name:"Srid",order:100}},Nt=()=>{const{supplies:e,removeSupplies:t}=ht(),{exportEnqueue:n}=At(),s=(0,o.useMemo)((()=>{const t=Object.keys(e);return t.sort(),t}),[e]),{setData:a}=re(),{cards:i}=$(),[l,c]=o.useState([]),d=(0,o.useMemo)((()=>l.map((t=>e[t]))),[e,l]),u=(0,o.useCallback)((e=>()=>{c((t=>{const n=t.indexOf(e),r=[...t];return-1===n?r.push(e):r.splice(n,1),r}))}),[]),h=(0,o.useMemo)((()=>s.length>0&&s.every((e=>l.indexOf(e)>-1))),[s,l]);return(0,o.useEffect)((()=>{c((e=>e.filter((e=>s.indexOf(e)>-1))))}),[s]),(0,r.jsxs)(w.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1,flexWrap:"nowrap"},children:[(0,r.jsx)(w.Z,{sx:{display:"flex",flexGrow:1,height:"auto",maxHeight:"10rem"},children:(0,r.jsx)(pt.Z,{variant:"outlined",sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:(0,r.jsxs)(xt.Z,{sx:{width:"100%",height:"100%",overflow:"auto",position:"relative",pt:0},children:[(0,r.jsx)(mt.ZP,{disablePadding:!0,sx:{position:"sticky",top:0,zIndex:1,bgcolor:"background.paper",py:.5,borderBottom:e=>"1px solid ".concat(e.palette.divider)},secondaryAction:(0,r.jsx)(gt.Z,{edge:"end",disabled:l.length<1,color:"error",onClick:()=>{t(l)},children:(0,r.jsx)(It.Z,{})}),children:(0,r.jsxs)(ft.Z,{role:void 0,onClick:()=>{c(h?[]:s)},dense:!0,sx:{py:.5,my:-.5},children:[(0,r.jsx)(jt.Z,{children:(0,r.jsx)(bt.Z,{edge:"start",checked:h,disabled:s.length<1,indeterminate:l.length>0&&!h,tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":"all"},sx:{py:0}})}),(0,r.jsx)(vt.Z,{id:"all",primary:"Все"})]})}),s.map((e=>{const t="checkbox-list-label-".concat(e);return(0,r.jsx)(mt.ZP,{disablePadding:!0,children:(0,r.jsxs)(ft.Z,{role:void 0,onClick:u(e),dense:!0,sx:{py:0},children:[(0,r.jsx)(jt.Z,{children:(0,r.jsx)(bt.Z,{edge:"start",checked:-1!==l.indexOf(e),tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":t},sx:{py:0}})}),(0,r.jsx)(vt.Z,{id:t,primary:e})]})},e)}))]})})}),(0,r.jsxs)(w.Z,{container:!0,children:[(0,r.jsx)(w.Z,{sx:{flexGrow:1},children:(0,r.jsx)(K.Z,{disabled:l.length<1,onClick:()=>{let e;1===d.length&&(e="Данные о поставке ".concat(d[0].id)),d.length>1&&(e="Данные о поставках ".concat(d.map((e=>e.id)).join(","))),a({filename:e,headers:Lt,rows:Ht(d,i)})},children:"в таблицу"})}),(0,r.jsx)(w.Z,{sx:{flexGrow:1},children:(0,r.jsx)(K.Z,{disabled:l.length<1,onClick:()=>{d.forEach((e=>{n({filename:"Данные о поставке ".concat(e.id),headers:Lt,rows:Ht([e],i)}).catch((e=>{console.error(e)}))}))},children:"экспорт по файлам"})})]})]})},Ht=(e,t)=>{const n=e.reduce(((e,n)=>(e.push(...n.orders.map((e=>{const r=t.fromList.filter((t=>t.nmID===e.supply.nmId));if(1!==r.length)throw console.error(r),new Error("error getting card from list: supplierId: ".concat(e.supply.article,", wbId: ").concat(e.supply.nmId));const s=r[0],o=t.byVendorIds.filter((t=>t.nmID===e.supply.nmId));if(1!==o.length)throw console.error(o),new Error("error getting card by vendor id: supplierId: ".concat(e.supply.article,", wbId: ").concat(e.supply.nmId));const a=o[0],i=s.sizes.filter((t=>t.chrtID===e.supply.chrtId));if(1!==i.length)throw console.error(i),new Error("error getting size of card from list: supplierId: ".concat(e.supply.article,", wbId: ").concat(e.supply.nmId,", chrtId: ").concat(e.supply.chrtId));const l=i[0],c=a.sizes.filter((t=>t.chrtID===e.supply.chrtId));if(1!==c.length)throw console.error(c),new Error("error getting size of card from list: supplierId: ".concat(e.supply.article,", wbId: ").concat(e.supply.nmId,", chrtId: ").concat(e.supply.chrtId));const d=a.characteristics.filter((e=>"Наименование"in e)),u=d[0]?d[0]["Наименование"]:"",h=a.characteristics.filter((e=>"Цвет"in e)),p=h[0]?h[0]["Цвет"].join(", "):"";return{supplyId:n.id,supplyName:n.name,supplyBarcodeScanDate:n.scanDt,orderDate:e.supply.createdAt,orderId:e.supply.id,price:e.supply.convertedPrice,currency:e.supply.convertedCurrencyCode,supplierId:e.supply.article,wbId:e.supply.nmId,name:u,color:p,sizeTech:l.techSize,sticker:e.statistics.sticker,srid:e.statistics.srid}}))),e)),[]);return n.sort(((e,t)=>e.supplyId<t.supplyId?-1:e.supplyId>t.supplyId||e.orderId<t.orderId?1:e.orderId>t.orderId?-1:0)),n},Ft=/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/,Ut=e=>Object.assign(Object.assign({},(e=>{const t=new Date(e.toISOString());t.setUTCHours(0,0,0,0);const n=t.toISOString().split("T")[0];if(!n.match(Ft))throw new Error("invalid date for order request");const{request:r,endpoint:s}=ke("/api/v1/supplier/orders",{dateFrom:n,flag:"1"});return{request:(e,t)=>r(e,t),endpoint:s,client:M.statistics}})(e)),{title:"Получить заказы из статистики за ".concat(e.toISOString().split("T")[0])}),Wt=e=>Object.assign(Object.assign({},(e=>{const{request:t,endpoint:n}=ke("/api/v3/supplies/:supplyId",{supplyId:e});return{request:(e,n)=>t(e,n),endpoint:n,client:M.standard}})(e)),{title:"Загрузить данные поствки ".concat(e)}),_t=e=>Object.assign(Object.assign({},(e=>{const{request:t,endpoint:n}=ke("/api/v3/supplies/:supplyId/orders",{supplyId:e});return{request:(e,n)=>t(e,n),endpoint:n,client:M.standard}})(e)),{title:"Получить заказы по поствке ".concat(e)}),Jt=/(WB-GI-[0-9]{5,})/g,Qt=e=>{var t;return null!==(t=e.match(Jt))&&void 0!==t?t:[]},Vt=e=>{let{apiClientIsReady:t,apiStatisticsClientIsReady:n}=e;const{setSupplies:s,busy:a,setBusy:i}=ht(),[l,c]=(0,o.useState)(""),d=(0,o.useMemo)((()=>De(Qt(l))),[l,Qt]),u=!t||!n,{addTask:h,addTasks:p}=et("supply"),x=(0,o.useCallback)(((e,t)=>e?new Promise(((n,r)=>{const s=[Wt(e),_t(e)];p(s,t).then((e=>{let[t,r]=e;n(Object.assign(Object.assign({},t),{orders:r.orders}))})).catch((e=>{r(e)}))})):Promise.reject(new Error("no supply id passed"))),[Wt,_t,p]),m=(0,o.useCallback)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length<1)return Promise.resolve([]);const r=Ne();return Promise.all(De(t).map((e=>x(e,r).catch((t=>(console.error("не удалось загрузить поствку ".concat(e,", причина:"),t),null)))))).then((e=>e.filter((e=>null!==e))))}),[Ne,De,x]),g=(0,o.useCallback)((e=>{const t=Ne(),n=e.map((e=>h(Ut(e),t).catch((t=>(console.error("не удалось загрузить заказы из статистики на дату ".concat(e.toISOString(),", причина:"),t),null)))));return Promise.all(n).then((e=>e.reduce(((e,t)=>(null!==t&&e.push(...t),e)),[])))}),[Ne,h,Ut]);return(0,r.jsxs)(w.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1},children:[(0,r.jsxs)(w.Z,{container:!0,sx:{flexGrow:1},children:[(0,r.jsx)(w.Z,{sx:{display:"flex",flexGrow:1},children:(0,r.jsx)(T.Z,{label:"ID поставки",multiline:!0,value:l,onChange:e=>{c(e.target.value)},sx:{"& .MuiInputBase-multiline":{height:"100%",overflow:"auto","& textarea":{height:"100% !important",overflow:"visible !important"}}}})}),(0,r.jsx)(w.Z,{sx:{display:"flex",flexGrow:1},children:(0,r.jsx)(T.Z,{label:"ID поставки обработанные",multiline:!0,value:d.join("\r\n"),sx:{"& .MuiInputBase-multiline":{height:"100%",overflow:"auto","& textarea":{height:"100% !important",overflow:"visible !important"}}}})})]}),(0,r.jsx)(w.Z,{children:(0,r.jsx)(K.Z,{onClick:()=>{i(!0),m(...d).then((e=>{if(e.length<1)throw new Error("ни одной поставки не загружено");const t=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>{const n=t.orders.map((e=>e.createdAt)).map((e=>{const t=new Date(e);return t.setUTCHours(0,0,0,0),t})),r=wt(n).reduce(((e,t)=>{const n=new Date(t.toISOString());n.setUTCDate(n.getUTCDate()-1);const r=new Date(t.toISOString());return r.setUTCDate(r.getUTCDate()+1),e.push(t),e.push(n),e.push(r),e}),[]);return e.push(...r),e}),[]);return wt(r)}(...e).filter((e=>!isNaN(e.getTime())));if(t.length<1)throw new Error("ни одной даты заказа не получено");g(t).finally((()=>{i(!1)})).then((t=>{s(e.reduce(((e,n)=>{const r=[];for(let s=0;s<n.orders.length;s++){const o=n.orders[s],a=t.filter((e=>e.srid===o.rid));if(a.length<1)return console.error("заказ из раздела статистики не неайден"),e;if(a.length>1)return console.error("соответствующих заказов из раздела статистики более одного:",a),e;const i=a[0];r.push({supply:o,statistics:i})}return e.push(Object.assign(Object.assign({},n),{orders:r})),e}),[]))})).catch((e=>{console.error(e)}))})).catch((e=>{console.error("ошибка загрузки данных поставок, причина:",e),i(!1)}))},disabled:u||a||d.length<1,children:"загрузить данные о поставке"})})]})},Xt=[],$t={supplies:Xt,setSupplies:()=>{},busy:!0,setBusy:()=>{}},Kt=o.createContext($t),Yt=e=>{let{children:t}=e;const[n,s]=(0,o.useState)(!1),[a,i]=(0,o.useState)(Xt),l=(0,o.useMemo)((()=>({supplies:a,setSupplies:i,busy:n,setBusy:s})),[a,i,n,s]);return(0,r.jsx)(Kt.Provider,{value:l,children:t})},en=o.memo(Yt),tn=()=>(0,o.useContext)(Kt),nn=function(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0).then((n=>{const r=[...t,n];return 0!==n.next?nn(e,n.next,r):Promise.resolve(r)}))},rn=e=>{let{apiClientIsReady:t}=e;const{supplies:n,setSupplies:s,busy:a,setBusy:i}=tn(),{addTask:l}=et("supplies"),c=(0,o.useCallback)((function(){return l(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object.assign(Object.assign({},function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{request:t,endpoint:n}=ke("/api/v3/supplies",{limit:String(1e3),next:e.toString()});return{request:(e,n)=>t(e,n),endpoint:n,client:M.standard}}(e)),{title:"Получить все поставки (next=".concat(e,")")})}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))}),[l]);return(0,r.jsxs)(w.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1},children:[(0,r.jsx)(w.Z,{sx:{display:"flex"},children:(0,r.jsx)(T.Z,{label:"Загружено поставок",value:n.length})}),(0,r.jsx)(w.Z,{sx:{display:"flex",flexGrow:1},children:(0,r.jsx)(K.Z,{onClick:()=>{i(!0),nn(c).finally((()=>{i(!1)})).then((e=>{s(e.reduce(((e,t)=>(e.push(...t.supplies),e)),[]))})).catch((e=>{console.error(e)}))},disabled:!t||a,children:"Загрузить поставки"})})]})},sn=["признак отсутствует","обычная","СГТ (Содержит сверхгабаритные товары)","КГТ (Содержит крупногабаритные товары). Не используется на данный момент"],on={id:{name:"QR-код поставки",order:0},name:{name:"Наименование",order:10},createdAt:{name:"Дата создания",order:20,toPrintable:yt,toExcel:yt},closedAt:{name:"Дата закрытия",order:30,toPrintable:yt,toExcel:yt},scanDt:{name:"Дата сканирования ШК ТТН",order:40,toPrintable:yt,toExcel:yt},scanDtDate:{name:"Дата сканирования ШК ТТН",order:40,toPrintable:yt,toExcel:e=>new Date(e),width:15},done:{name:"Завершена",order:50,toPrintable:e=>e?"ИСТИНА":"ЛОЖЬ",toExcel:e=>e?"ИСТИНА":"ЛОЖЬ"},cargoType:{name:"Тип поставки",order:60,toPrintable:e=>sn[e],toExcel:e=>sn[e]}},an=()=>{const{supplies:e}=tn(),{setData:t}=re();return(0,r.jsx)(K.Z,{onClick:()=>{const n=e.map((e=>Object.assign(Object.assign({},e),{scanDtDate:e.scanDt})));n.sort(((e,t)=>{const n=new Date(e.createdAt),r=new Date(t.createdAt);return n<r?-1:n>r?1:0})),t({filename:"Список поставок",headers:on,rows:n})},children:"в таблицу"})},ln=e=>{let{apiClientIsReady:t,apiStatisticsClientIsReady:n}=e;return(0,r.jsxs)(w.Z,{container:!0,spacing:2,children:[(0,r.jsxs)(w.Z,{container:!0,sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[(0,r.jsx)(w.Z,{sx:{display:"flex",flexGrow:1},children:(0,r.jsx)(rn,{apiClientIsReady:t})}),(0,r.jsx)(w.Z,{sx:{display:"flex",flexGrow:1},children:(0,r.jsx)(an,{})})]}),(0,r.jsx)(w.Z,{sx:{display:"flex",flexGrow:1},children:(0,r.jsx)(Vt,{apiClientIsReady:t,apiStatisticsClientIsReady:n})}),(0,r.jsx)(w.Z,{sx:{display:"flex",flexGrow:1},children:(0,r.jsx)(Nt,{})})]})},cn=()=>{const e=H();return(0,r.jsx)(ln,{apiClientIsReady:e.standard.ready,apiStatisticsClientIsReady:e.statistics.ready})},dn=o.memo(cn);var un=n(7896),hn=n(9573),pn=n(6011),xn=n(3694),mn=n(6926),gn=n(8732),fn=n(3863),jn=n(268);const bn=[{label:"25",value:25},{label:"100",value:100},{label:"250",value:250},{label:"Все",value:-1}],vn=e=>{let{data:t,orderedColumnIds:n}=e;const[s,a]=o.useState(0),[i,l]=o.useState(25),c=(0,o.useCallback)(((e,t)=>{a(t-1)}),[a]),d=(0,o.useCallback)((e=>{l(+e.target.value),a(0)}),[l,a]),{headers:u,rows:h}=t;(0,o.useEffect)((()=>{a(0)}),[t]);const p=-1===i?h.length:i,x=Math.ceil(h.length/p),m=x>0?x-1:0,g=s>m?m:s,f=g+1;return(0,r.jsxs)(w.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1,width:"100%"},children:[(0,r.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%"},children:(0,r.jsx)(pt.Z,{variant:"outlined",sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:(0,r.jsx)(un.Z,{sx:{flexGrow:1,flexShrink:1,flexBasis:"10rem",height:"100%",width:"100%",position:"relative"},children:(0,r.jsxs)(hn.Z,{stickyHeader:!0,size:"small",sx:{width:"100%"},children:[(0,r.jsx)(pn.Z,{children:(0,r.jsxs)(xn.Z,{children:[(0,r.jsx)(mn.Z,{align:"right",children:"№"}),n.map((e=>(0,r.jsx)(mn.Z,{align:u[e].align,children:u[e].name},e)))]})}),(0,r.jsx)(gn.Z,{children:h.slice(g*p,g*p+p).map(((e,t)=>(0,r.jsxs)(xn.Z,{hover:!0,children:[(0,r.jsx)(mn.Z,{align:"right",children:t+g*p+1}),n.map((n=>{const s=u[n],o=s.toPrintable?s.toPrintable(e[n]):e[n];return(0,r.jsx)(mn.Z,{align:s.align,children:o},String(t)+n)}))]},t)))})]})})})}),(0,r.jsx)(w.Z,{sx:{flexGrow:0,width:"100%"},children:(0,r.jsx)(fn.Z,{rowsPerPageOptions:bn,component:"div",count:h.length,rowsPerPage:i,page:g,onPageChange:c,onRowsPerPageChange:d,labelRowsPerPage:"Показывать:",labelDisplayedRows:e=>{let{from:t,to:n,count:r}=e;return"".concat(t," - ").concat(n," из ").concat(-1!==r?r:">".concat(n))},ActionsComponent:e=>{const{page:t,count:n,rowsPerPage:s,showLastButton:o,getItemAriaLabel:a,showFirstButton:i,onPageChange:l}=e;return(0,We._T)(e,["page","count","rowsPerPage","showLastButton","getItemAriaLabel","showFirstButton","onPageChange"]),(0,r.jsx)(jn.Z,{siblingCount:2,boundaryCount:1,count:x,page:f,onChange:c,sx:{"& ul":{display:"flex",flexWrap:"nowrap"}}})}})})]})},yn=e=>{let{data:t}=e;const{exportEnqueue:n}=At();return(0,r.jsx)(K.Z,{onClick:()=>{n(t)},children:"выгрузить в excel"})},wn=e=>{let{data:t}=e;const{headers:n}=t,s=(0,o.useMemo)((()=>St(n)),[n]);return(0,r.jsxs)(w.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1},children:[(0,r.jsx)(w.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1,width:"100%"},children:(0,r.jsx)(vn,{data:t,orderedColumnIds:s})}),(0,r.jsx)(w.Z,{children:(0,r.jsx)(yn,{data:t})})]})},In=()=>{const{data:e}=re();return(0,r.jsx)(wn,{data:e})},Cn=()=>(0,r.jsxs)(w.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1},children:[(0,r.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column"},children:(0,r.jsx)(y.j3,{})}),(0,r.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:"100%"},children:(0,r.jsx)(In,{})})]}),kn=o.memo(Cn);var Zn=n(3718);const On=e=>{let{text:t}=e;const n=(()=>{const e=(0,o.useRef)(!1);return(0,o.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[e]),e})(),[s,a]=((e,t)=>{const[n,r]=(0,o.useState)(!1),s=(0,o.useCallback)((e=>{t.current&&r(e)}),[t,r]);return[n,s]})(0,n),i=(0,o.useRef)(null);return t.length<=150?(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Zn.Z,{open:s,placement:"bottom",anchorEl:i.current,disablePortal:!0,modifiers:[{name:"flip",enabled:!1,options:{altBoundary:!0,rootBoundary:"document",padding:8}},{name:"preventOverflow",enabled:!0,options:{altAxis:!0,altBoundary:!0,tether:!1,rootBoundary:"document",padding:8}}],sx:{zIndex:10,width:"600px",minWidth:"50%",maxWidth:"80%",height:"250px",maxHeight:"80%",minHeight:"10%"},onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)},children:(0,r.jsx)(pt.Z,{sx:{p:2,width:"100%",height:"100%"},children:(0,r.jsx)(T.Z,{multiline:!0,rows:1,fullWidth:!0,value:t,sx:{height:"100%","& .MuiInputBase-multiline":{height:"100%",overflow:"auto","& textarea":{height:"100% !important",overflow:"visible !important"}}}})})}),(0,r.jsx)(O.Z,{ref:i,sx:{mx:-2,my:-.75,px:2,py:.75},onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)},children:t.substring(0,150)+"..."})]})},Sn=o.memo(On);var Pn=n(9062),En=n(888),Tn=n(9572);const Dn={[qe]:(0,r.jsx)(Pn.Z,{size:"1.2rem"}),[Re]:(0,r.jsx)(En.Z,{color:"success"}),[Ge]:(0,r.jsx)(Tn.Z,{color:"error"})},Mn=e=>{let{status:t}=e;return(0,r.jsx)(O.Z,{sx:{display:"flex",flexDirection:"column",minHeight:"1.5rem",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},children:(0,r.jsx)(O.Z,{sx:{height:"1.5rem",width:"1.5rem",display:"flex",justifyContent:"center",alignItems:"center"},children:Dn[t]})})},Bn=o.memo(Mn),qn={[M.standard]:"стандартное",[M.statistics]:"статистика"},Rn={created:{order:0,name:"Дата создания",align:"center",width:15,toPrintable:e=>e.toLocaleString()},status:{order:10,name:"Статус",align:"center",toPrintable:e=>(0,r.jsx)(Bn,{status:e})},statusDate:{order:20,name:"Дата статуса",align:"center",width:15,toPrintable:e=>e.toLocaleString()},title:{order:30,name:"Задача",width:50,toPrintable:e=>(0,r.jsx)(Sn,{text:e})},component:{order:40,name:"Запрошено компонентом",align:"center",toPrintable:e=>null!=e?e:""},client:{order:50,name:"Тип API",align:"center",toPrintable:e=>qn[e],toExcel:e=>qn[e]},endpoint:{order:60,name:"URL"}},Gn=()=>{const{queue:e}=et(),t=(0,o.useMemo)((()=>{const t=[...e];return t.sort(((e,t)=>t.created.getTime()-e.created.getTime()||(e.id<t.id?1:e.id>t.id?-1:0))),t}),[e]),n=(0,o.useMemo)((()=>({filename:"apiTasks",headers:Rn,rows:t})),[t,Rn]);return(0,r.jsx)(wn,{data:n})},zn=o.memo(Gn),An=()=>(0,r.jsx)(zn,{}),Ln=o.memo(An),Nn=[{path:"/",Component:P,ErrorBoundary:E,children:[{ErrorBoundary:E,children:[{index:!0,element:(0,r.jsx)(y.Fg,{to:"/supply"})},{Component:kn,children:[{name:"Карточки",order:2,path:"cards",Component:ot},{name:"Поставки",order:1,path:"supply",Component:dn}]},{path:"api",children:[{name:"Настройки",order:998,path:"config",Component:W},{name:"Статус",order:999,path:"status",Component:Ln}]},{path:"*",Component:()=>(0,r.jsxs)(C.Z,{variant:"h6",children:["Такой страницы не существует",(0,r.jsx)(v.OL,{to:"/",children:"На главную"})]})}]}]}],Hn=Object.keys({caseSensitive:"caseSensitive",path:"path",id:"id",loader:"loader",action:"action",hasErrorBoundary:"hasErrorBoundary",shouldRevalidate:"shouldRevalidate",handle:"handle",index:"index",children:"children",element:"element",errorElement:"errorElement",Component:"Component",ErrorBoundary:"ErrorBoundary",lazy:"lazy"}),Fn=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.reduce(((e,n)=>{var r;const s=null!==(r=n.path)&&void 0!==r?r:"",o="/"===s.substring(0,1)?s:"/"===t.substring(t.length-1)?t+s:t+"/"+s,a=Object.keys(n),i={};let l=!1;for(let e=0;e<a.length;e++)Hn.indexOf(a[e])<0&&(i[a[e]]=n[a[e]],l=!0);if(l&&(i.path=o,e.push(i)),n.children){const t=Fn(n.children,o);t.length&&e.push(...t)}return e}),[])},Un=e=>{var t;const n={};for(let r=0;r<e.length;r++){const s=null!==(t=e[r].menuId)&&void 0!==t?t:e[r].path;if(n[s])throw new Error('duplicate menu item id "'+s+'" found!');n[s]=e[r]}for(const e in n){if(!Object.hasOwn(n,e))continue;const t=n[e].parentId;if(t){if(t==e)throw new Error('circular reference id to parent id "'+t+'" found in menu');if(!n[t])throw new Error('no parent id "'+t+'" found in menu');const r=n[t];r.children||(r.children=[]),r.children.push(n[e])}}const r=[];for(const e in n)Object.hasOwn(n,e)&&(n[e].parentId||r.push(n[e]));return r},Wn=e=>e.map((e=>{const{parentId:t,children:n,menuId:r}=e,s=(0,We._T)(e,["parentId","children","menuId"]);return void 0!==r&&(s.id=r),e.children&&(s.children=Wn(e.children)),s})),_n=e=>{const t=e.toSorted(Jn);for(let e=0;e<t.length;e++)t[e].children&&(t[e].children=_n(t[e].children));return t},Jn=(e,t)=>{var n,r;const s=null!==(n=e.order)&&void 0!==n?n:0,o=null!==(r=t.order)&&void 0!==r?r:0;return s>o?1:o>s?-1:e.id>t.id?1:t.id>e.id?-1:e.name>t.name?1:t.name>e.name?-1:0},Qn=e=>e.map((e=>{const t={};for(let n=0;n<Hn.length;n++){const r=Hn[n];r in e&&(t[r]=e[r])}return"children"in e&&(t.children=Qn(e.children)),t})),Vn=Qn,Xn=o.createContext([]),$n=o.createContext([]),Kn=Vn(Nn),Yn=(e=>{const t=Fn(e),n=Un(t),r=Wn(n);return _n(r)})(Nn),er=(0,v.cP)(Kn),tr=()=>(0,r.jsx)(Xn.Provider,{value:Kn,children:(0,r.jsx)($n.Provider,{value:Yn,children:(0,r.jsx)(v.pG,{router:er})})}),nr=()=>(0,o.useContext)($n);var rr=n(9164),sr=n(6720),or=n(1796),ar=n(9617);const ir=function(){const e="#9398f2",t={palette:{mode:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light",primary:{main:e,contrastText:"#fff"},text:{primary:(0,or._j)(e,.15),secondary:(0,or._j)(e,.3),disabled:(0,or.Fq)(e,.5)},divider:(0,or.Fq)(e,.5),action:{hover:(0,or.Fq)(e,.15)}}},n=(0,ar.Z)(t),r={components:{MuiButton:{defaultProps:{variant:"contained",size:"small",fullWidth:!0}},MuiTextField:{defaultProps:{variant:"outlined",size:"small",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{notchedOutline:{borderColor:n.palette.divider}}},MuiPaper:{defaultProps:{elevation:5}},MuiTablePagination:{styleOverrides:{toolbar:{display:"flex",flexWrap:"wrap",justifyContent:"end"}}}}};return(0,ar.Z)(n,r)}(),lr=e=>{let{children:t=null}=e;return(0,r.jsxs)(rr.Z,{theme:ir,children:[(0,r.jsx)(sr.ZP,{}),t]})},cr=e=>{let{children:t=null}=e;return(0,r.jsx)(zt,{children:(0,r.jsx)(N,{children:(0,r.jsx)(ne,{children:(0,r.jsx)(X,{children:(0,r.jsx)(ut,{children:(0,r.jsx)(en,{children:(0,r.jsx)(Ye,{children:t})})})})})})})},dr=o.memo(cr);(0,s.s)(document.getElementById("root")).render((0,r.jsx)(o.StrictMode,{children:(0,r.jsx)((()=>(0,r.jsx)(lr,{children:(0,r.jsx)(dr,{children:(0,r.jsx)(tr,{})})})),{})}))},1424:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(8081),s=n.n(r),o=n(3645),a=n.n(o)()(s());a.push([e.id,"* {\n    box-sizing: border-box;\n}\n\nhtml, body {\n    height: 100%;\n    width: 100%;\n    padding: 0;\n    margin: 0;\n}\n\ndiv#root {\n    min-height: 100%;\n    height: auto;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    overflow: auto;\n}\n\nbody {\n    -webkit-user-select: none;\n    -moz-user-select: -moz-none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n}\n\ninput,\ntextarea,\nli *,\ntable {\n    -moz-user-select: text;\n    user-select: text;\n}\n",""]);const i=a}},e=>{e.O(0,[514,653],(()=>(1547,e(e.s=1547)))),e.O()}]);
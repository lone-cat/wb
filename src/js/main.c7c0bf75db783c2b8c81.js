"use strict";(self.webpackChunkwb=self.webpackChunkwb||[]).push([[179],{4809:(e,t,r)=>{var n=r(5893),s=r(745),o=r(7294),a=(r(9701),r(2162),r(8247),r(4877),r(3379)),l=r.n(a),i=r(7795),c=r.n(i),d=r(569),u=r.n(d),h=r(3565),p=r.n(h),x=r(9216),m=r.n(x),f=r(4589),g=r.n(f),b=r(1424),j={};j.styleTagTransform=g(),j.setAttributes=p(),j.insert=u().bind(null,"head"),j.domAPI=c(),j.insertStyleElement=m(),l()(b.Z,j),b.Z&&b.Z.locals&&b.Z.locals;var v=r(9655),w=r(9250),y=r(7066),O=r(2433),Z=r(2658),k=r(2599);const C=()=>{const e=so(),{items:t}=(e=>{const t=(0,w.UO)(),r=(0,w.TH)(),n=(0,w.HJ)(),s=(0,o.useMemo)((()=>n.location?n.location.pathname:r.pathname),[n.location,r.pathname]),a=(0,o.useMemo)((()=>e.map((e=>{var t;const r=null!==(t=e.defaultParams)&&void 0!==t?t:{},n=(0,k.Gn)(e.path,r);return Object.assign(Object.assign({},e),{pattern:e.path,defaultParams:r,path:n})}))),[e]),l=(0,o.useMemo)((()=>a.map((e=>{const r=(0,k.Gn)(e.pattern,Object.assign(Object.assign({},e.defaultParams),t)),n=Boolean((0,k.LX)(r,s));return Object.assign(Object.assign({},e),{active:n})}))),[a,s,n]),i=(0,o.useMemo)((()=>l.map((e=>Object.assign(Object.assign({},e),{previous:e.path===r.pathname})))),[l,s,n]),{activeItem:c,activeIndex:d}=(0,o.useMemo)((()=>{for(let e=0;e<i.length;e++)if(i[e].active)return{activeItem:i[e],activeIndex:e};return{activeItem:null,activeIndex:null}}),[i]);return{items:i,active:c,index:d}})(e);return(0,n.jsx)(y.Z,{container:!0,sx:{backgroundColor:"primary.main",color:"primary.contrastText",px:2},children:t.map((e=>{const t=e.active;return(0,n.jsx)(O.Z,{component:t?"div":v.OL,to:t?void 0:e.path,children:(0,n.jsx)(Z.Z,{variant:"inherit",children:e.name})},e.path)}))})},I=()=>(0,n.jsxs)(y.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1,overflow:"hidden"},children:[(0,n.jsx)(y.Z,{children:(0,n.jsx)(C,{})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1,flexDirection:"column",width:"100%",p:2},children:(0,n.jsx)(w.j3,{})})]}),E=o.memo(I),S=()=>((0,w.lk)(),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Z.Z,{variant:"inherit",children:"Что то пошло не так..."}),(0,n.jsx)(v.OL,{to:"/",children:(0,n.jsx)(Z.Z,{variant:"inherit",children:"На главную"})})]}));var T=r(5116);const P=["standard","statistics"],D=P.reduce(((e,t)=>(e[t]=t,e)),{}),M="tokens",B="servers",G=P.reduce(((e,t)=>(e[t]="",e)),{}),N={[D.standard]:"https://suppliers-api.wildberries.ru",[D.statistics]:"https://statistics-api.wildberries.ru"},A=P.reduce(((e,t)=>(e[t]={token:"",server:"",setToken:()=>{},setServer:()=>{},ready:!1},e)),{}),R=o.createContext(A),L=e=>{let{children:t=null}=e;const[r,s]=(0,o.useState)((()=>{const e=(()=>{var e;const t=null!==(e=localStorage.getItem(M))&&void 0!==e?e:"";let r;try{if(r=JSON.parse(t),"object"!=typeof r)throw new Error("invalid storage value")}catch(e){r={}}const n=r;return P.reduce(((e,t)=>{const r=n[t];return e[t]="string"==typeof r?r:G[t],e}),{})})(),t=(()=>{var e;const t=null!==(e=localStorage.getItem(B))&&void 0!==e?e:"";let r;try{if(r=JSON.parse(t),"object"!=typeof r)throw new Error("invalid storage value")}catch(e){r={}}const n=r;return P.reduce(((e,t)=>{const r=n[t];return e[t]="string"==typeof r?r:N[t],e}),{})})();return P.reduce(((r,n)=>(r[n]={token:e[n],server:t[n]},r)),{})})),a=(0,o.useCallback)((e=>t=>r=>{s((n=>n[t][e]===r?n:Object.assign(Object.assign({},n),{[t]:Object.assign(Object.assign({},n[t]),{[e]:r})})))}),[s]),l=(0,o.useMemo)((()=>P.reduce(((e,t)=>(e[t]=""!==r[t].token&&""!==r[t].server,e)),{})),[r]),i=(0,o.useMemo)((()=>P.reduce(((e,t)=>(e[t]=Object.assign(Object.assign({},r[t]),{ready:l[t],setToken:a("token")(t),setServer:a("server")(t)}),e)),{})),[r,l,a]);return(0,o.useEffect)((()=>{const e=P.reduce(((e,t)=>(e[t]=r[t].token,e)),{}),t=P.reduce(((e,t)=>(e[t]=r[t].server,e)),{});(e=>{localStorage.setItem(M,JSON.stringify(e))})(e),(e=>{localStorage.setItem(B,JSON.stringify(e))})(t)}),[r]),(0,n.jsx)(R.Provider,{value:i,children:t})},z=o.memo(L),W=()=>(0,o.useContext)(R),q=()=>{const e=W();return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",justifyContent:"center"},children:[(0,n.jsx)(y.Z,{children:(0,n.jsx)(T.Z,{label:"Api ключ",value:e.standard.token,onChange:t=>{e.standard.setToken(t.target.value)},error:!e.standard.token})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(T.Z,{label:"Api ключ статистики",value:e.statistics.token,onChange:t=>{e.statistics.setToken(t.target.value)},error:!e.statistics.token})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(T.Z,{label:"Адрес сервера",value:e.standard.server,onChange:t=>{e.standard.setServer(t.target.value)},error:!e.standard.server})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(T.Z,{label:"Адрес сервера статистики",value:e.statistics.server,onChange:t=>{e.statistics.setServer(t.target.value)},error:!e.statistics.server})})]})},F=()=>(0,n.jsx)(q,{}),_=o.memo(F);var H=r(7582);const U=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";const r=[],n=Object.keys(e);for(let s=0;s<n.length;s++){const o=n[s],a=e[o],l=t,i=(a[l],(0,H._T)(a,["symbol"==typeof l?l:l+""]));r.push(Object.assign(Object.assign({},i),{[t]:o}))}return r},V=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return e.reduce(((e,r)=>{const{[t]:n}=r;if(e[n])throw new Error("duplicate id during conversion");return e[n]=Object.assign({},r),e}),{})},Q=e=>{const t=[],r=Object.keys(e);for(let n=0;n<r.length;n++)t.push(Object.assign({},e[r[n]]));return t},J=V([{id:2,name:"o"},{id:3,name:"a"}]),$=(Q(J),()=>{const e=(0,o.useRef)(!1);return(0,o.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[e]),e}),X=(e,t)=>{const[r,n]=(0,o.useState)(e),s=(0,o.useCallback)((e=>{t.current&&n(e)}),[t,n]);return[r,s]};var K=r(6628),Y=r(3906),ee=r(9062),te=r(4776),re=r(5725);const ne=o.forwardRef(((e,t)=>(e=Object.assign(Object.assign({},e),{sx:Object.assign({display:"flex",flexDirection:"column",position:"absolute",top:0,bottom:0,left:0,right:0},null==e?void 0:e.sx)}),(0,n.jsx)(re.ZP,Object.assign({},e,{ref:t})))));ne.displayName="StretchedContainer";const se=o.memo(ne),oe=e=>{var{children:t=null,open:r=!0,level:s=0,sx:o={}}=e,a=(0,H._T)(e,["children","open","level","sx"]);const l=$(),[i,c]=X(r?"auto":"hidden",l);return(0,n.jsx)(K.Z,Object.assign({in:r,onEntered:()=>{c("auto")},onExiting:()=>{c("hidden")}},a,{children:(0,n.jsx)(se,{sx:Object.assign({zIndex:100+s,overflow:i,justifyContent:"center",alignItems:"center",backgroundColor:e=>e.components.MuiBackdrop.styleOverrides.root.backgroundColor,backdropFilter:e=>e.components.MuiBackdrop.styleOverrides.root.backdropFilter},o),children:t})}))},ae=o.memo(oe),le=e=>{let{open:t=!0,error:r=!1,children:s=(0,n.jsx)(n.Fragment,{})}=e;const o=$(),[a,l]=X(!1,o);return(0,n.jsxs)(ae,{open:t,children:[(0,n.jsx)(K.Z,{in:!r,children:(0,n.jsx)(Y.Z,{sx:{position:"absolute",width:40,height:40,top:0,bottom:0,left:0,right:0,margin:"auto"},children:(0,n.jsx)(ee.Z,{})})}),(0,n.jsx)(se,{sx:{overflow:a?"auto":"hidden"},children:(0,n.jsx)(te.Z,{in:r,direction:"up",mountOnEnter:!0,onEntered:()=>{l(!0)},onExiting:()=>{l(!1)},children:(0,n.jsx)(Y.Z,{sx:{margin:"auto"},children:s})})})]})};var ie=r(4680),ce=r(2574);const de="supplies",ue="cards",he={db:void 0,dbIsReady:!1},pe=o.createContext(he),xe=e=>{let{children:t}=e;const r=$(),[s,a]=X(void 0,r);(0,o.useEffect)((()=>{if(void 0!==s)return;let e;const t=indexedDB.open("db",1);return t.onsuccess=t=>{const r=t.target.result;r.onerror=function(e){console.error(e.target)},a(r),e=()=>{r.close()}},t.onupgradeneeded=e=>{const t=e.target.result;(e=>{e.createObjectStore(de,{keyPath:"id"})})(t),(e=>{e.createObjectStore(ue,{keyPath:"nmID"})})(t)},t.onerror=e=>{console.error(e),a(null)},e}),[s,a]);const l=(0,o.useMemo)((()=>({db:null!=s?s:void 0,dbIsReady:!!s})),[s]);return(0,n.jsxs)(pe.Provider,{value:l,children:[t,(0,n.jsx)(le,{open:!s,error:null===s,children:(0,n.jsx)(ie.Z,{sx:{p:2},children:(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column"},children:[(0,n.jsxs)(y.Z,{children:[(0,n.jsx)(Z.Z,{variant:"h6",children:"Ошибка!"}),(0,n.jsx)(Z.Z,{children:"Не удалось соединиться с базой данных!"})]}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(ce.Z,{onClick:()=>{a(void 0)},children:"Повторить"})})]})})})]})},me=o.memo(xe),fe=()=>(0,o.useContext)(pe),ge=new Date,be={cards:{},setCards:()=>{},lastOperationStartDate:ge,startOperation:()=>{},lastOperationError:null,setLastOperationError:()=>{},clearLastOperationError:()=>{}},je=o.createContext(be),ve=e=>{let{children:t}=e;const{db:r}=fe(),[s,a]=(0,o.useState)(ge),[l,i]=(0,o.useState)(null),[c,d]=(0,o.useState)({}),[u,h]=(0,o.useState)(!1),p=(0,o.useCallback)((e=>{d(V(e,"nmID"))}),[d]);(0,o.useEffect)((()=>{r&&(e=>new Promise(((t,r)=>{const n=e.transaction([ue],"readonly").objectStore(ue).getAll();n.onerror=e=>{console.error(e.target),r(e.target)},n.onsuccess=e=>{t(e.target.result)}})))(r).then((e=>{p(e),h(!0)}))}),[r,p]);const x=(0,o.useMemo)((()=>({cards:c,setCards:p,lastOperationStartDate:s,startOperation:()=>{i(null),a(new Date)},lastOperationError:l,setLastOperationError:e=>{i(e)},clearLastOperationError:()=>{i(null)}})),[c,p,s,a,l,i]);return(0,o.useEffect)((()=>{u&&r&&((e,t)=>new Promise(((r,n)=>{const s=e.transaction([ue],"readwrite"),o=s.objectStore(ue);o.clear(),t.forEach((e=>{o.add(e)})),s.oncomplete=function(e){r()},s.onerror=function(e){n(e.target)}})))(r,Q(c)).then((()=>{console.log("saved",c)}))}),[r,c]),u?(0,n.jsx)(je.Provider,{value:x,children:t}):null},we=o.memo(ve),ye=()=>(0,o.useContext)(je),Oe={data:{headers:{},rows:[]},setData:()=>{}},Ze=o.createContext(Oe),ke=e=>{let{children:t}=e;const[r,s]=(0,o.useState)(Oe.data),a=(0,o.useMemo)((()=>({data:r,setData:s})),[r,s]);return(0,n.jsx)(Ze.Provider,{value:a,children:t})},Ce=o.memo(ke),Ie=()=>(0,o.useContext)(Ze),Ee={wbId:{name:"Артикул WB",toPrintable:e=>e.toString()},supplierId:{name:"Артикул поставщика"},sizeWb:{name:"Размер"},barcode:{name:"Штрихкод"}},Se={barcode:{name:"Штрихкод",order:10},supplierId:{name:"Артикул поставщика",order:20},sizeWb:{name:"Размер",order:30}},Te=e=>{let{cards:t}=e;const{setData:r}=Ie(),{setData:s}=Ie(),a=(0,o.useCallback)((()=>{r({filename:"cards",headers:Ee,rows:Pe(t)})}),[t,Ee,Pe,r]),l=(0,o.useCallback)((()=>{s({filename:"cards",headers:Se,rows:De(t)})}),[t,Se,De,s]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1,display:"flex"},children:(0,n.jsx)(ce.Z,{onClick:a,children:"Заполнить таблицу штрихкодами 1"})}),(0,n.jsx)(y.Z,{sx:{flexGrow:1,display:"flex"},children:(0,n.jsx)(ce.Z,{onClick:l,children:"Заполнить таблицу штрихкодами 2"})})]})},Pe=e=>e.reduce(((e,t)=>(e.push(...t.sizes.map((e=>(1!==e.skus.length&&console.error("у товара ".concat(t.vendorCode,"(wbId: ").concat(t.nmID,") у размера ").concat(e.techSize,"(").concat(e.wbSize,") количество штрихкодов ").concat(e.skus.length,"!")),{wbId:t.nmID,supplierId:t.vendorCode,sizeWb:e.techSize,barcode:e.skus.join(",")})))),e)),[]),De=e=>e.reduce(((e,t)=>(e.push(...t.sizes.reduce(((e,r)=>(e.push(...r.skus.map((e=>({supplierId:t.vendorCode,sizeWb:r.techSize,barcode:e})))),e)),[])),e)),[]),Me={pending:"ожидает",done:"выполнено",error:"ошибка"},Be=class{constructor(e){this.intervalGenerator=e,this.queue=[],this.timeoutHandler=null}rejectTasksById(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Error("group task fail");const r=this.queue.filter((t=>t.groupId===e)),n=r.length;return r.forEach((e=>{e.task.fail(t)})),this.queue=this.queue.filter((t=>t.groupId!==e)),n}addTask(e,t){let r=()=>{},n=()=>{};const s=new Promise(((e,t)=>{r=()=>e(void 0),n=t})).then((()=>e()));return this.pushToQueue({task:{run:r,fail:n},groupId:t}),s.catch((e=>{throw this.rejectTasksById(t),e}))}pushToQueue(){this.queue.length<1&&null===this.timeoutHandler&&setTimeout((()=>{this.runTask()}),100),this.queue.push(...arguments)}runTask(){if(null!==this.timeoutHandler)return;const e=this.queue.shift();e?(e.task.run(),this.timeoutHandler=setTimeout((()=>{this.timeoutHandler=null,this.runTask()}),this.intervalGenerator())):this.timeoutHandler=null}},Ge=class{constructor(e){this.intervalGenerator=e,this.queueMap={}}addTask(e,t,r){return this.ensureQueueMapHasKey(e),this.queueMap[e].addTask(t,r).catch((e=>{throw this.rejectTasksById(r,new Error("group task fail")),e}))}rejectTasksById(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Error("group task fail");return Object.keys(this.queueMap).reduce(((r,n)=>r+this.queueMap[n].rejectTasksById(e,t)),0)}ensureQueueMapHasKey(e){this.queueMap[e]||(this.queueMap[e]=new Be(this.intervalGenerator))}},Ne=e=>{const t=new Date(e);return"".concat(t.toLocaleTimeString()," ").concat(t.toLocaleDateString())},Ae=e=>{const t=e.reduce(((e,t)=>(e[t.toISOString()]=t,e)),{}),r=[],n=Object.keys(t);for(let e=0;e<n.length;e++)r.push(t[n[e]]);return r},Re=(e,t)=>{let r=e.toString();for(;r.length<t;)r="0"+r;return r},Le=String(Number.MAX_SAFE_INTEGER).length,ze={},We=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!ze[e]){const t=(e=>function*(){let t=0,r=0,n=0;for(;;){const s="".concat(Date.now(),"-").concat(Re(n,Le),"-").concat(Re(r,Le),"-").concat(Re(t,Le));yield e?"".concat(e,"-").concat(s):s,t++,t===Number.MAX_SAFE_INTEGER&&(r++,t=0),r===Number.MAX_SAFE_INTEGER&&(n++,r=0),n===Number.MAX_SAFE_INTEGER&&(n=0)}}())(e);ze[e]=()=>t.next().value}return ze[e]()},qe=function*(){for(;;)yield 3e3*Math.random()+2e3}(),Fe={[D.standard]:()=>qe.next().value,[D.statistics]:()=>6e4},_e=[D.standard],He=(e,t)=>t.created.getTime()-e.created.getTime()||(e.id<t.id?1:e.id>t.id?-1:0),Ue=()=>We("api-task-id"),Ve=()=>We("autogenerated-task-id"),Qe=()=>We("autogenerated-multiple-tasks-id"),Je={[D.standard]:new Ge(Fe.standard),[D.statistics]:new Ge(Fe.statistics)},$e={},Xe=new Error("api queue is not ready"),Ke=e=>({queue:[],addTask:e=>Promise.reject(Xe),addTasks:()=>Promise.reject(Xe)}),Ye=o.createContext(Ke),et=e=>{let{children:t}=e;const r=W(),[s,a]=(0,o.useState)($e),l=(0,o.useCallback)(((e,t,r,n)=>{const s=Ue(),o=new Date;return a((a=>{const l=Object.assign({},a);return l[s]={component:e,client:t,endpoint:r,created:o,title:n,status:Me.pending,statusDate:o},l})),s}),[a,Ue]),i=(0,o.useCallback)(((e,t)=>{a((r=>r[e].status===t?r:Object.assign(Object.assign({},r),{[e]:Object.assign(Object.assign({},r[e]),{status:t,statusDate:new Date})})))}),[a]),c=(0,o.useCallback)((e=>function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ve();const s=t.client,o=l(e,s,t.endpoint,t.title),a=-1===_e.indexOf(s)?t.endpoint:"";return Je[t.client].addTask(a,(()=>t.request(r[s].server,r[s].token)),n).catch((e=>{throw P.forEach((e=>Je[e].rejectTasksById(n))),i(o,Me.error),e})).then((e=>(i(o,Me.done),e)))}),[r,Ve,a]),d=(0,o.useCallback)((e=>function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qe();const n=t.map((t=>c(e)(t,r)));return Promise.all(n)}),[c,Qe]),u=(0,o.useCallback)((e=>({queue:U(s),addTask:c(e),addTasks:d(e)})),[s,c,d]);return(0,n.jsx)(Ye.Provider,{value:u,children:t})},tt=o.memo(et),rt=e=>(0,o.useContext)(Ye)(e);class nt extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Ошибка сети")}}class st extends nt{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Таймаут запроса")}}class ot extends nt{constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Неспецифический код HTTP ответа"),this.serverResponse=e}}class at extends ot{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Неизвестная ошибка сервера")}}class lt extends ot{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Неизвестная ошибка запроса")}}class it extends lt{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Некорректный запрос")}}class ct extends lt{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Пользователь не аутентифицирован")}}class dt extends lt{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Доступ запрещен")}}class ut extends lt{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Ресурс не найден")}}class ht extends at{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Внутренняя ошибка сервера")}}class pt extends at{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сервер временно не доступен")}}class xt extends at{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сервер не отвечает")}}class mt extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Ответ сервера имеет неверный формат")}}const ft={},gt=(15e3,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=Object.assign(Object.assign({},ft),t);return new Promise(((t,n)=>{let s=!1;const o=setTimeout((()=>{s=!0,n(new st)}),15e3);return fetch(e,r).finally((()=>{s||clearTimeout(o)})).then((e=>t(e))).catch((()=>{n(new nt)}))})).then((e=>{if(e.ok&&200===e.status)return e;if(400===e.status)throw new it(e);if(401===e.status)throw new ct(e);if(403===e.status)throw new dt(e);if(404===e.status)throw new ut(e);if(500===e.status)throw new ht(e);if(502===e.status)throw new xt(e);if(503===e.status)throw new pt(e);if(e.status>=500)throw new at(e);if(e.status>=400)throw new lt(e);throw new ot(e)}))});const bt=e=>{const t={},r=e.split("&");for(let e=0;e<r.length;e++){const n=r[e].split("=");if(n.length>2)throw new Error("invalid query passed for convertQueryToObject");const s=decodeURIComponent(n[0]);2===n.length?t[s]=decodeURIComponent(n[1]):t[s]=""}return t},jt=e=>{const t=[],r=Object.keys(e);for(let n=0;n<r.length;n++)t.push(encodeURIComponent(r[n])+"="+encodeURIComponent(e[r[n]]));return t.join("&")},vt="Authorization",wt=/(?<=(?:\/|^):)[a-zA-Z0-9]{1,}(?=\/|$)/g,yt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{url:r,restParameters:n}=kt(e,t);return Ot(e,((e,t)=>{const s={"Content-type":"application/json"},o=t?Object.assign(Object.assign({},s),{[vt]:t}):s;return Zt(((e,t,r)=>{const n={method:"GET",headers:t};return gt(((e,t)=>{const r=e.split("?");if(r.length>2)throw new Error("invalid uri passed for buildQueryString");let n;n=2===r.length?Object.assign(Object.assign({},bt(r[1])),t):Object.assign({},t);const s=jt(n);return s?r[0]+"?"+s:r[0]})(e,r),n)})(e+r,o,n))}))},Ot=(e,t)=>({request:t,endpoint:e}),Zt=e=>e.then((e=>e.json().catch((()=>{throw new mt})))),kt=(e,t)=>{var r;const n=null!==(r=e.match(wt))&&void 0!==r?r:[];n.forEach(((e,t,r)=>{if(r.indexOf(e)!==t)throw new Error("path has more than one parameter :".concat(e))}));const s=Object.assign({},t),o={};for(let e=0;e<n.length;e++){const t=n[e];if(!(t in s))throw new Error("path parameter value for :".concat(t," not found"));const r=s[t];if(delete s[t],"string"!=typeof r&&"number"!=typeof r)throw new Error("path parameter value for :".concat(t," has improper type (").concat(typeof r,")"));o[t]="string"==typeof r?r:r.toString()}return{url:e.split("/").map((e=>{for(let t=0;t<n.length;t++){const r=n[t];if(e===":".concat(r))return o[r]}return e})).join("/"),restParameters:s}},Ct={settings:{cursor:{limit:100},filter:{withPhoto:-1}}},It=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(Object.assign({},function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{request:t,endpoint:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{url:r,restParameters:n}=kt(e,t);return Ot(e,((e,t)=>{const s={"Content-type":"application/json"},o=t?Object.assign(Object.assign({},s),{[vt]:t}):s;return Zt(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n={method:"POST",headers:t,body:JSON.stringify(r)};return gt(e,n)}(e+r,o,n))}))}("/content/v2/get/cards/list",Object.assign(Object.assign({},Ct),{settings:Object.assign(Object.assign({},Ct.settings),{cursor:Object.assign(Object.assign({},Ct.settings.cursor),e)})}));return{request:(e,r)=>t(e,r).then((e=>{if(!("cards"in e))throw e;return e})),endpoint:r,client:D.standard}}(e)),{title:"Получить карточки списком"})},Et=function(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).then((r=>{const n=[...t,r];return r.cursor.total<100?new Promise((e=>{e(n.reduce(((e,t)=>(e.push(...t.cards),e)),[]))})):Et(e,{nmID:r.cursor.nmID,updatedAt:r.cursor.updatedAt},n)}))},St=e=>{let{apiClientIsReady:t}=e;const{setCards:r,startOperation:s,setLastOperationError:a}=ye(),{addTask:l}=rt("cards"),i=(0,o.useCallback)((function(){return l(It(...arguments))}),[l]),c=(0,o.useCallback)((()=>{s(),Et(i).then((e=>{r(e)})).catch((e=>{a(e),console.error(e)}))}),[r]),d=!t;return(0,n.jsx)(ce.Z,{onClick:c,disabled:d,children:"загрузить карточки"})};var Tt=r(1796),Pt=r(6585),Dt=r(6867);const Mt=o.forwardRef(((e,t)=>(e=Object.assign(Object.assign({},e),{sx:Object.assign({overflow:"auto",display:"flex",flexWrap:"nowrap",position:"absolute",top:0,bottom:0,left:0,right:0},null==e?void 0:e.sx)}),(0,n.jsx)(y.Z,Object.assign({},e,{ref:t})))));Mt.displayName="StretchedContainer";const Bt=o.memo(Mt),Gt=e=>{let{children:t=null,open:r=!0,level:s=0,sx:o={}}=e;const a=$(),[l,i]=X(r?"auto":"hidden",a);return(0,n.jsx)(K.Z,{in:r,appear:!1,onEntered:()=>{i("auto")},onExiting:()=>{i("hidden")},children:(0,n.jsx)(Bt,{sx:Object.assign({zIndex:100+s,overflow:l,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:e=>(0,Tt.Fq)(e.palette.background.default,.85),backdropFilter:"blur(5px)"},o),children:t})})},Nt=o.memo(Gt);var At=r(594),Rt=r(888);const Lt=e=>{let{secondsLeft:t,operationStartDate:r,error:s,dismissError:a=(()=>{})}=e;const l=t>0,i=$(),[c,d]=X(0,i),[u,h]=X(!1,i),[p,x]=X(l,i),m=(0,o.useRef)(null),f=(0,o.useCallback)((()=>{m.current&&clearTimeout(m.current),m.current=setTimeout((()=>{x(!1),m.current=null}),3e3)}),[m,x]),g=(0,o.useCallback)((()=>{m.current&&(clearTimeout(m.current),m.current=null),x(!1)}),[m,x]),b=(0,o.useCallback)((()=>{a(),g()}),[a,m,x]);(0,o.useEffect)((()=>(l?x(!0):f(),()=>{m.current&&(clearTimeout(m.current),m.current=null)})),[l]);const j=(0,o.useMemo)((()=>{const e=new Date;return e.setSeconds(e.getSeconds()+t),e}),[t]);(0,o.useEffect)((()=>{if(t>0){const e=setInterval((()=>{const e=(new Date).getTime()-r.getTime();d(Math.round(e/1e3))}),1e3);return()=>{clearInterval(e)}}}),[t,r]);let v=Math.round((j.getTime()-(new Date).getTime())/1e3);v<0&&(v=0);const w=(0,o.useMemo)((()=>{const e=c/(c+v)*100;return e<0?0:e>100?100:e}),[c,v]),O=(0,o.useMemo)((()=>{if(v<100)return"".concat(v,"с");const e=v/60;if(e<99)return"".concat(Math.round(e),"м");const t=e/60;if(t<99)return"".concat(Math.round(t),"ч");const r=t/24;if(r<99)return"".concat(Math.round(r),"д");const n=r/7;if(r<365)return"".concat(Math.round(n),"н");const s=r/365;return"".concat(Math.round(s),"г")}),[v]),k=null!==s;return(0,n.jsxs)(Nt,{open:p||k,sx:{overflow:"hidden"},children:[(0,n.jsx)(Bt,{sx:{overflow:u?"hidden":"auto"},children:(0,n.jsx)(K.Z,{in:!k,children:(0,n.jsx)(Y.Z,{sx:{display:"inline-flex",margin:"auto",position:"absolute",flexDirection:"column",left:0,right:0,top:0,bottom:0},children:(0,n.jsxs)(Y.Z,{sx:{display:"inline-flex",margin:"auto",alignItems:"center",width:40,height:40,position:"relative"},children:[(0,n.jsx)(Y.Z,{sx:{position:"absolute",width:"100%",height:"100%",border:e=>"5px solid ".concat((0,Tt.Fq)(e.palette.primary.main,.15)),borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,n.jsx)(Z.Z,{variant:"inherit",align:"center",sx:{fontSize:"0.8em"},children:"".concat(O)})}),(0,n.jsx)(ee.Z,{size:"100%",thickness:6,variant:"determinate",value:w}),(0,n.jsx)(Pt.Z,{in:0===t&&!k,children:(0,n.jsx)(Rt.Z,{color:"success",viewBox:"2 2 20 20",sx:{backgroundColor:e=>e.palette.background.default,borderRadius:"50%",position:"absolute",fontSize:40,zIndex:1}})})]})})})}),(0,n.jsx)(Bt,{sx:{overflow:u?"auto":"hidden"},children:(0,n.jsx)(te.Z,{in:k,direction:"up",mountOnEnter:!0,onEntered:()=>{h(!0)},onExiting:()=>{h(!1)},appear:!1,children:(0,n.jsx)(Y.Z,{sx:{margin:"auto",maxWidth:"80%"},children:(0,n.jsx)(ie.Z,{children:(0,n.jsxs)(y.Z,{container:!0,sx:{flexWrap:"nowrap",alignItems:"center"},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",px:2,py:.5,alignItems:"center",flexGrow:1},children:(0,n.jsx)(Z.Z,{variant:"inherit",color:"error",children:"Во время загрузки произошла ошибка. Данные могут быть не загружены или загружены частично."})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexShrink:0},children:(0,n.jsx)(Dt.Z,{onClick:b,children:(0,n.jsx)(At.Z,{})})})]})})})})})]})},zt=P.reduce(((e,t)=>{let r=0;for(let e=0;e<100;e++)r+=Fe[t]();return e[t]=Math.round(r/100),e}),{}),Wt=(e,t)=>(0,o.useMemo)((()=>{const r=e.filter((e=>e.status===Me.pending));if(!r.some((e=>e.component===t)))return{secondsLeft:0};const n=P.map((e=>({clientType:e,tasks:r.filter((t=>t.client===e))}))).map((e=>{if(-1!==_e.indexOf(e.clientType))return{clientType:e.clientType,subQueues:[e.tasks]};const t=Ft(e.tasks),r=Object.keys(t),n=[];for(let e=0;e<r.length;e++)n.push(t[r[e]]);return{clientType:e.clientType,subQueues:n}})).map((e=>{const r=e.subQueues.reduce(((e,r)=>{const n=qt(r,t);return n>e?n:e}),0);return{clientType:e.clientType,maxTasks:r}})),s=n.reduce(((e,t)=>{const r=t.maxTasks*zt[t.clientType];return r>e?r:e}),0);return{secondsLeft:Math.round(s/1e3)}}),[e,t,Me]),qt=(e,t)=>{const r=[...e];r.sort(He);for(let e=0;e<r.length;e++)if(r[e].component===t)return r.length-e;return 0},Ft=e=>e.reduce(((e,t)=>(e[t.endpoint]||(e[t.endpoint]=[]),e[t.endpoint].push(t),e)),{}),_t=e=>{let{apiClientIsReady:t}=e;const{cards:r,lastOperationStartDate:s,lastOperationError:a,clearLastOperationError:l}=ye(),i=(0,o.useMemo)((()=>Q(r)),[r]),{queue:c}=rt("cards"),{secondsLeft:d}=Wt(c,"cards");return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"row",position:"relative"},children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(T.Z,{label:"Карточек в списке",value:i.length})}),(0,n.jsx)(y.Z,{sx:{flexGrow:1,display:"flex"},children:(0,n.jsx)(St,{apiClientIsReady:t})}),(0,n.jsx)(Te,{cards:i}),(0,n.jsx)(Lt,{secondsLeft:d,operationStartDate:s,error:a,dismissError:l})]})},Ht=()=>{const{standard:e}=W();return(0,n.jsx)(_t,{apiClientIsReady:e.ready})},Ut=o.memo(Ht),Vt=[],Qt=new Date,Jt={supplies:Vt,setSupplies:()=>{},lastOperationStartDate:Qt,startOperation:()=>{},lastOperationError:null,setLastOperationError:()=>{},clearLastOperationError:()=>{}},$t=o.createContext(Jt),Xt=e=>{let{children:t}=e;const[r,s]=(0,o.useState)(Qt),[a,l]=(0,o.useState)(null),[i,c]=(0,o.useState)(Vt),d=(0,o.useMemo)((()=>({supplies:i,setSupplies:c,lastOperationStartDate:r,startOperation:()=>{l(null),s(new Date)},lastOperationError:a,setLastOperationError:e=>{l(e)},clearLastOperationError:()=>{l(null)}})),[i,c,r,s,a,l]);return(0,n.jsx)($t.Provider,{value:d,children:t})},Kt=o.memo(Xt),Yt=()=>(0,o.useContext)($t),er=function(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0).then((r=>{const n=[...t,r];return 0!==r.next?er(e,r.next,n):Promise.resolve(n)}))},tr=e=>{let{apiClientIsReady:t}=e;const{supplies:r,setSupplies:s,startOperation:a,setLastOperationError:l}=Yt(),{addTask:i}=rt("supplies"),c=(0,o.useCallback)((function(){return i(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object.assign(Object.assign({},function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{request:t,endpoint:r}=yt("/api/v3/supplies",{limit:String(1e3),next:e.toString()});return{request:(e,r)=>t(e,r),endpoint:r,client:D.standard}}(e)),{title:"Получить все поставки (next=".concat(e,")")})}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))}),[i]);return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1},children:[(0,n.jsx)(y.Z,{sx:{display:"flex"},children:(0,n.jsx)(T.Z,{label:"Загружено поставок",value:r.length})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(ce.Z,{onClick:()=>{a(),er(c).then((e=>{s(e.reduce(((e,t)=>(e.push(...t.supplies),e)),[]))})).catch((e=>{l(e),console.error(e)}))},disabled:!t,children:"Загрузить поставки"})})]})},rr=["признак отсутствует","обычная","СГТ (Содержит сверхгабаритные товары)","КГТ (Содержит крупногабаритные товары). Не используется на данный момент"],nr={id:{name:"QR-код поставки",order:0},name:{name:"Наименование",order:10},createdAt:{name:"Дата создания",order:20,toPrintable:Ne,toExcel:Ne},closedAt:{name:"Дата закрытия",order:30,toPrintable:Ne,toExcel:Ne},scanDt:{name:"Дата сканирования ШК ТТН",order:40,toPrintable:Ne,toExcel:Ne},scanDtDate:{name:"Дата сканирования ШК ТТН",order:40,toPrintable:Ne,toExcel:e=>new Date(e),width:15},done:{name:"Завершена",order:50,toPrintable:e=>e?"ИСТИНА":"ЛОЖЬ",toExcel:e=>e?"ИСТИНА":"ЛОЖЬ"},cargoType:{name:"Тип поставки",order:60,toPrintable:e=>rr[e],toExcel:e=>rr[e]}},sr=()=>{const{supplies:e}=Yt(),{setData:t}=Ie();return(0,n.jsx)(ce.Z,{onClick:()=>{const r=e.map((e=>Object.assign(Object.assign({},e),{scanDtDate:e.scanDt})));r.sort(((e,t)=>{const r=new Date(e.createdAt),n=new Date(t.createdAt);return r<n?-1:r>n?1:0})),t({filename:"Список поставок",headers:nr,rows:r})},children:"в таблицу"})},or=()=>{const e=W(),{queue:t}=rt("supplies"),{lastOperationStartDate:r,lastOperationError:s,clearLastOperationError:o}=Yt(),{secondsLeft:a}=Wt(t,"supplies");return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{display:"flex",flexDirection:"column",flexGrow:1,position:"relative"},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(tr,{apiClientIsReady:e.standard.ready})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(sr,{})}),(0,n.jsx)(Lt,{secondsLeft:a,operationStartDate:r,error:s,dismissError:o})]})},ar=o.memo(or),lr={},ir=new Date,cr={supplies:lr,setSupplies:()=>{},clearSupplies:()=>{},removeSupplies:()=>{},lastOperationStartDate:ir,startOperation:()=>{},lastOperationError:null,setLastOperationError:()=>{},clearLastOperationError:()=>{}},dr=o.createContext(cr),ur=e=>{let{children:t}=e;const{db:r}=fe(),[s,a]=(0,o.useState)(ir),[l,i]=(0,o.useState)(null),[c,d]=(0,o.useState)({}),[u,h]=(0,o.useState)(!1);(0,o.useEffect)((()=>{r&&(e=>new Promise(((t,r)=>{const n=e.transaction([de],"readonly").objectStore(de).getAll();n.onerror=e=>{console.error(e.target),r(e.target)},n.onsuccess=e=>{t(e.target.result)}})))(r).then((e=>{d(V(e)),h(!0)}))}),[r,d]);const p=(0,o.useCallback)((()=>{d(lr)}),[d]),x=(0,o.useCallback)((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];d((e=>{const r=Object.assign({},e);let n=!1;for(let e=0;e<t.length;e++){const s=t[e];r[s]&&(delete r[s],n=!0)}return n?r:e}))}),[d]),m=(0,o.useCallback)((e=>{d((t=>{const r=Object.assign({},t);return e.forEach((e=>{r[e.id]=e})),r}))}),[d]),f=(0,o.useMemo)((()=>({supplies:c,setSupplies:m,clearSupplies:p,removeSupplies:x,lastOperationStartDate:s,startOperation:()=>{i(null),a(new Date)},lastOperationError:l,setLastOperationError:e=>{i(e)},clearLastOperationError:()=>{i(null)}})),[c,m,p,x,s,a,l,i]);return(0,o.useEffect)((()=>{u&&r&&((e,t)=>new Promise(((r,n)=>{const s=e.transaction([de],"readwrite"),o=s.objectStore(de);o.clear(),t.forEach((e=>{o.add(e)})),s.oncomplete=function(e){r()},s.onerror=function(e){n(e.target)}})))(r,Q(c)).then((()=>{console.log("saved",c)}))}),[r,c]),(0,n.jsx)(dr.Provider,{value:f,children:t})},hr=o.memo(ur),pr=()=>(0,o.useContext)(dr),xr=e=>e.filter(((t,r)=>e.indexOf(t)===r)),mr=e=>xr(e.filter((t=>e.indexOf(t)!==e.lastIndexOf(t)))),fr=e=>Object.assign(Object.assign({},(e=>{const{request:t,endpoint:r}=yt("/api/v3/supplies/:supplyId",{supplyId:e});return{request:(e,r)=>t(e,r),endpoint:r,client:D.standard}})(e)),{title:"Загрузить данные поставки ".concat(e)}),gr=e=>Object.assign(Object.assign({},(e=>{const{request:t,endpoint:r}=yt("/api/v3/supplies/:supplyId/orders",{supplyId:e});return{request:(e,r)=>t(e,r),endpoint:r,client:D.standard}})(e)),{title:"Получить заказы по поствке ".concat(e)}),br=/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/,jr=(e,t)=>{const r=We("statistics-orders-group-id"),n=t.map((t=>{return e((n=t,Object.assign(Object.assign({},(e=>{const t=new Date(e.toISOString());t.setUTCHours(0,0,0,0);const r=t.toISOString().split("T")[0];if(!r.match(br))throw new Error("invalid date for order request");const{request:n,endpoint:s}=yt("/api/v1/supplier/orders",{dateFrom:r,flag:"1"});return{request:(e,t)=>n(e,t),endpoint:s,client:D.statistics}})(n)),{title:"Получить заказы из статистики за ".concat(n.toISOString().split("T")[0])})),r).catch((e=>(console.error("не удалось загрузить заказы из статистики на дату ".concat(t.toISOString(),", причина:"),e),null)));var n}));return Promise.all(n).then((e=>e.reduce(((e,t)=>(null!==t&&e.push(...t),e)),[])))},vr=(e,t,r)=>((e,t)=>{const r=xr(t);if(r.length<1)return Promise.resolve([]);const n=We("supplies-download-group-id");return Promise.all(xr(r).map((t=>((e,t,r)=>t?e([fr(t),gr(t)],r).then((e=>{let[t,r]=e;return Object.assign(Object.assign({},t),{orders:r.orders})})):Promise.reject(new Error("не передан id поставки")))(e,t,n).catch((e=>(console.error("не удалось загрузить поставку ".concat(t,", причина:"),e),null)))))).then((e=>e.filter((e=>null!==e))))})(t,r).then((t=>{if(t.length<1)throw new Error("ни одной поставки не загружено");const r=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.reduce(((e,t)=>{const r=t.orders.map((e=>e.createdAt)).map((e=>{const t=new Date(e);return t.setUTCHours(0,0,0,0),t})),n=Ae(r).reduce(((e,t)=>{const r=new Date(t.toISOString());r.setUTCDate(r.getUTCDate()-1);const n=new Date(t.toISOString());return n.setUTCDate(n.getUTCDate()+1),e.push(t),e.push(r),e.push(n),e}),[]);return e.push(...n),e}),[]);return Ae(n)}(...t).filter((e=>!isNaN(e.getTime())));if(r.length<1)throw new Error("ни одной даты заказа не получено");return Promise.all([Promise.resolve(t),jr(e,r)])})).then((e=>{let[t,r]=e;return t.reduce(((e,t)=>{const n=[];for(let s=0;s<t.orders.length;s++){const o=t.orders[s],a=r.filter((e=>e.srid===o.rid));if(a.length<1)return console.error("заказ из раздела статистики не найден (rid: ".concat(o.rid,", orderUid: ").concat(o.orderUid,")")),console.log(o),e;if(a.length>1)return console.error("соответствующих заказов из раздела статистики более одного (rid: ".concat(o.rid,", orderUid: ").concat(o.orderUid,")")),console.log(a),e;const l=a[0];n.push({supply:o,statistics:l})}return e.push(Object.assign(Object.assign({},t),{orders:n})),e}),[])})),wr=/(WB-GI-[0-9]{5,})/g,yr=e=>{var t;return null!==(t=e.match(wr))&&void 0!==t?t:[]},Or=e=>{let{apiClientIsReady:t,apiStatisticsClientIsReady:r}=e;const{dbIsReady:s}=fe(),{setSupplies:a,startOperation:l,setLastOperationError:i}=pr(),[c,d]=(0,o.useState)(""),u=(0,o.useMemo)((()=>xr(yr(c))),[c,yr]),h=!s||!t||!r,{addTask:p,addTasks:x}=rt("supply"),m=(0,o.useCallback)((e=>vr(p,x,e)),[vr,p,x]);return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1},children:[(0,n.jsxs)(y.Z,{container:!0,sx:{flexGrow:1},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(T.Z,{label:"ID поставки",fullWidth:!0,multiline:!0,rows:1,value:c,onChange:e=>{d(e.target.value)},sx:{"& .MuiInputBase-multiline":{height:"100%",overflow:"auto","& textarea":{height:"100% !important",overflow:"visible !important"}}}})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(T.Z,{label:"ID поставки обработанные",fullWidth:!0,multiline:!0,rows:1,value:u.join("\r\n"),sx:{"& .MuiInputBase-multiline":{height:"100%",overflow:"auto","& textarea":{height:"100% !important",overflow:"visible !important"}}}})})]}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(ce.Z,{onClick:()=>{l(),m(u).then((e=>{a(e)})).catch((e=>{console.error(e),i(e)}))},disabled:h||u.length<1,children:"загрузить данные о поставке"})})]})},Zr=()=>{const e=W(),{queue:t}=rt("supplies"),{lastOperationStartDate:r,lastOperationError:s,clearLastOperationError:o}=pr(),{secondsLeft:a}=Wt(t,"supply");return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Or,{apiClientIsReady:e.standard.ready,apiStatisticsClientIsReady:e.statistics.ready}),(0,n.jsx)(Lt,{secondsLeft:a,operationStartDate:r,error:s,dismissError:o})]})},kr=o.memo(Zr);var Cr=r(4295),Ir=r.n(Cr);const Er=/^[^./\\]{1,}$/,Sr=/^[^./\\]{1,}\.xlsx$/i,Tr=e=>{const t=[],r=Object.keys(e);for(let n=0;n<r.length;n++)t.push(Object.assign({id:r[n]},e[r[n]]));return t.sort(((e,t)=>{var r,n;const s=null!==(r=e.order)&&void 0!==r?r:0,o=null!==(n=t.order)&&void 0!==n?n:0;return s>o?1:s<o||e.name<t.name?-1:t.name<e.name?1:0})),t.map((e=>e.id))},Pr=e=>{var t;const{filename:r="без_имени",headers:n,rows:s}=e,o=Tr(n),a=new(Ir().Workbook),l=a.addWorksheet("Лист 1"),i={style:"thin",color:"black"};l.columns=o.map((e=>({key:e,header:n[e].name,width:-1}))),l.getRow(1).eachCell((e=>{e.style={border:{top:i,left:i,right:i,bottom:i},alignment:{vertical:"middle",horizontal:"center",wrapText:!0},font:{bold:!0}}})),l.addRows(s.map((e=>{const t={};for(let r=0;r<o.length;r++){const s=o[r],a=n[s];t[s]=a.toExcel?a.toExcel(e[s]):e[s]}return t})));const c={};for(let e=0;e<o.length;e++)c[o[e]]=null!==(t=n[o[e]].width)&&void 0!==t?t:"auto";return Gr(l,c),((e,t)=>{let r=t;return r.match(Er)||r.match(Sr)||(r="invalid_file_name"),r.match(Er)&&(r+=".xlsx"),e.writeBuffer().then((e=>{const t=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=document.createElement("a");return n.href=URL.createObjectURL(t),n.download=r,n.click(),URL.revokeObjectURL(n.href),!0}))})(a.xlsx,r)},Dr=Pr,Mr=new Be((()=>1e3)),Br=e=>Mr.addTask((()=>Pr(e)),We("export-task-id")),Gr=(e,t)=>{e.columns.forEach((e=>{const r=t[e.key];if("auto"!==r)return void(e.width=r);const n=e.values.map((e=>e.toString().length)),s=Math.max(...n.filter((e=>"number"==typeof e)));e.width=s+6}))},Nr=new Error("exporter is not ready"),Ar={exportNow:()=>Promise.reject(Nr),exportEnqueue:()=>Promise.reject(Nr)},Rr=o.createContext(Ar),Lr=e=>{let{children:t}=e;const r=(0,o.useMemo)((()=>({exportNow:Dr,exportEnqueue:Br})),[Dr,Br]);return(0,n.jsx)(Rr.Provider,{value:r,children:t})},zr=o.memo(Lr),Wr=()=>(0,o.useContext)(Rr);var qr=r(2440),Fr=r(576),_r=r(8619),Hr=r(8885),Ur=r(4212),Vr=r(9334);const Qr=e=>{let{icon:t,color:r,action:s,disabled:o=!1}=e;return(0,n.jsx)(Dt.Z,{edge:"end",disabled:o,color:r,onClick:s,children:t})},Jr=e=>{let{items:t,selectedItemIds:r,setSelectedItemIds:s,buttons:a=[],idToString:l=(e=>e),stringToId:i=(e=>e)}=e;const c=(0,o.useMemo)((()=>Object.keys(t).map((e=>i(e)))),[t]),d=(0,o.useCallback)((e=>()=>{s((t=>{const r=t.indexOf(e),n=[...t];return-1===r?n.push(e):n.splice(r,1),n}))}),[]),u=(0,o.useMemo)((()=>c.length>0&&c.every((e=>r.indexOf(e)>-1))),[c,r]);return(0,o.useEffect)((()=>{s((e=>e.filter((e=>c.indexOf(e)>-1))))}),[c]),(0,n.jsx)(ie.Z,{variant:"outlined",sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:(0,n.jsxs)(qr.Z,{sx:{flexGrow:1,flexShrink:1,flexBasis:70,overflow:"auto",position:"relative",pt:0},children:[(0,n.jsx)(Fr.ZP,{disablePadding:!0,sx:{position:"sticky",top:0,zIndex:1,bgcolor:"background.paper",py:.5,borderBottom:e=>"1px solid ".concat(e.palette.divider)},secondaryAction:(0,n.jsx)(n.Fragment,{children:a.map(((e,t)=>{const s=Object.assign(Object.assign({},e),{disabled:r.length<1,action:()=>{e.action(...r)}});return(0,n.jsx)(Qr,Object.assign({},s),t)}))}),children:(0,n.jsxs)(_r.Z,{role:void 0,onClick:()=>{s(u?[]:c)},dense:!0,sx:{py:.5,my:-.5},children:[(0,n.jsx)(Hr.Z,{children:(0,n.jsx)(Ur.Z,{edge:"start",checked:u,disabled:c.length<1,indeterminate:r.length>0&&!u,tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":"all"},sx:{py:0}})}),(0,n.jsx)(Vr.Z,{id:"all",primary:"Все"})]})}),c.map((e=>{const s="checkbox-list-label-".concat(e);return(0,n.jsx)(Fr.ZP,{disablePadding:!0,secondaryAction:(0,n.jsx)(n.Fragment,{children:a.map(((t,r)=>{const s=Object.assign(Object.assign({},t),{action:()=>{t.action(e)}});return(0,n.jsx)(Qr,Object.assign({},s),r)}))}),children:(0,n.jsxs)(_r.Z,{role:void 0,onClick:d(e),dense:!0,sx:{py:0},children:[(0,n.jsx)(Hr.Z,{children:(0,n.jsx)(Ur.Z,{edge:"start",checked:-1!==r.indexOf(e),tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":s},sx:{py:0}})}),(0,n.jsx)(Vr.Z,{id:s,primary:t[e]})]})},e)}))]})})},$r=o.memo(Jr),Xr=(e,t)=>{const r=e.characteristics.filter((e=>e.name===t));if(1!==r.length)throw console.log(e,r),new Error("characteristic error");return r[0].value},Kr={orderId:{name:"№ задания",order:0,toPrintable:e=>String(e)},supplyId:{name:"QR-код поставки",order:10},sticker:{name:"Стикер",order:15},supplyName:{name:"Название поставки",order:20},orderDate:{name:"Дата создания",order:30,toPrintable:Ne,toExcel:Ne},supplyBarcodeScanDate:{name:"Дата сканирования ШК ТТН",order:40,toPrintable:Ne,toExcel:Ne},supplyClosedAt:{name:"Дата закрытия поставки",order:45,toPrintable:Ne,toExcel:Ne},name:{name:"Наименование",order:50},sizeTech:{name:"Размер",order:60},color:{name:"Цает",order:70},price:{name:"Стоимость",order:72,toPrintable:e=>(e/100).toFixed(2),toExcel:e=>Number((e/100).toFixed(2))},currency:{name:"Валюта",order:74,toPrintable:e=>643===e?"₽":"?",toExcel:e=>643===e?"₽":"?"},wbId:{name:"Артикул Wildberries",order:80,toPrintable:e=>String(e)},supplierId:{name:"Артикул продавца",order:90},srid:{name:"Srid",order:100},productBarcode:{name:"Штрихкод",order:110}},Yr=()=>{const{supplies:e,removeSupplies:t}=pr(),{exportEnqueue:r}=Wr(),s=$(),[a,l]=X("",s),i=(0,o.useMemo)((()=>{let e=a.replaceAll(/\s/g," ");return e=e.replaceAll("  ",""),e.split(" ").filter((e=>e))}),[a]),c=(0,o.useMemo)((()=>{const t=Object.keys(e);t.sort();const r={};for(let e=0;e<t.length;e++)r[t[e]]=t[e];return r}),[e]),{setData:d}=Ie(),{cards:u}=ye(),h=(0,o.useMemo)((()=>Q(u)),[u]),[p,x]=o.useState([]),m=(0,o.useMemo)((()=>p.map((t=>e[t]))),[e,p]);return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexGrow:1,flexWrap:"nowrap"},children:[(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1,flexWrap:"nowrap"},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1,height:"auto",maxHeight:"10rem"},children:(0,n.jsx)($r,{items:c,selectedItemIds:p,setSelectedItemIds:x,buttons:[{icon:(0,n.jsx)(At.Z,{}),color:"error",action:t}]})}),(0,n.jsxs)(y.Z,{container:!0,children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(ce.Z,{disabled:p.length<1,onClick:()=>{let e;console.log(m),1===m.length&&(e="Данные о поставке ".concat(m[0].id)),m.length>1&&(e="Данные о поставках ".concat(m.map((e=>e.id)).join(","))),d({filename:e,headers:Kr,rows:tn(m,h,i)})},children:"в таблицу"})}),(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(ce.Z,{disabled:p.length<1,onClick:()=>{m.forEach((e=>{r({filename:"Данные о поставке ".concat(e.id),headers:Kr,rows:tn([e],h,i)}).catch((e=>{console.error(e)}))}))},children:"экспорт по файлам"})})]})]}),(0,n.jsx)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1,flexWrap:"nowrap"},children:(0,n.jsx)(y.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",flexWrap:"nowrap"},children:(0,n.jsx)(T.Z,{multiline:!0,label:"Допустимые штрихкоды",sx:{flexGrow:1,"& .MuiInputBase-root":{flexGrow:1,flexDirection:"column"}},inputProps:{sx:{flexGrow:1,flexBasis:0,height:0,overflow:"auto"},style:{flexGrow:1,flexBasis:0,height:0,overflow:"auto"}},value:i.join("\r\n"),onChange:e=>{l(e.target.value)}})})})]})},en=o.memo(Yr),tn=(e,t,r)=>{const n=t.map((e=>((e,t)=>Object.assign(Object.assign({},e),{sizes:e.sizes.map((r=>{const{skus:n}=r,s=(0,H._T)(r,["skus"]),o=n.filter((e=>t.indexOf(e)>-1));if(1!=o.length)throw console.error("not single barcode for card",e),new Error('not single barcode for card "'+e.vendorCode+'" for size "'+r.wbSize+'": ['+o.join(", ")+"]");return Object.assign(Object.assign({},s),{barcode:o[0]})}))}))(e,r))),s=e.reduce(((e,t)=>(e.push(...t.orders.map((e=>{var r;const s=n.filter((t=>t.nmID===e.supply.nmId));if(1!==s.length)throw console.error(s),console.error("cards match"+s.length),new Error("error getting card from list: supplierId: ".concat(e.supply.article,", wbId: ").concat(e.supply.nmId));const o=s[0],a=o.sizes.filter((t=>t.chrtID===e.supply.chrtId));if(1!==a.length)throw console.error(a),new Error("error getting size of card from list: supplierId: ".concat(e.supply.article,", wbId: ").concat(e.supply.nmId,", chrtId: ").concat(e.supply.chrtId));const l=a[0],i=o.title,c=(null!==(r=Xr(o,"Цвет"))&&void 0!==r?r:[]).join(", ");return{supplyId:t.id,supplyName:t.name,supplyBarcodeScanDate:t.scanDt,supplyClosedAt:t.closedAt,orderDate:e.supply.createdAt,orderId:e.supply.id,price:e.supply.convertedPrice,currency:e.supply.convertedCurrencyCode,supplierId:e.supply.article,wbId:e.supply.nmId,name:i,color:c,sizeTech:l.techSize,sticker:e.statistics.sticker,srid:e.statistics.srid,productBarcode:l.barcode}}))),e)),[]);return s.sort(((e,t)=>e.supplyId<t.supplyId?-1:e.supplyId>t.supplyId||e.orderId<t.orderId?1:e.orderId>t.orderId?-1:0)),s},rn=()=>(0,n.jsxs)(y.Z,{container:!0,spacing:2,children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(ar,{})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1,position:"relative"},children:(0,n.jsx)(kr,{})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(en,{})})]}),nn=()=>(0,n.jsx)(rn,{}),sn=o.memo(nn);var on=r(7896),an=r(9573),ln=r(6011),cn=r(3694),dn=r(6926),un=r(8732),hn=r(3863),pn=r(268);const xn=[{label:"25",value:25},{label:"100",value:100},{label:"250",value:250},{label:"Все",value:-1}],mn=e=>{let{data:t,orderedColumnIds:r}=e;const[s,a]=o.useState(0),[l,i]=o.useState(25),c=(0,o.useCallback)(((e,t)=>{a(t-1)}),[a]),d=(0,o.useCallback)((e=>{i(+e.target.value),a(0)}),[i,a]),{headers:u,rows:h}=t;(0,o.useEffect)((()=>{a(0)}),[t]);const p=-1===l?h.length:l,x=Math.ceil(h.length/p),m=x>0?x-1:0,f=s>m?m:s,g=f+1;return(0,n.jsxs)(y.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1,width:"100%"},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%"},children:(0,n.jsx)(ie.Z,{variant:"outlined",sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:(0,n.jsx)(on.Z,{sx:{flexGrow:1,flexShrink:1,flexBasis:"10rem",height:"100%",width:"100%",position:"relative"},children:(0,n.jsxs)(an.Z,{stickyHeader:!0,size:"small",sx:{width:"100%"},children:[(0,n.jsx)(ln.Z,{children:(0,n.jsxs)(cn.Z,{children:[(0,n.jsx)(dn.Z,{align:"right",children:"№"}),r.map((e=>(0,n.jsx)(dn.Z,{align:u[e].align,children:u[e].name},e)))]})}),(0,n.jsx)(un.Z,{children:h.slice(f*p,f*p+p).map(((e,t)=>(0,n.jsxs)(cn.Z,{hover:!0,children:[(0,n.jsx)(dn.Z,{align:"right",children:t+f*p+1}),r.map((r=>{const s=u[r],o=s.toPrintable?s.toPrintable(e[r]):e[r];return(0,n.jsx)(dn.Z,{align:s.align,children:o},String(t)+r)}))]},t)))})]})})})}),(0,n.jsx)(y.Z,{sx:{flexGrow:0,width:"100%"},children:(0,n.jsx)(hn.Z,{rowsPerPageOptions:xn,component:"div",count:h.length,rowsPerPage:l,page:f,onPageChange:c,onRowsPerPageChange:d,labelRowsPerPage:"Показывать:",labelDisplayedRows:e=>{let{from:t,to:r,count:n}=e;return"".concat(t," - ").concat(r," из ").concat(-1!==n?n:">".concat(r))},ActionsComponent:e=>{const{page:t,count:r,rowsPerPage:s,showLastButton:o,getItemAriaLabel:a,showFirstButton:l,onPageChange:i}=e;return(0,H._T)(e,["page","count","rowsPerPage","showLastButton","getItemAriaLabel","showFirstButton","onPageChange"]),(0,n.jsx)(pn.Z,{siblingCount:2,boundaryCount:1,count:x,page:g,onChange:c,sx:{"& ul":{display:"flex",flexWrap:"nowrap"}}})}})})]})},fn=e=>{let{data:t}=e;const{exportEnqueue:r}=Wr();return(0,n.jsx)(ce.Z,{onClick:()=>{r(t)},children:"выгрузить в excel"})},gn=e=>{let{data:t}=e;const{headers:r}=t,s=(0,o.useMemo)((()=>Tr(r)),[r]);return(0,n.jsxs)(y.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1},children:[(0,n.jsx)(y.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1,width:"100%"},children:(0,n.jsx)(mn,{data:t,orderedColumnIds:s})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(fn,{data:t})})]})},bn=()=>{const{data:e}=Ie();return(0,n.jsx)(gn,{data:e})},jn=()=>(0,n.jsxs)(y.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1},children:[(0,n.jsx)(w.j3,{}),(0,n.jsx)(y.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",mt:2,maxWidth:"100%"},children:(0,n.jsx)(bn,{})})]}),vn=o.memo(jn);var wn=r(3718);const yn=e=>{let{text:t}=e;const r=$(),[s,a]=X(!1,r),l=(0,o.useRef)(null),i=(0,o.useMemo)((()=>t.length>150?t.substring(0,150)+"...":t),[t]);return t.length<=150?(0,n.jsx)(n.Fragment,{children:t}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(wn.Z,{open:s,placement:"bottom",anchorEl:l.current,disablePortal:!0,modifiers:[{name:"flip",enabled:!1,options:{altBoundary:!0,rootBoundary:"document",padding:8}},{name:"preventOverflow",enabled:!0,options:{altAxis:!0,altBoundary:!0,tether:!1,rootBoundary:"document",padding:8}}],sx:{zIndex:10,width:"600px",minWidth:"50%",maxWidth:"80%",height:"250px",maxHeight:"80%",minHeight:"10%"},onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)},children:(0,n.jsx)(ie.Z,{sx:{p:2,width:"100%",height:"100%"},children:(0,n.jsx)(T.Z,{multiline:!0,rows:1,fullWidth:!0,value:t,sx:{height:"100%","& .MuiInputBase-multiline":{height:"100%",overflow:"auto","& textarea":{height:"100% !important",overflow:"visible !important"}}}})})}),(0,n.jsx)(Y.Z,{ref:l,sx:{mx:-2,my:-.75,px:2,py:.75},onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)},children:i})]})},On=o.memo(yn);var Zn=r(9572);const kn={[Me.pending]:(0,n.jsx)(ee.Z,{size:"1.2rem"}),[Me.done]:(0,n.jsx)(Rt.Z,{color:"success"}),[Me.error]:(0,n.jsx)(Zn.Z,{color:"error"})},Cn=e=>{let{status:t}=e;return(0,n.jsx)(Y.Z,{sx:{display:"flex",flexDirection:"column",minHeight:"1.5rem",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},children:(0,n.jsx)(Y.Z,{sx:{height:"1.5rem",width:"1.5rem",display:"flex",justifyContent:"center",alignItems:"center"},children:kn[t]})})},In=o.memo(Cn),En={[D.standard]:"стандартное",[D.statistics]:"статистика"},Sn={created:{order:0,name:"Дата создания",align:"center",width:15,toPrintable:e=>e.toLocaleString()},status:{order:10,name:"Статус",align:"center",toPrintable:e=>(0,n.jsx)(In,{status:e})},statusDate:{order:20,name:"Дата статуса",align:"center",width:15,toPrintable:e=>e.toLocaleString()},title:{order:30,name:"Задача",width:50,toPrintable:e=>(0,n.jsx)(On,{text:e})},component:{order:40,name:"Запрошено компонентом",align:"center",toPrintable:e=>null!=e?e:""},client:{order:50,name:"Тип API",align:"center",toPrintable:e=>En[e],toExcel:e=>En[e]},endpoint:{order:60,name:"URL"}},Tn=()=>{const{queue:e}=rt("apiStatus"),t=(0,o.useMemo)((()=>{const t=[...e];return t.sort(He),t}),[e]),r=(0,o.useMemo)((()=>({filename:"apiTasks",headers:Sn,rows:t})),[t,Sn]);return(0,n.jsx)(gn,{data:r})},Pn=o.memo(Tn),Dn=()=>(0,n.jsx)(Pn,{}),Mn=o.memo(Dn);var Bn=r(2734);const Gn=e=>{let{cardInfo:t}=e;var r;const s=(0,Bn.Z)(),a=(0,o.useMemo)((()=>s.palette.primary.main),[s]),l=(0,o.useMemo)((()=>s.shape.borderRadius),[s]),i=(0,o.useMemo)((()=>{var e;if(!t)return{article:"",size:"",material:"",link:""};const r=null!==(e=Xr(t,"Состав"))&&void 0!==e?e:[];return{article:t.vendorCode,size:t.techSize,material:r.join(", "),link:"https://www.wildberries.ru/catalog/".concat(t.nmID,"/detail.aspx")}}),[t]);return t?(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexWrap:"nowrap",flexGrow:1,flexShrink:0,height:"100%"},children:[(0,n.jsx)(y.Z,{xs:6,children:(0,n.jsxs)(Y.Z,{sx:{width:"100%",height:"100%",wordWrap:"break-word",wordBreak:"break-all"},children:["Артикул: ",(0,n.jsx)("span",{className:"selectable",children:i.article}),(0,n.jsx)("br",{}),"Размер: ",(0,n.jsx)("span",{className:"selectable",children:i.size}),(0,n.jsx)("br",{}),"Состав: ",(0,n.jsx)("span",{className:"selectable",children:i.material}),(0,n.jsx)("br",{}),"Ссылка: ",(0,n.jsx)("a",{className:"selectable",href:i.link,target:"_blank",rel:"noreferrer",children:i.link})]})}),(0,n.jsx)(y.Z,{xs:6,sx:{display:"flex"},children:(0,n.jsx)(Y.Z,{sx:{position:"relative",width:"100%",height:"100%",display:"flex"},children:(0,n.jsx)(Y.Z,{sx:{position:"absolute",top:0,bottom:0,left:0,right:0,display:"flex"},children:(0,n.jsx)("img",{src:null!==(r=t.photos[0].big)&&void 0!==r?r:null,style:{position:"relative",display:"inline-block",margin:"0 auto auto",maxHeight:"100%",maxWidth:"100%",border:"2px solid ".concat(a),borderRadius:l}})})})})]}):(0,n.jsx)(y.Z,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:(0,n.jsx)("span",{children:"Товара с таким штрихкодом не найдено. Если вы уверены что он должен быть, попробуйте перезагрузить карточки с WB."})})},Nn=o.memo(Gn),An=()=>{const{cards:e}=ye(),t=(0,o.useMemo)((()=>Q(e)),[e]),r=(0,o.useMemo)((()=>t.reduce(((e,t)=>{const r=t.sizes.reduce(((e,r)=>{for(let n=0;n<r.skus.length;n++){const s=r.skus[n],{sizes:o}=t,a=(0,H._T)(t,["sizes"]),{skus:l}=r,i=(0,H._T)(r,["skus"]);e[s]||(e[s]=[]),e[s].push(Object.assign(Object.assign({},a),i))}return e}),{});return Object.assign(Object.assign({},e),r)}),{})),[t]),[s,a]=(0,o.useMemo)((()=>{const e=[],t={},n=Object.keys(r);for(let s=0;s<n.length;s++){const o=n[s];r[o].length>1&&e.push(o),t[o]=r[o][0]}return[e,t]}),[r]),l=(0,o.useRef)(null),i=$(),[c,d]=X("",i),u=(0,o.useMemo)((()=>c.match(/^[0-9]{13}$/)?null:"штрихкод должен содержать 13 цифр"),[c]),h=(0,o.useCallback)((e=>{d(e.target.value)}),[d]),p=(0,o.useCallback)((e=>{e.preventDefault(),setTimeout((()=>{l.current.select()}),100)}),[l,u,d]),x=(0,o.useMemo)((()=>{var e;return null!==(e=a[c])&&void 0!==e?e:null}),[a,c]);return(0,o.useEffect)((()=>{l.current.select()}),[l]),(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1},children:[(0,n.jsx)(y.Z,{children:(0,n.jsx)("form",{onSubmit:p,children:(0,n.jsx)(T.Z,{label:"Введите штрихкод и нажмите Enter",value:c,onChange:h,error:null!==u,inputRef:l,onBlur:()=>{l.current.focus()}})})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1,flexDirection:"column",height:"100%"},children:(0,n.jsx)(Nn,{cardInfo:x})})]})},Rn=o.memo(An),Ln=()=>(0,n.jsx)(Rn,{}),zn=o.memo(Ln),Wn={boxesData:{},addBox:()=>{},removeBox:()=>{},renameBoxes:()=>{},loadBarcodesToBoxes:()=>{}},qn=o.createContext(Wn),Fn=e=>{let{children:t}=e;const r=$(),[s,a]=X({},r),l=(0,o.useCallback)((()=>{a((e=>{const t=Object.keys(e).map((e=>Number(e)));let r;t.sort(((e,t)=>e-t));for(let e=0;e<t.length;e++)if(t[e]!==e+1){r=e+1;break}return r||(r=t.length+1),Object.assign(Object.assign({},e),{[r]:{wbCode:"",barcodes:[]}})}))}),[a]),i=(0,o.useCallback)((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];a((e=>{const r=Object.assign({},e);for(let e=0;e<t.length;e++)delete r[t[e]];return r}))}),[a]),c=(0,o.useCallback)((e=>{a((t=>((e,t)=>{const r=Object.keys(e).map((e=>Number(e))),n={};for(let s=0;s<r.length;s++){const o=r[s];n[o]={wbCode:o in t?t[o]:e[o].wbCode,barcodes:[...e[o].barcodes]}}return n})(t,e)))}),[a]),d=(0,o.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a((r=>function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n,s;const o=Object.keys(e).map((e=>Number(e))),a=Object.keys(t).map((e=>Number(e))),l=xr([...o,...a]),i={};for(let o=0;o<l.length;o++){const a=l[o],c=null!==(s=null===(n=e[a])||void 0===n?void 0:n.barcodes)&&void 0!==s?s:[];i[a]={wbCode:e[a]?e[a].wbCode:"",barcodes:t[a]?r?[...t[a]]:[...c,...t[a]]:[...c]}}return i}(r,e,t)))}),[a]),u=(0,o.useMemo)((()=>({boxesData:s,addBox:l,removeBox:i,renameBoxes:c,loadBarcodesToBoxes:d})),[s,l,i,c,d]);return(0,n.jsx)(qn.Provider,{value:u,children:t})},_n=o.memo(Fn),Hn=()=>(0,o.useContext)(qn);var Un=r(7957);const Vn=o.forwardRef(((e,t)=>{var{open:r=!0,level:s,slideProps:o={},backdropProps:a={}}=e,l=(0,H._T)(e,["open","level","slideProps","backdropProps"]);l=Object.assign(Object.assign({elevation:15},l),{sx:Object.assign({margin:"auto",position:"relative",p:2},null==l?void 0:l.sx)});const{in:i,direction:c}=o,d=(0,H._T)(o,["in","direction"]);return(0,n.jsx)(ae,Object.assign({open:r,level:s},a,{children:(0,n.jsx)(te.Z,Object.assign({in:r,direction:"up"},d,{children:(0,n.jsx)(ie.Z,Object.assign({},l))}))}))}));Vn.displayName="CenteredDialogRaw";const Qn=o.memo(Vn),Jn=e=>{let{renamingIds:t,close:r,rename:s,boxNamesMap:a}=e;const l=null!=t?t:[],i=$(),[c,d]=X("",i);(0,o.useEffect)((()=>{d("")}),[l]);const u=(0,o.useMemo)((()=>{const e=c.replace(/\s+$/g,"").split("\n").map((e=>e.trim()));if(e.length<(null!=l?l:[]).length){const t=l.length-e.length;for(let r=0;r<t;r++)e.push("")}return e}),[c,l]),{renameMap:h,errors:p}=(0,o.useMemo)((()=>{const e={},t=[];if(u.length!==(null==l?void 0:l.length))return t.push("Количество коробок для переименования меньше чем задано наименований"),{renameMap:e,errors:t};const r=u.filter((e=>""!==e)),n=mr(r);if(n.length>0)return t.push("В поле есть одинаковые наименования: '".concat(n.join("', '"),"'")),{renameMap:e,errors:t};const s=Object.keys(a).map((e=>Number(e))),o=[];for(let t=0;t<s.length;t++){const r=s[t],n=l.indexOf(r);n>-1?(e[l[n]]=u[n],o.push(u[n])):o.push(a[r])}const i=mr(o.filter((e=>""!==e)));return i.length>0?(t.push("В поле есть наименования, которые уже назначены на другие коробки: '".concat(i.join("', '"),"'")),{renameMap:{},errors:t}):{renameMap:e,errors:t}}),[l,u,a]);return(0,n.jsx)(Qn,{open:null!==t,sx:{maxWidth:"80%",overflow:"hidden",maxHeight:"80%",display:"flex"},children:(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexWrap:"nowrap",flexDirection:"column",flexGrow:1,overflow:"hidden"},children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1,overflow:"hidden"},children:(0,n.jsx)(Y.Z,{sx:{overflow:"auto",maxHeight:"100%",p:1,border:e=>"1px solid ".concat(e.palette.divider),borderRadius:e=>"".concat(e.shape.borderRadius,"px")},children:(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexWrap:"nowrap"},children:[(0,n.jsx)(y.Z,{sx:{pt:2},children:l.map((e=>(0,n.jsxs)(Y.Z,{sx:{my:-.1,textAlign:"right"},children:[e,":"]},e)))}),(0,n.jsxs)(y.Z,{children:[(0,n.jsx)(T.Z,{multiline:!0,rows:l.length,value:c,onChange:e=>{d(e.target.value)}}),JSON.stringify(p)]})]})})}),(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexWrap:"nowrap"},children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(ce.Z,{color:"success",disabled:p.length>0,onClick:()=>{s(h),r()},children:"Сохранить"})}),(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(ce.Z,{color:"error",onClick:r,children:"Отменить"})})]})]})})},$n=o.memo(Jn);var Xn=r(6062),Kn=r(9149);const Yn=e=>{var{label:t,disabled:r,element:s}=e,o=(0,H._T)(e,["label","disabled","element"]);return(0,n.jsx)(Xn.Z,{control:(0,n.jsx)(Kn.Z,Object.assign({},o,{inputRef:s})),label:t,disabled:r})},es=(e=>{const t=t=>{var{value:r,setValue:s,isTouched:o=!0,setTouched:a=(()=>{}),onChange:l,onBlur:i,error:c}=t,d=(0,H._T)(t,["value","setValue","isTouched","setTouched","onChange","onBlur","error"]);const u=void 0!==l?l:e=>{s&&s(e.target.checked),a&&a(!0)},h=void 0!==i?i:()=>{a&&a(!0)},p=void 0===c?void 0:o?c:null,x=Object.assign({checked:r,onChange:u,onBlur:h,error:p},d);return(0,n.jsx)(e,Object.assign({},x))};return o.memo(t)})(o.memo(Yn)),ts=e=>{let{open:t,close:r,boxesBarcodes:s,mergeBarcodes:a}=e;const l=(0,o.useRef)(null),i=$(),[c,d]=X(!0,i),[u,h]=X([],i),p=(0,o.useCallback)((e=>{var t;h([...null!==(t=e.target.files)&&void 0!==t?t:[]])}),[h]),[x,m]=X({result:{},errors:[]},i);(0,o.useEffect)((()=>{const e=[],t=[];if(u.forEach((r=>{if(!/^[1-9][0-9]*\.txt$/.test(r.name))return void t.push("Файл '".concat(r.name,"' назван неправильно. Имя файла должно быть в виде '123.txt' и не должно начинаться с нуля"));const n=Number(r.name.split(".")[0]);e.map((e=>e.boxNum)).includes(n)?t.push("Коробка с номером ".concat(n,"(нумерована по файлу '").concat(r.name,"') уже получена из другого файла в выборке (").concat(r.name,"). Не должно быть нескольких файлов с одинаковым номером.")):r.size>2097152?t.push("Файл '".concat(r.name,"') имеет размер более ").concat(2..toFixed(2),"Мб (").concat((r.size/1024/1024).toFixed(2),"Мб), он слишком велик.")):e.push({file:r,boxNum:n})})),t.length>0)return void m({result:{},errors:t});const r=e.map((e=>{let{file:t,boxNum:r}=e;return new Promise(((e,r)=>{const n=new FileReader;n.readAsText(t),n.onload=()=>{const t=n.result;let r="";r=t instanceof ArrayBuffer?new TextDecoder("utf-8").decode(t):null!=t?t:"",e(r)},n.onerror=()=>{r(n.result)}})).then((e=>{const n=e.split("\r\n").filter((e=>""!==e)),s=n.filter((e=>!/^[0-9]{13,14}$/.test(e)));return{filename:t.name,boxNum:r,barcodes:n,errors:s.map((e=>"Некорректный баркод '".concat(e,"' найден в файле '").concat(t.name,"'")))}})).catch((e=>({filename:t.name,boxNum:r,barcodes:[],errors:["Ошибка чтения файла '".concat(t.name,"': ").concat(e)]})))}));let n=()=>{};return new Promise(((e,t)=>{n=()=>t("cancelled task on update"),Promise.all(r).then((t=>{e(t)})).catch((e=>{t(e)}))})).then((e=>{const t=e.reduce(((e,t)=>(e.push(...t.errors),e)),[]),r=e.reduce(((e,t)=>(e.push(...xr(t.barcodes)),e)),[]),n=mr(r);n.length>0&&n.forEach((r=>{const n=e.reduce(((e,t)=>(t.barcodes.indexOf(r)>-1&&e.push(t.filename),e)),[]);t.push("Штрихкод '".concat(r,"' найден в файлах '").concat(n.join("', '"),"'"))}));const s={result:{},errors:t};if(t.length>0)return s;const o=e.reduce(((e,t)=>(e[t.boxNum]=t.barcodes,e)),{});return s.result=o,s})).then((e=>{m(e)})).catch((e=>{console.error(e)})),n}),[u]);const{mergeData:f,mergeErrors:g}=(0,o.useMemo)((()=>{var e;const t={},r=[];if(x.errors.length>0)return{mergeData:t,mergeErrors:r};const n=[],o=[],a=Object.keys(s).map((e=>Number(e))),l=Object.keys(x.result).map((e=>Number(e))),i=xr([...a,...l]);for(let r=0;r<i.length;r++){const a=i[r],d=null!==(e=s[a])&&void 0!==e?e:[],u=x.result[a]?c?[...x.result[a]]:[...d,...x.result[a]]:[...d];n.push(...xr(u)),o.push({boxNum:a,barcodes:xr(u)}),l.indexOf(a)>-1&&(t[a]=x.result[a])}const d=mr(n);return d.length>0?(d.forEach((e=>{const t=o.reduce(((t,r)=>(r.barcodes.indexOf(e)>-1&&t.push(r.boxNum),t)),[]);r.push("При загрузке файлов штрихкод '".concat(e,"' окажется в коробках ").concat(t.join(", ")))})),{mergeData:{},mergeErrors:r}):{mergeData:t,mergeErrors:r}}),[x,s,c]),b=(0,o.useMemo)((()=>u.length<1?["Файлы для загрузки не выбраны"]:x.errors.length>0?x.errors:g.length>0?g:[]),[u,x,g]);return(0,n.jsx)(Qn,{open:t,sx:{maxWidth:"80%",overflow:"hidden",maxHeight:"80%",display:"flex"},children:(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexWrap:"nowrap",flexDirection:"column",flexGrow:1,overflow:"hidden"},children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1,overflow:"hidden"},children:(0,n.jsxs)(Y.Z,{sx:{overflow:"auto",maxHeight:"100%",p:1,border:e=>"1px solid ".concat(e.palette.divider),borderRadius:e=>"".concat(e.shape.borderRadius,"px")},children:[(0,n.jsxs)(ce.Z,{children:[(0,n.jsx)("input",{type:"file",multiple:!0,ref:l,style:{position:"absolute",width:"100%",height:"100%",opacity:0},onClick:()=>{l.current.value="",h([])},onChange:p}),"Выбрать файлы"]}),(0,n.jsx)(es,{value:c,setValue:d,label:c?"Заменить содержимое":"Добавить в коробки"}),JSON.stringify(b)]})}),(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexWrap:"nowrap"},children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(ce.Z,{color:"success",disabled:b.length>0,onClick:()=>{a(f,c),r()},children:"Загрузить"})}),(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(ce.Z,{color:"error",onClick:r,children:"Отменить"})})]})]})})},rs=o.memo(ts),ns=()=>{const{boxesData:e,addBox:t,removeBox:r,renameBoxes:s,loadBarcodesToBoxes:a}=Hn(),l=$(),[i,c]=X([],l),d=(0,o.useMemo)((()=>{const t={},r=Object.keys(e).map((e=>Number(e)));for(let n=0;n<r.length;n++){t[r[n]]=String(r[n]);const s=e[r[n]].wbCode;s&&(t[r[n]]+=" - "+s),t[r[n]]+=" ("+e[r[n]].barcodes.length+")"}return t}),[e]),u=(0,o.useMemo)((()=>Object.keys(e).map((e=>Number(e))).reduce(((t,r)=>(t[r]=e[r].wbCode,t)),{})),[e]),h=(0,o.useMemo)((()=>Object.keys(e).map((e=>Number(e))).reduce(((t,r)=>(t[r]=e[r].barcodes,t)),{})),[e]),[p,x]=X(null,l),m=(0,o.useCallback)((()=>{x(null)}),[x]),[f,g]=X(!1,l),b=(0,o.useCallback)((()=>{g(!1)}),[g]);return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexWrap:"nowrap",position:"relative",flexGrow:1,overflow:"hidden",flexBasis:200,flexShrink:1},children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1,overflow:"hidden",display:"flex"},children:(0,n.jsx)($r,{items:d,selectedItemIds:i,setSelectedItemIds:c,buttons:[{icon:(0,n.jsx)(Un.Z,{}),color:"info",action:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];x(t)}},{icon:(0,n.jsx)(At.Z,{}),color:"error",action:r}],idToString:String,stringToId:Number})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(ce.Z,{onClick:t,children:"Добавить коробку"})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(ce.Z,{onClick:()=>{g(!0)},children:"Загрузить из файла"})}),(0,n.jsx)($n,{renamingIds:p,close:m,rename:s,boxNamesMap:u}),(0,n.jsx)(rs,{open:f,close:b,boxesBarcodes:h,mergeBarcodes:a})]})},ss=o.memo(ns);var os=r(6446),as=r(7666),ls=r(9218);const is=()=>{const e=$(),{boxesData:t,addBox:r,removeBox:s}=Hn(),a=(0,o.useMemo)((()=>Object.keys(t).map((e=>Number(e)))),[t]),[l,i]=X(null,e),c=null===l?null:a.indexOf(l)>-1?l:null,d=(0,o.useMemo)((()=>null===c?null:t[c]),[t,c]),u=(0,o.useMemo)((()=>{var e;return null!==(e=null==d?void 0:d.barcodes)&&void 0!==e?e:[]}),[d]),h=(0,o.useMemo)((()=>u.reduce(((e,t,r)=>(e[String(r)]=t,e)),{})),[u]);return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexWrap:"nowrap",position:"relative",flexGrow:1},children:[(0,n.jsx)(y.Z,{children:(0,n.jsxs)(os.Z,{children:[(0,n.jsx)(as.Z,{id:"demo-simple-select-helper-label",children:"Номер коробки"}),(0,n.jsxs)(ls.Z,{labelId:"demo-simple-select-helper-label",id:"demo-simple-select-helper",value:null!=c?c:"",label:"Номер коробки",onChange:e=>{const t=e.target.value,r=t?Number(t):null;i(r)},children:[(0,n.jsx)(O.Z,{value:"",children:"-"}),a.map((e=>(0,n.jsx)(O.Z,{value:e,children:e},e)))]})]})}),(0,n.jsxs)(y.Z,{container:!0,sx:{flexGrow:1,flexWrap:"nowrap"},children:[(0,n.jsx)(y.Z,{children:(0,n.jsx)($r,{items:h,selectedItemIds:[],setSelectedItemIds:()=>{}})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)($r,{items:h,selectedItemIds:[],setSelectedItemIds:()=>{}})})]})]})},cs=o.memo(is),ds=()=>(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexGrow:1,flexDirection:"row",flexWrap:"nowrap",height:"100%"},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexBasis:"25em",flexShrink:0},children:(0,n.jsx)(ss,{})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexShrink:0,flexGrow:1},children:(0,n.jsx)(cs,{})})]}),us=o.memo(ds),hs=()=>(0,n.jsx)(_n,{children:(0,n.jsx)(us,{})}),ps=o.memo(hs),xs={date:{name:"Дата УПД",order:1},supplierId:{name:"ID поставщика",order:2},ozonId:{name:"ID Озон",order:3},price:{name:"цена",order:6,toPrintable:e=>e.toFixed(2)},amount:{name:"количество",order:5,toPrintable:e=>e.toFixed(0)},barcode:{name:"Штрихкод",order:4}},ms={code:{name:"КМ"}},fs=()=>{const e=(0,o.useRef)(null),{setData:t}=Ie(),{setData:r}=Ie(),s=$(),[a,l]=X([],s),[i,c]=X(null,s),d=(0,o.useCallback)((e=>{var t;l([...null!==(t=e.target.files)&&void 0!==t?t:[]])}),[l]);return(0,o.useEffect)((()=>{if(a.length<1)return void c(null);const e=a[0];let t;return new Promise(((r,n)=>{t=n;const s=new FileReader;s.readAsArrayBuffer(e),s.onload=()=>{new Promise((e=>e(s.result))).then((e=>{let t=new TextDecoder;const r=t.decode(e.slice(0,127)).match(/(?<=encoding=")[^"]+(?=")/i),n=r&&r[0]?r[0].toLowerCase():"utf-8";return t=new TextDecoder(n),t.decode(e)})).then((e=>{try{return js(e)}catch(t){throw e}})).catch((e=>{try{return vs(e)}catch(t){throw e}})).then((e=>{r(e)})).catch((()=>{n("invalid file format!")}))},s.onerror=()=>{n(s.result)}})).then((e=>c(e))),()=>{t()}}),[a,c]),(0,n.jsxs)(y.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1},spacing:2,children:[(0,n.jsx)(y.Z,{children:(0,n.jsxs)(ce.Z,{children:[(0,n.jsx)("input",{type:"file",multiple:!0,ref:e,style:{position:"absolute",width:"100%",height:"100%",opacity:0},onClick:()=>{e.current.value="",l([])},onChange:d}),"Выбрать файлы"]})}),(0,n.jsxs)(y.Z,{container:!0,sx:{flexGrow:1},children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(ce.Z,{disabled:null===i,onClick:()=>{if(!i)return;let e="";e="УПД",t({filename:"УПД",headers:xs,rows:gs(i)})},children:"данные по продуктам в таблицу"})}),(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(ce.Z,{disabled:null===i,onClick:()=>{if(!i)return;let e="";e="УПД",r({filename:"УПД",headers:ms,rows:bs(i)})},children:"данные по кодам маркировки в таблицу"})})]})]})},gs=e=>e.productLines.map((t=>Object.assign(Object.assign({},t),{date:e.date}))),bs=e=>e.productLines.reduce(((e,t)=>(e.push(...t.codes.map((e=>({code:e})))),e)),[]),js=e=>{var t;const r=(new DOMParser).parseFromString(e,"application/xml"),n={date:null!==(t=r.getElementsByTagName("СвСчФакт")[0].getAttribute("ДатаСчФ"))&&void 0!==t?t:"",productLines:[]},s=r.getElementsByTagName("СведТов");for(let e=0;e<s.length;e++){const t=s[e],r=[...t.getElementsByTagName("КИЗ")].map((e=>{var t;return null!==(t=e.childNodes[0].nodeValue)&&void 0!==t?t:""})),o={supplierId:t.getElementsByTagName("ДопСведТов")[0].getAttribute("КодТов"),ozonId:t.getElementsByTagName("ИнфПолФХЖ2")[0].getAttribute("Значен"),price:Number(t.getAttribute("ЦенаТов")),amount:Number(t.getAttribute("КолТов")),barcode:r.length>0?r[0].slice(3,16):"",codes:r};n.productLines.push(o)}return n},vs=e=>{var t;const r=(new DOMParser).parseFromString(e,"application/xml"),n={date:null!==(t=r.getElementsByTagName("СвСчФакт")[0].getAttribute("ДатаСчФ"))&&void 0!==t?t:"",productLines:[]},s=r.getElementsByTagName("СведТов");for(let e=0;e<s.length;e++){const t=s[e],r=[...t.getElementsByTagName("КИЗ")].map((e=>{var t;return null!==(t=e.childNodes[0].nodeValue)&&void 0!==t?t:""})),o={supplierId:t.getElementsByTagName("ДопСведТов")[0].getAttribute("АртикулТов"),ozonId:t.getAttribute("НаимТов"),price:Number(t.getAttribute("ЦенаТов")),amount:Number(t.getAttribute("КолТов")),barcode:t.getElementsByTagName("ДопСведТов")[0].getAttribute("КодТов"),codes:r};n.productLines.push(o)}return n},ws=()=>(0,n.jsx)(fs,{}),ys=o.memo(ws),Os=(e=>{const t=t=>{var{value:r,setValue:s,isTouched:o=!0,setTouched:a=(()=>{}),onChange:l,onBlur:i,error:c}=t,d=(0,H._T)(t,["value","setValue","isTouched","setTouched","onChange","onBlur","error"]);const u=void 0!==l?l:e=>{s&&s(e.target.value),a&&a(!0)},h=void 0!==i?i:()=>{a&&a(!0)},p=void 0===c?void 0:o?c:null,x=Object.assign({value:r,onChange:u,onBlur:h,error:p},d);return(0,n.jsx)(e,Object.assign({},x))};return o.memo(t)})((e=>{const t=t=>{var{type:r="text",variant:s="outlined",color:a="primary",size:l="small",fullWidth:i=!0,error:c,InputLabelProps:d,disabled:u,helperText:h}=t,p=(0,H._T)(t,["type","variant","color","size","fullWidth","error","InputLabelProps","disabled","helperText"]);const x=(0,o.useMemo)((()=>(null!=d?d:"date"===r)?{shrink:!0}:void 0),[d,r]),m=(0,o.useMemo)((()=>!u&&Boolean(c)),[u,c]),f=(0,o.useMemo)((()=>void 0===c?h:null===c?h||" ":c||h||" "),[c,h]),g=Object.assign({type:r,variant:s,color:a,size:l,fullWidth:i,InputLabelProps:x,disabled:u,error:m,helperText:f},p);return(0,n.jsx)(e,Object.assign({},g))};return o.memo(t)})(T.Z)),Zs={й:"q",ц:"w",у:"e",к:"r",е:"t",н:"y",г:"u",ш:"i",щ:"o",з:"p",х:"[",ъ:"]",ф:"a",ы:"s",в:"d",а:"f",п:"g",р:"h",о:"j",л:"k",д:"l",ж:";",э:"'",я:"z",ч:"x",с:"c",м:"v",и:"b",т:"n",ь:"m",б:",",ю:".",".":"/",Й:"Q",Ц:"W",У:"E",К:"R",Е:"T",Н:"Y",Г:"U",Ш:"I",Щ:"O",З:"P",Х:"{",Ъ:"}",Ф:"A",Ы:"S",В:"D",А:"F",П:"G",Р:"H",О:"J",Л:"K",Д:"L",Ж:":",Э:'"',Я:"Z",Ч:"X",С:"C",М:"V",И:"B",Т:"N",Ь:"M",Б:"<",Ю:">",",":"?",'"':"@","№":"#",";":"$",":":"^","?":"&"},ks=(e=>{const t=t=>{var{variant:r="contained",fullWidth:s=!0}=t,o=(0,H._T)(t,["variant","fullWidth"]);const a=Object.assign({variant:r,fullWidth:s},o);return(0,n.jsx)(e,Object.assign({},a))};return o.memo(t)})(ce.Z),Cs=e=>{let{isOpen:t,close:r,setPossibleCodes:s}=e;const a=$(),[l,i]=X(void 0,a);(0,o.useEffect)((()=>{void 0!==l&&s(l.replaceAll(/\s+/giu," ").split(" ").map((e=>{try{return{base64:e,raw:(t=e,decodeURIComponent(Array.prototype.map.call(atob(t),(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")))}}catch(e){return{base64:"",raw:""}}var t})).filter((e=>""!==e.base64&&""!==e.raw)))}),[l,s]);const c=(0,o.useCallback)((()=>{r(),i(void 0)}),[r,i]);return(0,n.jsx)(Qn,{open:t,backdropProps:{unmountOnExit:!0,appear:!0,mountOnEnter:!0},sx:{width:"80%",overflow:"hidden",height:"80%",display:"flex"},children:(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexGrow:1,flexDirection:"column",flexWrap:"nowrap"},children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1,display:"flex",flexBasis:400},children:(0,n.jsx)(Os,{multiline:!0,label:"Допустимые коды (base64)",sx:{flexGrow:1,"& .MuiInputBase-root":{flexGrow:1,flexDirection:"column"}},inputProps:{sx:{flexGrow:1,flexBasis:0,height:0,overflow:"auto"},style:{flexGrow:1,flexBasis:0,height:0,overflow:"auto"}},value:null!=l?l:"",setValue:i})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(ks,{onClick:c,children:"Закрыть"})})]})})},Is=o.memo(Cs),Es=",",Ss={base64:{name:"Исходные коды (base64)",order:1},decoded:{name:"Коды",order:2},decodedWithoutGS:{name:"Коды без спецсимволов",order:3}},Ts={search:{name:"Поисковый запрос",order:1},result:{name:"Найденные коды",order:2},resultWithoutGS:{name:"Коды без спецсимволов",order:3},result1c:{name:"Коды в формате 1с",order:4},resultBase64:{name:"Коды в base64",order:5}},Ps=()=>{const{setData:e}=Ie(),{setData:t}=Ie(),r=$(),[s,a]=X(!0,r),l=(0,o.useCallback)((()=>{a(!1)}),[a]),[i,c]=X("",r),[d,u]=X([],r),h=(0,o.useMemo)((()=>i.replaceAll(/\s+/giu," ").split(" ").filter((e=>""!==e))),[i]),p=(0,o.useMemo)((()=>({search:h,resultMap:xr(h).reduce(((e,t)=>{const r=/[а-я]/iu.test(t)?(n=t,Array.from(n).reduce(((e,t)=>{var r;return e+(null!==(r=Zs[t])&&void 0!==r?r:t)}),"")):t;var n;return e[t]=d.filter((e=>e.raw.replaceAll(/\u{001d}/gu,"").includes(r))).map((e=>e.raw)),e}),{})})),[h,d]);return(0,o.useEffect)((()=>{e({headers:Ts,rows:p.search.map((e=>({search:e,result:p.resultMap[e].join(Es),resultWithoutGS:p.resultMap[e].map((e=>e.replaceAll(/\u{001d}/gu,""))).join(Es),result1c:p.resultMap[e].map((e=>{})).join(Es),resultBase64:p.resultMap[e].map((e=>btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))}))))).join(Es)})))})}),[p,e]),(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:.1,flexBasis:300},children:[(0,n.jsxs)(y.Z,{container:!0,children:[(0,n.jsx)(y.Z,{children:(0,n.jsx)(Os,{label:"Введено",value:d.length.toString()})}),(0,n.jsx)(y.Z,{sx:{display:"flex"},children:(0,n.jsx)(ks,{onClick:()=>{a(!0)},children:"ввести коды для поиска"})}),(0,n.jsx)(y.Z,{sx:{display:"flex"},children:(0,n.jsx)(ks,{onClick:()=>{t({headers:Ss,rows:d.map((e=>({base64:e.base64,decoded:e.raw,decodedWithoutGS:e.raw.replaceAll(/\u{001d}/gu,"")})))})},children:"заполнить таблицу загруженными кодами"})})]}),(0,n.jsx)(y.Z,{sx:{flexGrow:1,display:"flex"},children:(0,n.jsx)(Os,{multiline:!0,label:"Искать",sx:{flexGrow:1,"& .MuiInputBase-root":{flexGrow:1,flexDirection:"column"}},inputProps:{sx:{flexGrow:1,flexBasis:0,height:0,overflow:"auto"},style:{flexGrow:1,flexBasis:0,height:0,overflow:"auto"}},value:i,setValue:c})}),(0,n.jsx)(Is,{isOpen:s,close:l,setPossibleCodes:u})]})},Ds=o.memo(Ps),Ms=()=>(0,n.jsx)(Ds,{}),Bs=o.memo(Ms),Gs=[75,110,134.5,150,300,600,1200,1800,2400,4800,7200,9600,14400,19200,31250,38400,56e3,57600,76800,115200,128e3,230400,25e4,256e3],Ns="ComScannerConfig",As={port:void 0,autoConnect:!0,connectionSpeed:115200},Rs=()=>{const e=$(),[t]=X((()=>"serial"in navigator),e),[r,s]=X(null,e),a=(0,o.useCallback)((e=>{s((t=>{if(t){if(e){const r=t.getInfo(),n=e.getInfo();if(r.usbVendorId===n.usbVendorId&&r.usbProductId===n.usbProductId)return t}t.close()}return e}))}),[]),[l,i]=X((()=>{var e;try{return zs(JSON.parse(null!==(e=localStorage.getItem(Ns))&&void 0!==e?e:""))}catch(e){return As}}),e),[c,d]=X(!1,e),u=(0,o.useCallback)(((e,t)=>{i((r=>Object.assign(Object.assign({},r),{[e]:t})))}),[i]);(0,o.useEffect)((()=>{localStorage.setItem(Ns,JSON.stringify(l)),l.autoConnect&&(d(!1),navigator.serial.getPorts().then((e=>{console.log("ports get worked",e);const t=e.filter((e=>{var t,r;const n=e.getInfo();return n.usbVendorId===(null===(t=l.port)||void 0===t?void 0:t.usbVendorId)&&n.usbProductId===(null===(r=l.port)||void 0===r?void 0:r.usbProductId)}));t.length>0&&a(t[0])})))}),[l,a]);const h=(0,o.useCallback)((()=>{navigator.serial.requestPort().then((e=>{u("port",e.getInfo())})).catch((()=>{a(null)}))}),[u,a]);return(0,o.useEffect)((()=>{if(!t)return;const e=e=>{a(e.target)},r=()=>{a(null)};return navigator.serial.addEventListener("connect",e),navigator.serial.addEventListener("disconnect",r),()=>{navigator.serial.removeEventListener("connect",e),navigator.serial.removeEventListener("disconnect",r)}}),[t,a]),(0,o.useEffect)((()=>{l.autoConnect&&r&&r.open({baudRate:l.connectionSpeed,bufferSize:255,dataBits:8,flowControl:"none",parity:"none",stopBits:1}).then((e=>{console.log("port open"),d(!0),qs(r)}))}),[l,r]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ks,{onClick:h,children:"1"}),(0,n.jsx)(w.j3,{})]})},Ls=o.memo(Rs),zs=e=>{if(!e)return As;if("object"!=typeof e)return As;const t=Object.assign(Object.assign({},As),{port:Ws(e)});return"connectionSpeed"in e&&Gs.indexOf(e.connectionSpeed)>-1&&(t.connectionSpeed=e.connectionSpeed),"autoConnect"in e&&"boolean"==typeof e.autoConnect&&(t.autoConnect=e.autoConnect),t},Ws=e=>{if(!("port"in e))return;const t=e.port;if(t&&"object"!=typeof t)return;if(void 0===t)return;if(!t)return;const r=t;return{usbVendorId:"number"==typeof(null==r?void 0:r.usbVendorId)?null==r?void 0:r.usbVendorId:void 0,usbProductId:"number"==typeof(null==r?void 0:r.usbProductId)?null==r?void 0:r.usbProductId:void 0}},qs=e=>(0,H.mG)(void 0,void 0,void 0,(function*(){for(;e.readable;){const t=e.readable.getReader();try{for(;;){const{value:e,done:r}=yield t.read();if(r)break;console.log(e)}}catch(e){}finally{t.releaseLock()}}})),Fs=[{path:"/",Component:E,ErrorBoundary:S,children:[{ErrorBoundary:S,children:[{index:!0,element:(0,n.jsx)(w.Fg,{to:"/supply"})},{Component:vn,children:[{name:"Карточки",order:2,path:"cards",Component:Ut},{path:"supply",name:"Поставки",order:1,Component:sn},{name:"Разбор УПД",order:150,path:"upd",Component:ys},{name:"Реставрация КМ",order:40,path:"mc",Component:Bs}]}]},{Component:Ls,children:[{name:"Сборка поставки",order:1.5,path:"collect_supply",Component:ps},{path:"check",children:[{name:"Проверка карточек",order:100,path:"cards",Component:zn}]}]},{path:"api",children:[{name:"Настройки",order:998,path:"config",Component:_},{name:"Статус",order:999,path:"status",Component:Mn}]},{path:"*",Component:()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Z.Z,{variant:"inherit",children:"Такой страницы не существует"}),(0,n.jsx)(v.OL,{to:"/",children:(0,n.jsx)(Z.Z,{variant:"inherit",children:"На главную"})})]})}]}],_s=Object.keys({caseSensitive:"caseSensitive",path:"path",id:"id",loader:"loader",action:"action",hasErrorBoundary:"hasErrorBoundary",shouldRevalidate:"shouldRevalidate",handle:"handle",index:"index",children:"children",element:"element",errorElement:"errorElement",Component:"Component",ErrorBoundary:"ErrorBoundary",lazy:"lazy"}),Hs=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.reduce(((e,r)=>{var n;const s=null!==(n=r.path)&&void 0!==n?n:"",o="/"===s.substring(0,1)?s:"/"===t.substring(t.length-1)?t+s:t+"/"+s,a=Object.keys(r),l={};let i=!1;for(let e=0;e<a.length;e++)_s.indexOf(a[e])<0&&(l[a[e]]=r[a[e]],i=!0);if(i&&(l.path=o,e.push(l)),r.children){const t=Hs(r.children,o);t.length&&e.push(...t)}return e}),[])},Us=e=>{var t;const r={};for(let n=0;n<e.length;n++){const s=null!==(t=e[n].menuId)&&void 0!==t?t:e[n].path;if(r[s])throw new Error('duplicate menu item id "'+s+'" found!');r[s]=e[n]}for(const e in r){if(!Object.hasOwn(r,e))continue;const t=r[e].parentId;if(t){if(t==e)throw new Error('circular reference id to parent id "'+t+'" found in menu');if(!r[t])throw new Error('no parent id "'+t+'" found in menu');const n=r[t];n.children||(n.children=[]),n.children.push(r[e])}}const n=[];for(const e in r)Object.hasOwn(r,e)&&(r[e].parentId||n.push(r[e]));return n},Vs=e=>e.map((e=>{const{parentId:t,children:r,menuId:n}=e,s=(0,H._T)(e,["parentId","children","menuId"]);return void 0!==n&&(s.id=n),e.children&&(s.children=Vs(e.children)),s})),Qs=e=>{const t=e.toSorted(Js);for(let e=0;e<t.length;e++)t[e].children&&(t[e].children=Qs(t[e].children));return t},Js=(e,t)=>{var r,n;const s=null!==(r=e.order)&&void 0!==r?r:0,o=null!==(n=t.order)&&void 0!==n?n:0;return s>o?1:o>s?-1:e.id>t.id?1:t.id>e.id?-1:e.name>t.name?1:t.name>e.name?-1:0},$s=e=>e.map((e=>{const t={};for(let r=0;r<_s.length;r++){const n=_s[r];n in e&&(t[n]=e[n])}return"children"in e&&(t.children=$s(e.children)),t})),Xs=$s,Ks=o.createContext([]),Ys=o.createContext([]),eo=Xs(Fs),to=(e=>{const t=Hs(e),r=Us(t),n=Vs(r);return Qs(n)})(Fs),ro=(0,v.cP)(eo),no=()=>(0,n.jsx)(Ks.Provider,{value:eo,children:(0,n.jsx)(Ys.Provider,{value:to,children:(0,n.jsx)(v.pG,{router:ro})})}),so=()=>(0,o.useContext)(Ys);var oo=r(9164),ao=r(6720),lo=r(9617);const io=function(){const e="#1E00B3",t={palette:{mode:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light",primary:{light:(0,Tt.$n)(e,.3),main:e,contrastText:"#fff"},text:{primary:(0,Tt._j)(e,.15),secondary:(0,Tt._j)(e,.3),disabled:(0,Tt.Fq)(e,.5)},divider:(0,Tt.Fq)(e,.5),action:{hover:(0,Tt.Fq)(e,.15)}}},r=(0,lo.Z)(t),n={components:{MuiBackdrop:{styleOverrides:{root:{backgroundColor:(0,Tt.Fq)(r.palette.background.default,.7),backdropFilter:"blur(5px)"},invisible:{backgroundColor:"transparent",backdropFilter:"none"}}},MuiFormControl:{defaultProps:{size:"small",fullWidth:!0}},MuiButton:{defaultProps:{variant:"contained",size:"small",fullWidth:!0}},MuiTextField:{defaultProps:{variant:"outlined",size:"small",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{notchedOutline:{borderColor:r.palette.divider}}},MuiPaper:{defaultProps:{elevation:5}},MuiTablePagination:{styleOverrides:{toolbar:{display:"flex",flexWrap:"wrap",justifyContent:"end"}}}}};return(0,lo.Z)(r,n)}(),co=e=>{let{children:t=null}=e;return(0,n.jsxs)(oo.Z,{theme:io,children:[(0,n.jsx)(ao.ZP,{}),t]})},uo=e=>{let{children:t=null}=e;return(0,n.jsx)(me,{children:(0,n.jsx)(zr,{children:(0,n.jsx)(z,{children:(0,n.jsx)(Ce,{children:(0,n.jsx)(we,{children:(0,n.jsx)(hr,{children:(0,n.jsx)(Kt,{children:(0,n.jsx)(tt,{children:t})})})})})})})})},ho=o.memo(uo);(0,s.s)(document.getElementById("root")).render((0,n.jsx)(o.StrictMode,{children:(0,n.jsx)((()=>(0,n.jsx)(co,{children:(0,n.jsx)(ho,{children:(0,n.jsx)(no,{})})})),{})}))},1424:(e,t,r)=>{r.d(t,{Z:()=>l});var n=r(8081),s=r.n(n),o=r(3645),a=r.n(o)()(s());a.push([e.id,"* {\n    box-sizing: border-box;\n}\n\nhtml {\n    position: relative;\n    overflow: hidden;\n}\n\nhtml, body {\n    height: 100%;\n    width: 100%;\n    padding: 0;\n    margin: 0;\n}\n\ndiv#root {\n    min-height: 100%;\n    height: auto;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    overflow: auto;\n}\n\nbody {\n    -webkit-user-select: none;\n    -moz-user-select: -moz-none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    overflow: auto;\n}\n\ninput,\ntextarea,\nli *,\ntable,\n.selectable {\n    -moz-user-select: text;\n    user-select: text;\n}\n",""]);const l=a}},e=>{e.O(0,[514,207],(()=>(4809,e(e.s=4809)))),e.O()}]);
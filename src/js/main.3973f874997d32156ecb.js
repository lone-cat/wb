"use strict";(self.webpackChunkwb=self.webpackChunkwb||[]).push([[179],{7120:(e,t,r)=>{var n=r(5893),s=r(745),o=r(7294),a=(r(9701),r(2162),r(8247),r(4877),r(3379)),i=r.n(a),l=r(7795),c=r.n(l),d=r(569),u=r.n(d),h=r(3565),p=r.n(h),x=r(9216),m=r.n(x),f=r(4589),g=r.n(f),j=r(1424),v={};v.styleTagTransform=g(),v.setAttributes=p(),v.insert=u().bind(null,"head"),v.domAPI=c(),v.insertStyleElement=m(),i()(j.Z,v),j.Z&&j.Z.locals&&j.Z.locals;var b=r(9655),w=r(9250),y=r(344),O=r(2433),I=r(2658),Z=r(2599);const k=()=>{const e=yn(),{items:t}=(e=>{const t=(0,w.UO)(),r=(0,w.TH)(),n=(0,w.HJ)(),s=(0,o.useMemo)((()=>n.location?n.location.pathname:r.pathname),[n.location,r.pathname]),a=(0,o.useMemo)((()=>e.map((e=>{var t;const r=null!==(t=e.defaultParams)&&void 0!==t?t:{},n=(0,Z.Gn)(e.path,r);return Object.assign(Object.assign({},e),{pattern:e.path,defaultParams:r,path:n})}))),[e]),i=(0,o.useMemo)((()=>a.map((e=>{const r=(0,Z.Gn)(e.pattern,Object.assign(Object.assign({},e.defaultParams),t)),n=Boolean((0,Z.LX)(r,s));return Object.assign(Object.assign({},e),{active:n})}))),[a,s,n]),l=(0,o.useMemo)((()=>i.map((e=>Object.assign(Object.assign({},e),{previous:e.path===r.pathname})))),[i,s,n]),{activeItem:c,activeIndex:d}=(0,o.useMemo)((()=>{for(let e=0;e<l.length;e++)if(l[e].active)return{activeItem:l[e],activeIndex:e};return{activeItem:null,activeIndex:null}}),[l]);return{items:l,active:c,index:d}})(e);return(0,n.jsx)(y.Z,{container:!0,sx:{backgroundColor:"primary.main",color:"primary.contrastText",px:2},children:t.map((e=>{const t=e.active;return(0,n.jsx)(O.Z,{component:t?"div":b.OL,to:t?void 0:e.path,children:(0,n.jsx)(I.Z,{variant:"inherit",children:e.name})},e.path)}))})};var C=r(3906);const E=()=>(0,n.jsxs)(y.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1,overflow:"hidden",p:1},children:[(0,n.jsx)(y.Z,{disableEqualOverflow:!1,children:(0,n.jsx)(C.Z,{sx:{mx:-2,mt:-2,p:1},children:(0,n.jsx)(k,{})})}),(0,n.jsx)(y.Z,{disableEqualOverflow:!1,sx:{display:"flex",flexGrow:1,flexDirection:"column",width:"100%",position:"relative",p:1},children:(0,n.jsx)(w.j3,{})})]}),S=o.memo(E),T=()=>((0,w.lk)(),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.Z,{variant:"inherit",children:"Что то пошло не так..."}),(0,n.jsx)(b.OL,{to:"/",children:(0,n.jsx)(I.Z,{variant:"inherit",children:"На главную"})})]}));var P=r(9542);const D=["standard","statistics"],M=D.reduce(((e,t)=>(e[t]=t,e)),{}),L="tokens",q="servers",G=D.reduce(((e,t)=>(e[t]="",e)),{}),R={[M.standard]:"https://suppliers-api.wildberries.ru",[M.statistics]:"https://statistics-api.wildberries.ru"},B=D.reduce(((e,t)=>(e[t]={token:"",server:"",setToken:()=>{},setServer:()=>{},ready:!1},e)),{}),z=o.createContext(B),A=e=>{let{children:t=null}=e;const[r,s]=(0,o.useState)((()=>{const e=(()=>{var e;const t=null!==(e=localStorage.getItem(L))&&void 0!==e?e:"";let r;try{if(r=JSON.parse(t),"object"!=typeof r)throw new Error("invalid storage value")}catch(e){r={}}const n=r;return D.reduce(((e,t)=>{const r=n[t];return e[t]="string"==typeof r?r:G[t],e}),{})})(),t=(()=>{var e;const t=null!==(e=localStorage.getItem(q))&&void 0!==e?e:"";let r;try{if(r=JSON.parse(t),"object"!=typeof r)throw new Error("invalid storage value")}catch(e){r={}}const n=r;return D.reduce(((e,t)=>{const r=n[t];return e[t]="string"==typeof r?r:R[t],e}),{})})();return D.reduce(((r,n)=>(r[n]={token:e[n],server:t[n]},r)),{})})),a=(0,o.useCallback)((e=>t=>r=>{s((n=>n[t][e]===r?n:Object.assign(Object.assign({},n),{[t]:Object.assign(Object.assign({},n[t]),{[e]:r})})))}),[s]),i=(0,o.useMemo)((()=>D.reduce(((e,t)=>(e[t]=""!==r[t].token&&""!==r[t].server,e)),{})),[r]),l=(0,o.useMemo)((()=>D.reduce(((e,t)=>(e[t]=Object.assign(Object.assign({},r[t]),{ready:i[t],setToken:a("token")(t),setServer:a("server")(t)}),e)),{})),[r,i,a]);return(0,o.useEffect)((()=>{const e=D.reduce(((e,t)=>(e[t]=r[t].token,e)),{}),t=D.reduce(((e,t)=>(e[t]=r[t].server,e)),{});(e=>{localStorage.setItem(L,JSON.stringify(e))})(e),(e=>{localStorage.setItem(q,JSON.stringify(e))})(t)}),[r]),(0,n.jsx)(z.Provider,{value:l,children:t})},N=o.memo(A),F=()=>(0,o.useContext)(z),W=()=>{const e=F();return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",justifyContent:"center"},children:[(0,n.jsx)(y.Z,{children:(0,n.jsx)(P.Z,{label:"Api ключ",value:e.standard.token,onChange:t=>{e.standard.setToken(t.target.value)},error:!e.standard.token})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(P.Z,{label:"Api ключ статистики",value:e.statistics.token,onChange:t=>{e.statistics.setToken(t.target.value)},error:!e.statistics.token})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(P.Z,{label:"Адрес сервера",value:e.standard.server,onChange:t=>{e.standard.setServer(t.target.value)},error:!e.standard.server})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(P.Z,{label:"Адрес сервера статистики",value:e.statistics.server,onChange:t=>{e.statistics.setServer(t.target.value)},error:!e.statistics.server})})]})},H=()=>(0,n.jsx)(W,{}),U=o.memo(H),_="cards",Q=new Date,J={cards:{fromList:[],byVendorIds:[]},setCards:()=>{},lastOperationStartDate:Q,startOperation:()=>{},lastOperationError:null,setLastOperationError:()=>{},clearLastOperationError:()=>{}},V=o.createContext(J),X=e=>{let{children:t}=e;const[r,s]=(0,o.useState)(Q),[a,i]=(0,o.useState)(null),[l,c]=(0,o.useState)((()=>{const e=localStorage.getItem(_);if(e)try{return JSON.parse(e)}catch(e){return J.cards}return J.cards})),d=(0,o.useMemo)((()=>({cards:l,setCards:c,lastOperationStartDate:r,startOperation:()=>{i(null),s(new Date)},lastOperationError:a,setLastOperationError:e=>{i(e)},clearLastOperationError:()=>{i(null)}})),[l,c,r,s,a,i]);return(0,o.useEffect)((()=>{localStorage.setItem(_,JSON.stringify(l))}),[l]),(0,n.jsx)(V.Provider,{value:d,children:t})},$=o.memo(X),K=()=>(0,o.useContext)(V);var Y=r(2574);const ee={data:{headers:{},rows:[]},setData:()=>{}},te=o.createContext(ee),re=e=>{let{children:t}=e;const[r,s]=(0,o.useState)(ee.data),a=(0,o.useMemo)((()=>({data:r,setData:s})),[r,s]);return(0,n.jsx)(te.Provider,{value:a,children:t})},ne=o.memo(re),se=()=>(0,o.useContext)(te),oe={wbId:{name:"Артикул WB",toPrintable:e=>e.toString()},supplierId:{name:"Артикул поставщика"},sizeWb:{name:"Размер"},barcode:{name:"Штрихкод"}},ae=e=>{let{cards:t}=e;const{setData:r}=se(),s=(0,o.useCallback)((()=>{const e=t.byVendorIds.reduce(((e,t)=>(e.push(...t.sizes.map((e=>(1!==e.skus.length&&console.error("у товара ".concat(t.vendorCode,"(wbId: ").concat(t.nmID,") у размера ").concat(e.techSize,"(").concat(e.wbSize,") количество штрихкодов ").concat(e.skus.length,"!")),{wbId:t.nmID,supplierId:t.vendorCode,sizeWb:e.techSize,barcode:e.skus.join(",")})))),e)),[]);r({filename:"cards",headers:oe,rows:e})}),[t]);return(0,n.jsx)(Y.Z,{onClick:s,children:"Заполнить таблицу штрихкодами карточек"})},ie={pending:"ожидает",done:"выполнено",error:"ошибка"},le=class{constructor(e){this.intervalGenerator=e,this.queue=[],this.timeoutHandler=null}rejectTasksById(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Error("group task fail");const r=this.queue.filter((t=>t.groupId===e)),n=r.length;return r.forEach((e=>{e.task.fail(t)})),this.queue=this.queue.filter((t=>t.groupId!==e)),n}addTask(e,t){let r=()=>{},n=()=>{};const s=new Promise(((e,t)=>{r=()=>e(void 0),n=t})).then((()=>e()));return this.pushToQueue({task:{run:r,fail:n},groupId:t}),s.catch((e=>{throw this.rejectTasksById(t),e}))}pushToQueue(){this.queue.length<1&&null===this.timeoutHandler&&setTimeout((()=>{this.runTask()}),100),this.queue.push(...arguments)}runTask(){if(null!==this.timeoutHandler)return;const e=this.queue.shift();e?(e.task.run(),this.timeoutHandler=setTimeout((()=>{this.timeoutHandler=null,this.runTask()}),this.intervalGenerator())):this.timeoutHandler=null}},ce=class{constructor(e){this.intervalGenerator=e,this.queueMap={}}addTask(e,t,r){return this.ensureQueueMapHasKey(e),this.queueMap[e].addTask(t,r).catch((e=>{throw this.rejectTasksById(r,new Error("group task fail")),e}))}rejectTasksById(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Error("group task fail");return Object.keys(this.queueMap).reduce(((r,n)=>r+this.queueMap[n].rejectTasksById(e,t)),0)}ensureQueueMapHasKey(e){this.queueMap[e]||(this.queueMap[e]=new le(this.intervalGenerator))}},de=function*(){let e=0,t=0,r=0;for(;;)yield"".concat((new Date).getTime(),"-").concat(r,"-").concat(t,"-").concat(e),e++,e===Number.MAX_SAFE_INTEGER&&(t++,e=0),t===Number.MAX_SAFE_INTEGER&&(r++,t=0),r===Number.MAX_SAFE_INTEGER&&(r=0)}(),ue=()=>de.next().value,he=function*(){for(;;)yield 3e3*Math.random()+2e3}(),pe={[M.standard]:()=>he.next().value,[M.statistics]:()=>6e4},xe=[M.standard],me=(e,t)=>t.created.getTime()-e.created.getTime()||(e.id<t.id?1:e.id>t.id?-1:0);var fe=r(7582);const ge=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";const r=[],n=Object.keys(e);for(let s=0;s<n.length;s++){const o=n[s],a=e[o],i=t,l=(a[i],(0,fe._T)(a,["symbol"==typeof i?i:i+""]));r.push(Object.assign(Object.assign({},l),{[t]:o}))}return r},je={[M.standard]:new ce(pe.standard),[M.statistics]:new ce(pe.statistics)},ve={},be=new Error("api queue is not ready"),we=e=>({queue:[],addTask:e=>Promise.reject(be),addTasks:()=>Promise.reject(be)}),ye=o.createContext(we),Oe=e=>{let{children:t}=e;const r=F(),[s,a]=(0,o.useState)(ve),i=(0,o.useCallback)(((e,t,r,n)=>{const s=ue(),o=new Date;return a((a=>{const i=Object.assign({},a);return i[s]={component:e,client:t,endpoint:r,created:o,title:n,status:ie.pending,statusDate:o},i})),s}),[a,ue]),l=(0,o.useCallback)(((e,t)=>{a((r=>r[e].status===t?r:Object.assign(Object.assign({},r),{[e]:Object.assign(Object.assign({},r[e]),{status:t,statusDate:new Date})})))}),[a]),c=(0,o.useCallback)((e=>function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ue();const s=t.client,o=i(e,s,t.endpoint,t.title),a=-1===xe.indexOf(s)?t.endpoint:"";return je[t.client].addTask(a,(()=>t.request(r[s].server,r[s].token)),n).catch((e=>{throw D.forEach((e=>je[e].rejectTasksById(n))),l(o,ie.error),e})).then((e=>(l(o,ie.done),e)))}),[r,ue,a]),d=(0,o.useCallback)((e=>function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ue();const n=t.map((t=>c(e)(t,r)));return Promise.all(n)}),[c,ue]),u=(0,o.useCallback)((e=>({queue:ge(s),addTask:c(e),addTasks:d(e)})),[s,c,d]);return(0,n.jsx)(ye.Provider,{value:u,children:t})},Ie=o.memo(Oe),Ze=e=>(0,o.useContext)(ye)(e);class ke extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Ошибка сети")}}class Ce extends ke{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Таймаут запроса")}}class Ee extends ke{constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Неспецифический код HTTP ответа"),this.serverResponse=e}}class Se extends Ee{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Неизвестная ошибка сервера")}}class Te extends Ee{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Неизвестная ошибка запроса")}}class Pe extends Te{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Некорректный запрос")}}class De extends Te{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Пользователь не аутентифицирован")}}class Me extends Te{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Доступ запрещен")}}class Le extends Te{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Ресурс не найден")}}class qe extends Se{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Внутренняя ошибка сервера")}}class Ge extends Se{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сервер временно не доступен")}}class Re extends Se{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сервер не отвечает")}}class Be extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Ответ сервера имеет неверный формат")}}const ze={},Ae=(15e3,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=Object.assign(Object.assign({},ze),t);return new Promise(((t,n)=>{let s=!1;const o=setTimeout((()=>{s=!0,n(new Ce)}),15e3);return fetch(e,r).finally((()=>{s||clearTimeout(o)})).then((e=>t(e))).catch((()=>{n(new ke)}))})).then((e=>{if(e.ok&&200===e.status)return e;if(400===e.status)throw new Pe(e);if(401===e.status)throw new De(e);if(403===e.status)throw new Me(e);if(404===e.status)throw new Le(e);if(500===e.status)throw new qe(e);if(502===e.status)throw new Re(e);if(503===e.status)throw new Ge(e);if(e.status>=500)throw new Se(e);if(e.status>=400)throw new Te(e);throw new Ee(e)}))});const Ne=e=>{const t={},r=e.split("&");for(let e=0;e<r.length;e++){const n=r[e].split("=");if(n.length>2)throw new Error("invalid query passed for convertQueryToObject");const s=decodeURIComponent(n[0]);2===n.length?t[s]=decodeURIComponent(n[1]):t[s]=""}return t},Fe=e=>{const t=[],r=Object.keys(e);for(let n=0;n<r.length;n++)t.push(encodeURIComponent(r[n])+"="+encodeURIComponent(e[r[n]]));return t.join("&")},We="Authorization",He=/(?<=(?:\/|^):)[a-zA-Z0-9]{1,}(?=\/|$)/g,Ue=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{url:r,restParameters:n}=Ve(e,t);return Qe(e,((e,t)=>{const s={"Content-type":"application/json"},o=t?Object.assign(Object.assign({},s),{[We]:t}):s;return Je(((e,t,r)=>{const n={method:"GET",headers:t};return Ae(((e,t)=>{const r=e.split("?");if(r.length>2)throw new Error("invalid uri passed for buildQueryString");let n;n=2===r.length?Object.assign(Object.assign({},Ne(r[1])),t):Object.assign({},t);const s=Fe(n);return s?r[0]+"?"+s:r[0]})(e,r),n)})(e+r,o,n))}))},_e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{url:r,restParameters:n}=Ve(e,t);return Qe(e,((e,t)=>{const s={"Content-type":"application/json"},o=t?Object.assign(Object.assign({},s),{[We]:t}):s;return Je(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n={method:"POST",headers:t,body:JSON.stringify(r)};return Ae(e,n)}(e+r,o,n))}))},Qe=(e,t)=>({request:t,endpoint:e}),Je=e=>e.then((e=>e.json().catch((()=>{throw new Be})))),Ve=(e,t)=>{var r;const n=null!==(r=e.match(He))&&void 0!==r?r:[];n.forEach(((e,t,r)=>{if(r.indexOf(e)!==t)throw new Error("path has more than one parameter :".concat(e))}));const s=Object.assign({},t),o={};for(let e=0;e<n.length;e++){const t=n[e];if(!(t in s))throw new Error("path parameter value for :".concat(t," not found"));const r=s[t];if(delete s[t],"string"!=typeof r&&"number"!=typeof r)throw new Error("path parameter value for :".concat(t," has improper type (").concat(typeof r,")"));o[t]="string"==typeof r?r:r.toString()}return{url:e.split("/").map((e=>{for(let t=0;t<n.length;t++){const r=n[t];if(e===":".concat(r))return o[r]}return e})).join("/"),restParameters:s}},Xe={sort:{cursor:{limit:1e3},filter:{withPhoto:-1}}},$e=e=>{const t={};for(let r=0;r<e.length;r++)t[e[r]]=e[r];return Object.keys(t)},Ke=e=>{const t=e.reduce(((e,t)=>(e[t.vendorCode]=t,e)),{}),r=[],n=Object.keys(t);for(let e=0;e<n.length;e++)r.push(t[n[e]]);return r},Ye=(e,t)=>e(Object.assign(Object.assign({},(()=>{const{request:e,endpoint:t}=_e("/content/v1/cards/cursor/list",Xe);return{request:(t,r)=>e(t,r).then((e=>{if(e.error)throw e;return e})),endpoint:t,client:M.standard}})()),{title:"Получить карточки списком"})).then((e=>{const r=e.data.cards,n=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(e=>{const t=[];for(let r=0;r<e.length;r+=90){const n=e.slice(r,r+90);t.push(n)}return t})($e(t)).map((e=>(e=>Object.assign(Object.assign({},(e=>{const t={allowedCategoriesOnly:!1,vendorCodes:[...e]},{request:r,endpoint:n}=_e("/content/v1/cards/filter",t);return{request:(e,t)=>r(e,t),endpoint:n,client:M.standard}})(e)),{title:"Получить карточки по артикулам ".concat(e.join(", "))}))(e)))}(...r.map((e=>e.vendorCode)));return Promise.all([Promise.resolve(r),t(n)])})).then((e=>{let[t,r]=e;const n=r.reduce(((e,t)=>(e.push(...t.data),e)),[]);return{fromList:t,byVendorIds:Ke(n)}})),et=e=>{let{apiClientIsReady:t}=e;const{setCards:r,startOperation:s,setLastOperationError:a}=K(),{addTask:i,addTasks:l}=Ze("cards"),c=(0,o.useCallback)((()=>Ye(i,l)),[Ye,i,l]),d=(0,o.useCallback)((()=>{s(),c().then((e=>{r(e)})).catch((e=>{a(e),console.error(e)}))}),[r]),u=!t;return(0,n.jsx)(Y.Z,{onClick:d,disabled:u,children:"загрузить карточки"})};var tt=r(6628),rt=r(1796),nt=r(9062),st=r(6585),ot=r(4776),at=r(4680),it=r(6867);const lt=o.forwardRef(((e,t)=>(e=Object.assign(Object.assign({},e),{sx:Object.assign({overflow:"auto",display:"flex",flexWrap:"nowrap",position:"absolute",top:0,bottom:0,left:0,right:0},null==e?void 0:e.sx)}),(0,n.jsx)(y.Z,Object.assign({},e,{ref:t})))));lt.displayName="StretchedContainer";const ct=o.memo(lt),dt=()=>{const e=(0,o.useRef)(!1);return(0,o.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[e]),e},ut=(e,t)=>{const[r,n]=(0,o.useState)(e),s=(0,o.useCallback)((e=>{t.current&&n(e)}),[t,n]);return[r,s]},ht=e=>{let{children:t=null,open:r=!0,level:s=0,sx:o={}}=e;const a=dt(),[i,l]=ut(r?"auto":"hidden",a);return(0,n.jsx)(tt.Z,{in:r,appear:!1,onEntered:()=>{l("auto")},onExiting:()=>{l("hidden")},children:(0,n.jsx)(ct,{sx:Object.assign({zIndex:100+s,overflow:i,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:e=>(0,rt.Fq)(e.palette.background.default,.85),backdropFilter:"blur(5px)"},o),children:t})})},pt=o.memo(ht);var xt=r(594),mt=r(888);const ft=e=>{let{secondsLeft:t,operationStartDate:r,error:s,dismissError:a=(()=>{})}=e;const i=t>0,l=dt(),[c,d]=ut(0,l),[u,h]=ut(!1,l),[p,x]=ut(i,l),m=(0,o.useRef)(null),f=(0,o.useCallback)((()=>{m.current&&clearTimeout(m.current),m.current=setTimeout((()=>{x(!1),m.current=null}),3e3)}),[m,x]),g=(0,o.useCallback)((()=>{m.current&&(clearTimeout(m.current),m.current=null),x(!1)}),[m,x]),j=(0,o.useCallback)((()=>{a(),g()}),[a,m,x]);(0,o.useEffect)((()=>(i?x(!0):f(),()=>{m.current&&(clearTimeout(m.current),m.current=null)})),[i]);const v=(0,o.useMemo)((()=>{const e=new Date;return e.setSeconds(e.getSeconds()+t),e}),[t]);(0,o.useEffect)((()=>{if(t>0){const e=setInterval((()=>{const e=(new Date).getTime()-r.getTime();d(Math.round(e/1e3))}),1e3);return()=>{clearInterval(e)}}}),[t,r]);let b=Math.round((v.getTime()-(new Date).getTime())/1e3);b<0&&(b=0);const w=(0,o.useMemo)((()=>{const e=c/(c+b)*100;return e<0?0:e>100?100:e}),[c,b]),O=(0,o.useMemo)((()=>{if(b<100)return"".concat(b,"с");const e=b/60;if(e<99)return"".concat(Math.round(e),"м");const t=e/60;if(t<99)return"".concat(Math.round(t),"ч");const r=t/24;if(r<99)return"".concat(Math.round(r),"д");const n=r/7;if(r<365)return"".concat(Math.round(n),"н");const s=r/365;return"".concat(Math.round(s),"г")}),[b]),Z=null!==s;return(0,n.jsxs)(pt,{open:p||Z,sx:{overflow:"hidden"},children:[(0,n.jsx)(ct,{sx:{overflow:u?"hidden":"auto"},children:(0,n.jsx)(tt.Z,{in:!Z,children:(0,n.jsx)(C.Z,{sx:{display:"inline-flex",margin:"auto",position:"absolute",flexDirection:"column",left:0,right:0,top:0,bottom:0},children:(0,n.jsxs)(C.Z,{sx:{display:"inline-flex",margin:"auto",alignItems:"center",width:40,height:40,position:"relative"},children:[(0,n.jsx)(C.Z,{sx:{position:"absolute",width:"100%",height:"100%",border:e=>"5px solid ".concat((0,rt.Fq)(e.palette.primary.main,.15)),borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,n.jsx)(I.Z,{variant:"inherit",align:"center",sx:{fontSize:"0.8em"},children:"".concat(O)})}),(0,n.jsx)(nt.Z,{size:"100%",thickness:6,variant:"determinate",value:w}),(0,n.jsx)(st.Z,{in:0===t&&!Z,children:(0,n.jsx)(mt.Z,{color:"success",viewBox:"2 2 20 20",sx:{backgroundColor:e=>e.palette.background.default,borderRadius:"50%",position:"absolute",fontSize:40,zIndex:1}})})]})})})}),(0,n.jsx)(ct,{sx:{overflow:u?"auto":"hidden"},children:(0,n.jsx)(ot.Z,{in:Z,direction:"up",mountOnEnter:!0,onEntered:()=>{h(!0)},onExiting:()=>{h(!1)},appear:!1,children:(0,n.jsx)(C.Z,{sx:{margin:"auto",maxWidth:"80%"},children:(0,n.jsx)(at.Z,{children:(0,n.jsxs)(y.Z,{container:!0,sx:{flexWrap:"nowrap",alignItems:"center"},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",px:2,py:.5,alignItems:"center",flexGrow:1},children:(0,n.jsx)(I.Z,{variant:"inherit",color:"error",children:"Во время загрузки произошла ошибка. Данные могут быть не загружены или загружены частично."})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexShrink:0},children:(0,n.jsx)(it.Z,{onClick:j,children:(0,n.jsx)(xt.Z,{})})})]})})})})})]})},gt=D.reduce(((e,t)=>{let r=0;for(let e=0;e<100;e++)r+=pe[t]();return e[t]=Math.round(r/100),e}),{}),jt=(e,t)=>(0,o.useMemo)((()=>{const r=e.filter((e=>e.status===ie.pending));if(!r.some((e=>e.component===t)))return{secondsLeft:0};const n=D.map((e=>({clientType:e,tasks:r.filter((t=>t.client===e))}))).map((e=>{if(-1!==xe.indexOf(e.clientType))return{clientType:e.clientType,subQueues:[e.tasks]};const t=bt(e.tasks),r=Object.keys(t),n=[];for(let e=0;e<r.length;e++)n.push(t[r[e]]);return{clientType:e.clientType,subQueues:n}})).map((e=>{const r=e.subQueues.reduce(((e,r)=>{const n=vt(r,t);return n>e?n:e}),0);return{clientType:e.clientType,maxTasks:r}})),s=n.reduce(((e,t)=>{const r=t.maxTasks*gt[t.clientType];return r>e?r:e}),0);return{secondsLeft:Math.round(s/1e3)}}),[e,t,ie]),vt=(e,t)=>{const r=[...e];r.sort(me);for(let e=0;e<r.length;e++)if(r[e].component===t)return r.length-e;return 0},bt=e=>e.reduce(((e,t)=>(e[t.endpoint]||(e[t.endpoint]=[]),e[t.endpoint].push(t),e)),{}),wt=e=>{let{apiClientIsReady:t}=e;const{cards:r,lastOperationStartDate:s,lastOperationError:o,clearLastOperationError:a}=K(),{queue:i}=Ze("cards"),{secondsLeft:l}=jt(i,"cards");return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"row",position:"relative"},children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(P.Z,{label:"Карточек в списке",value:r.fromList.length})}),(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(P.Z,{label:"Карточек по коду поставщика",value:r.byVendorIds.length})}),(0,n.jsx)(y.Z,{sx:{flexGrow:1,display:"flex"},children:(0,n.jsx)(et,{apiClientIsReady:t})}),(0,n.jsx)(y.Z,{sx:{flexGrow:1,display:"flex"},children:(0,n.jsx)(ae,{cards:r})}),(0,n.jsx)(ft,{secondsLeft:l,operationStartDate:s,error:o,dismissError:a})]})},yt=()=>{const{standard:e}=F();return(0,n.jsx)(wt,{apiClientIsReady:e.ready})},Ot=o.memo(yt),It=[],Zt=new Date,kt={supplies:It,setSupplies:()=>{},lastOperationStartDate:Zt,startOperation:()=>{},lastOperationError:null,setLastOperationError:()=>{},clearLastOperationError:()=>{}},Ct=o.createContext(kt),Et=e=>{let{children:t}=e;const[r,s]=(0,o.useState)(Zt),[a,i]=(0,o.useState)(null),[l,c]=(0,o.useState)(It),d=(0,o.useMemo)((()=>({supplies:l,setSupplies:c,lastOperationStartDate:r,startOperation:()=>{i(null),s(new Date)},lastOperationError:a,setLastOperationError:e=>{i(e)},clearLastOperationError:()=>{i(null)}})),[l,c,r,s,a,i]);return(0,n.jsx)(Ct.Provider,{value:d,children:t})},St=o.memo(Et),Tt=()=>(0,o.useContext)(Ct),Pt=function(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0).then((r=>{const n=[...t,r];return 0!==r.next?Pt(e,r.next,n):Promise.resolve(n)}))},Dt=e=>{let{apiClientIsReady:t}=e;const{supplies:r,setSupplies:s,startOperation:a,setLastOperationError:i}=Tt(),{addTask:l}=Ze("supplies"),c=(0,o.useCallback)((function(){return l(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object.assign(Object.assign({},function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{request:t,endpoint:r}=Ue("/api/v3/supplies",{limit:String(1e3),next:e.toString()});return{request:(e,r)=>t(e,r),endpoint:r,client:M.standard}}(e)),{title:"Получить все поставки (next=".concat(e,")")})}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))}),[l]);return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1},children:[(0,n.jsx)(y.Z,{sx:{display:"flex"},children:(0,n.jsx)(P.Z,{label:"Загружено поставок",value:r.length})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(Y.Z,{onClick:()=>{a(),Pt(c).then((e=>{s(e.reduce(((e,t)=>(e.push(...t.supplies),e)),[]))})).catch((e=>{i(e),console.error(e)}))},disabled:!t,children:"Загрузить поставки"})})]})},Mt=e=>{const t=new Date(e);return"".concat(t.toLocaleTimeString()," ").concat(t.toLocaleDateString())},Lt=e=>{const t=e.reduce(((e,t)=>(e[t.toISOString()]=t,e)),{}),r=[],n=Object.keys(t);for(let e=0;e<n.length;e++)r.push(t[n[e]]);return r},qt=["признак отсутствует","обычная","СГТ (Содержит сверхгабаритные товары)","КГТ (Содержит крупногабаритные товары). Не используется на данный момент"],Gt={id:{name:"QR-код поставки",order:0},name:{name:"Наименование",order:10},createdAt:{name:"Дата создания",order:20,toPrintable:Mt,toExcel:Mt},closedAt:{name:"Дата закрытия",order:30,toPrintable:Mt,toExcel:Mt},scanDt:{name:"Дата сканирования ШК ТТН",order:40,toPrintable:Mt,toExcel:Mt},scanDtDate:{name:"Дата сканирования ШК ТТН",order:40,toPrintable:Mt,toExcel:e=>new Date(e),width:15},done:{name:"Завершена",order:50,toPrintable:e=>e?"ИСТИНА":"ЛОЖЬ",toExcel:e=>e?"ИСТИНА":"ЛОЖЬ"},cargoType:{name:"Тип поставки",order:60,toPrintable:e=>qt[e],toExcel:e=>qt[e]}},Rt=()=>{const{supplies:e}=Tt(),{setData:t}=se();return(0,n.jsx)(Y.Z,{onClick:()=>{const r=e.map((e=>Object.assign(Object.assign({},e),{scanDtDate:e.scanDt})));r.sort(((e,t)=>{const r=new Date(e.createdAt),n=new Date(t.createdAt);return r<n?-1:r>n?1:0})),t({filename:"Список поставок",headers:Gt,rows:r})},children:"в таблицу"})},Bt=()=>{const e=F(),{queue:t}=Ze("supplies"),{lastOperationStartDate:r,lastOperationError:s,clearLastOperationError:o}=Tt(),{secondsLeft:a}=jt(t,"supplies");return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{display:"flex",flexDirection:"column",flexGrow:1,position:"relative"},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(Dt,{apiClientIsReady:e.standard.ready})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(Rt,{})}),(0,n.jsx)(ft,{secondsLeft:a,operationStartDate:r,error:s,dismissError:o})]})},zt=o.memo(Bt),At="supplies",Nt={},Ft=new Date,Wt={supplies:Nt,setSupplies:()=>{},clearSupplies:()=>{},removeSupplies:()=>{},lastOperationStartDate:Ft,startOperation:()=>{},lastOperationError:null,setLastOperationError:()=>{},clearLastOperationError:()=>{}},Ht=o.createContext(Wt),Ut=e=>{let{children:t}=e;const[r,s]=(0,o.useState)(Ft),[a,i]=(0,o.useState)(null),[l,c]=(0,o.useState)((()=>{const e=localStorage.getItem(At);if(e)try{return JSON.parse(e)}catch(e){return Wt.supplies}return Wt.supplies})),d=(0,o.useCallback)((()=>{c(Nt)}),[c]),u=(0,o.useCallback)((e=>{c((t=>{const r=Object.assign({},t);let n=!1;for(let t=0;t<e.length;t++){const s=e[t];r[s]&&(delete r[s],n=!0)}return n?r:t}))}),[c]),h=(0,o.useCallback)((e=>{c((t=>{const r=Object.assign({},t);return e.forEach((e=>{r[e.id]=e})),r}))}),[c]),p=(0,o.useMemo)((()=>({supplies:l,setSupplies:h,clearSupplies:d,removeSupplies:u,lastOperationStartDate:r,startOperation:()=>{i(null),s(new Date)},lastOperationError:a,setLastOperationError:e=>{i(e)},clearLastOperationError:()=>{i(null)}})),[l,h,d,u,r,s,a,i]);return(0,o.useEffect)((()=>{localStorage.setItem(At,JSON.stringify(l))}),[l]),(0,n.jsx)(Ht.Provider,{value:p,children:t})},_t=o.memo(Ut),Qt=()=>(0,o.useContext)(Ht),Jt=e=>Object.assign(Object.assign({},(e=>{const{request:t,endpoint:r}=Ue("/api/v3/supplies/:supplyId",{supplyId:e});return{request:(e,r)=>t(e,r),endpoint:r,client:M.standard}})(e)),{title:"Загрузить данные поставки ".concat(e)}),Vt=e=>Object.assign(Object.assign({},(e=>{const{request:t,endpoint:r}=Ue("/api/v3/supplies/:supplyId/orders",{supplyId:e});return{request:(e,r)=>t(e,r),endpoint:r,client:M.standard}})(e)),{title:"Получить заказы по поствке ".concat(e)}),Xt=/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/,$t=(e,t)=>{const r=ue(),n=t.map((t=>{return e((n=t,Object.assign(Object.assign({},(e=>{const t=new Date(e.toISOString());t.setUTCHours(0,0,0,0);const r=t.toISOString().split("T")[0];if(!r.match(Xt))throw new Error("invalid date for order request");const{request:n,endpoint:s}=Ue("/api/v1/supplier/orders",{dateFrom:r,flag:"1"});return{request:(e,t)=>n(e,t),endpoint:s,client:M.statistics}})(n)),{title:"Получить заказы из статистики за ".concat(n.toISOString().split("T")[0])})),r).catch((e=>(console.error("не удалось загрузить заказы из статистики на дату ".concat(t.toISOString(),", причина:"),e),null)));var n}));return Promise.all(n).then((e=>e.reduce(((e,t)=>(null!==t&&e.push(...t),e)),[])))},Kt=(e,t,r)=>((e,t)=>{const r=$e(t);if(r.length<1)return Promise.resolve([]);const n=ue();return Promise.all($e(r).map((t=>((e,t,r)=>t?e([Jt(t),Vt(t)],r).then((e=>{let[t,r]=e;return Object.assign(Object.assign({},t),{orders:r.orders})})):Promise.reject(new Error("не передан id поставки")))(e,t,n).catch((e=>(console.error("не удалось загрузить поставку ".concat(t,", причина:"),e),null)))))).then((e=>e.filter((e=>null!==e))))})(t,r).then((t=>{if(t.length<1)throw new Error("ни одной поставки не загружено");const r=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.reduce(((e,t)=>{const r=t.orders.map((e=>e.createdAt)).map((e=>{const t=new Date(e);return t.setUTCHours(0,0,0,0),t})),n=Lt(r).reduce(((e,t)=>{const r=new Date(t.toISOString());r.setUTCDate(r.getUTCDate()-1);const n=new Date(t.toISOString());return n.setUTCDate(n.getUTCDate()+1),e.push(t),e.push(r),e.push(n),e}),[]);return e.push(...n),e}),[]);return Lt(n)}(...t).filter((e=>!isNaN(e.getTime())));if(r.length<1)throw new Error("ни одной даты заказа не получено");return Promise.all([Promise.resolve(t),$t(e,r)])})).then((e=>{let[t,r]=e;return t.reduce(((e,t)=>{const n=[];for(let s=0;s<t.orders.length;s++){const o=t.orders[s],a=r.filter((e=>e.srid===o.rid));if(a.length<1)return console.error("заказ из раздела статистики не неайден"),e;if(a.length>1)return console.error("соответствующих заказов из раздела статистики более одного:",a),e;const i=a[0];n.push({supply:o,statistics:i})}return e.push(Object.assign(Object.assign({},t),{orders:n})),e}),[])})),Yt=/(WB-GI-[0-9]{5,})/g,er=e=>{var t;return null!==(t=e.match(Yt))&&void 0!==t?t:[]},tr=e=>{let{apiClientIsReady:t,apiStatisticsClientIsReady:r}=e;const{setSupplies:s,startOperation:a,setLastOperationError:i}=Qt(),[l,c]=(0,o.useState)(""),d=(0,o.useMemo)((()=>$e(er(l))),[l,er]),u=!t||!r,{addTask:h,addTasks:p}=Ze("supply"),x=(0,o.useCallback)((e=>Kt(h,p,e)),[Kt,h,p]);return(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1},children:[(0,n.jsxs)(y.Z,{container:!0,sx:{flexGrow:1},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(P.Z,{label:"ID поставки",fullWidth:!0,multiline:!0,rows:1,value:l,onChange:e=>{c(e.target.value)},sx:{"& .MuiInputBase-multiline":{height:"100%",overflow:"auto","& textarea":{height:"100% !important",overflow:"visible !important"}}}})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(P.Z,{label:"ID поставки обработанные",fullWidth:!0,multiline:!0,rows:1,value:d.join("\r\n"),sx:{"& .MuiInputBase-multiline":{height:"100%",overflow:"auto","& textarea":{height:"100% !important",overflow:"visible !important"}}}})})]}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(Y.Z,{onClick:()=>{a(),x(d).then((e=>{s(e)})).catch((e=>{console.error(e),i(e)}))},disabled:u||d.length<1,children:"загрузить данные о поставке"})})]})},rr=()=>{const e=F(),{queue:t}=Ze("supplies"),{lastOperationStartDate:r,lastOperationError:s,clearLastOperationError:o}=Qt(),{secondsLeft:a}=jt(t,"supply");return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(tr,{apiClientIsReady:e.standard.ready,apiStatisticsClientIsReady:e.statistics.ready}),(0,n.jsx)(ft,{secondsLeft:a,operationStartDate:r,error:s,dismissError:o})]})},nr=o.memo(rr);var sr=r(2440),or=r(576),ar=r(8619),ir=r(8885),lr=r(2887),cr=r(9334),dr=r(4295),ur=r.n(dr);const hr=/^[^./\\]{1,}$/,pr=/^[^./\\]{1,}\.xlsx$/i,xr=e=>{const t=[],r=Object.keys(e);for(let n=0;n<r.length;n++)t.push(Object.assign({id:r[n]},e[r[n]]));return t.sort(((e,t)=>{var r,n,s,o;const a=null!==(r=e.order)&&void 0!==r?r:0,i=null!==(n=t.order)&&void 0!==n?n:0;return null!==(s=null!=a?a:0<i)&&void 0!==s&&s?1:null!==(o=null!=a?a:0>i)&&void 0!==o&&o||e.name<t.name?-1:t.name<e.name?1:0})),t.map((e=>e.id))},mr=e=>{var t;const{filename:r="без_имени",headers:n,rows:s}=e,o=xr(n),a=new(ur().Workbook),i=a.addWorksheet("Лист 1"),l={style:"thin",color:"black"};i.columns=o.map((e=>({key:e,header:n[e].name,width:-1}))),i.getRow(1).eachCell((e=>{e.style={border:{top:l,left:l,right:l,bottom:l},alignment:{vertical:"middle",horizontal:"center",wrapText:!0},font:{bold:!0}}})),i.addRows(s.map((e=>{const t={};for(let r=0;r<o.length;r++){const s=o[r],a=n[s];t[s]=a.toExcel?a.toExcel(e[s]):e[s]}return t})));const c={};for(let e=0;e<o.length;e++)c[o[e]]=null!==(t=n[o[e]].width)&&void 0!==t?t:"auto";return vr(i,c),((e,t)=>{let r=t;return r.match(hr)||r.match(pr)||(r="invalid_file_name"),r.match(hr)&&(r+=".xlsx"),e.writeBuffer().then((e=>{const t=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=document.createElement("a");return n.href=URL.createObjectURL(t),n.download=r,n.click(),URL.revokeObjectURL(n.href),!0}))})(a.xlsx,r)},fr=mr,gr=new le((()=>1e3)),jr=e=>gr.addTask((()=>mr(e)),ue()),vr=(e,t)=>{e.columns.forEach((e=>{const r=t[e.key];if("auto"!==r)return void(e.width=r);const n=e.values.map((e=>e.toString().length)),s=Math.max(...n.filter((e=>"number"==typeof e)));e.width=s+6}))},br=new Error("exporter is not ready"),wr={exportNow:()=>Promise.reject(br),exportEnqueue:()=>Promise.reject(br)},yr=o.createContext(wr),Or=e=>{let{children:t}=e;const r=(0,o.useMemo)((()=>({exportNow:fr,exportEnqueue:jr})),[fr,jr]);return(0,n.jsx)(yr.Provider,{value:r,children:t})},Ir=o.memo(Or),Zr=()=>(0,o.useContext)(yr),kr={orderId:{name:"№ задания",order:0,toPrintable:e=>String(e)},supplyId:{name:"QR-код поставки",order:10},sticker:{name:"Стикер",order:15},supplyName:{name:"Название поставки",order:20},orderDate:{name:"Дата создания",order:30,toPrintable:Mt,toExcel:Mt},supplyBarcodeScanDate:{name:"Дата сканирования ШК ТТН",order:40,toPrintable:Mt,toExcel:Mt},name:{name:"Наименование",order:50},sizeTech:{name:"Размер",order:60},color:{name:"Цает",order:70},price:{name:"Стоимость",order:72,toPrintable:e=>(e/100).toFixed(2),toExcel:e=>Number((e/100).toFixed(2))},currency:{name:"Валюта",order:74,toPrintable:e=>643===e?"₽":"?",toExcel:e=>643===e?"₽":"?"},wbId:{name:"Артикул Wildberries",order:80,toPrintable:e=>String(e)},supplierId:{name:"Артикул продавца",order:90},srid:{name:"Srid",order:100}},Cr=()=>{const{supplies:e,removeSupplies:t}=Qt(),{exportEnqueue:r}=Zr(),s=(0,o.useMemo)((()=>{const t=Object.keys(e);return t.sort(),t}),[e]),{setData:a}=se(),{cards:i}=K(),[l,c]=o.useState([]),d=(0,o.useMemo)((()=>l.map((t=>e[t]))),[e,l]),u=(0,o.useCallback)((e=>()=>{c((t=>{const r=t.indexOf(e),n=[...t];return-1===r?n.push(e):n.splice(r,1),n}))}),[]),h=(0,o.useMemo)((()=>s.length>0&&s.every((e=>l.indexOf(e)>-1))),[s,l]);return(0,o.useEffect)((()=>{c((e=>e.filter((e=>s.indexOf(e)>-1))))}),[s]),(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1,flexWrap:"nowrap"},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1,height:"auto",maxHeight:"10rem"},children:(0,n.jsx)(at.Z,{variant:"outlined",sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:(0,n.jsxs)(sr.Z,{sx:{width:"100%",height:"100%",overflow:"auto",position:"relative",pt:0},children:[(0,n.jsx)(or.ZP,{disablePadding:!0,sx:{position:"sticky",top:0,zIndex:1,bgcolor:"background.paper",py:.5,borderBottom:e=>"1px solid ".concat(e.palette.divider)},secondaryAction:(0,n.jsx)(it.Z,{edge:"end",disabled:l.length<1,color:"error",onClick:()=>{t(l)},children:(0,n.jsx)(xt.Z,{})}),children:(0,n.jsxs)(ar.Z,{role:void 0,onClick:()=>{c(h?[]:s)},dense:!0,sx:{py:.5,my:-.5},children:[(0,n.jsx)(ir.Z,{children:(0,n.jsx)(lr.Z,{edge:"start",checked:h,disabled:s.length<1,indeterminate:l.length>0&&!h,tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":"all"},sx:{py:0}})}),(0,n.jsx)(cr.Z,{id:"all",primary:"Все"})]})}),s.map((e=>{const t="checkbox-list-label-".concat(e);return(0,n.jsx)(or.ZP,{disablePadding:!0,children:(0,n.jsxs)(ar.Z,{role:void 0,onClick:u(e),dense:!0,sx:{py:0},children:[(0,n.jsx)(ir.Z,{children:(0,n.jsx)(lr.Z,{edge:"start",checked:-1!==l.indexOf(e),tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":t},sx:{py:0}})}),(0,n.jsx)(cr.Z,{id:t,primary:e})]})},e)}))]})})}),(0,n.jsxs)(y.Z,{container:!0,children:[(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(Y.Z,{disabled:l.length<1,onClick:()=>{let e;1===d.length&&(e="Данные о поставке ".concat(d[0].id)),d.length>1&&(e="Данные о поставках ".concat(d.map((e=>e.id)).join(","))),a({filename:e,headers:kr,rows:Er(d,i)})},children:"в таблицу"})}),(0,n.jsx)(y.Z,{sx:{flexGrow:1},children:(0,n.jsx)(Y.Z,{disabled:l.length<1,onClick:()=>{d.forEach((e=>{r({filename:"Данные о поставке ".concat(e.id),headers:kr,rows:Er([e],i)}).catch((e=>{console.error(e)}))}))},children:"экспорт по файлам"})})]})]})},Er=(e,t)=>{const r=e.reduce(((e,r)=>(e.push(...r.orders.map((e=>{const n=t.fromList.filter((t=>t.nmID===e.supply.nmId));if(1!==n.length)throw console.error(n),new Error("error getting card from list: supplierId: ".concat(e.supply.article,", wbId: ").concat(e.supply.nmId));const s=n[0],o=t.byVendorIds.filter((t=>t.nmID===e.supply.nmId));if(1!==o.length)throw console.error(o),new Error("error getting card by vendor id: supplierId: ".concat(e.supply.article,", wbId: ").concat(e.supply.nmId));const a=o[0],i=s.sizes.filter((t=>t.chrtID===e.supply.chrtId));if(1!==i.length)throw console.error(i),new Error("error getting size of card from list: supplierId: ".concat(e.supply.article,", wbId: ").concat(e.supply.nmId,", chrtId: ").concat(e.supply.chrtId));const l=i[0],c=a.sizes.filter((t=>t.chrtID===e.supply.chrtId));if(1!==c.length)throw console.error(c),new Error("error getting size of card from list: supplierId: ".concat(e.supply.article,", wbId: ").concat(e.supply.nmId,", chrtId: ").concat(e.supply.chrtId));const d=a.characteristics.filter((e=>"Наименование"in e)),u=d[0]?d[0]["Наименование"]:"",h=a.characteristics.filter((e=>"Цвет"in e)),p=h[0]?h[0]["Цвет"].join(", "):"";return{supplyId:r.id,supplyName:r.name,supplyBarcodeScanDate:r.scanDt,orderDate:e.supply.createdAt,orderId:e.supply.id,price:e.supply.convertedPrice,currency:e.supply.convertedCurrencyCode,supplierId:e.supply.article,wbId:e.supply.nmId,name:u,color:p,sizeTech:l.techSize,sticker:e.statistics.sticker,srid:e.statistics.srid}}))),e)),[]);return r.sort(((e,t)=>e.supplyId<t.supplyId?-1:e.supplyId>t.supplyId||e.orderId<t.orderId?1:e.orderId>t.orderId?-1:0)),r},Sr=()=>(0,n.jsxs)(y.Z,{container:!0,spacing:2,children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(zt,{})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1,position:"relative"},children:(0,n.jsx)(nr,{})}),(0,n.jsx)(y.Z,{sx:{display:"flex",flexGrow:1},children:(0,n.jsx)(Cr,{})})]}),Tr=()=>(0,n.jsx)(Sr,{}),Pr=o.memo(Tr);var Dr=r(7896),Mr=r(9573),Lr=r(6011),qr=r(3694),Gr=r(6926),Rr=r(8732),Br=r(3863),zr=r(268);const Ar=[{label:"25",value:25},{label:"100",value:100},{label:"250",value:250},{label:"Все",value:-1}],Nr=e=>{let{data:t,orderedColumnIds:r}=e;const[s,a]=o.useState(0),[i,l]=o.useState(25),c=(0,o.useCallback)(((e,t)=>{a(t-1)}),[a]),d=(0,o.useCallback)((e=>{l(+e.target.value),a(0)}),[l,a]),{headers:u,rows:h}=t;(0,o.useEffect)((()=>{a(0)}),[t]);const p=-1===i?h.length:i,x=Math.ceil(h.length/p),m=x>0?x-1:0,f=s>m?m:s,g=f+1;return(0,n.jsxs)(y.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1,width:"100%"},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%"},children:(0,n.jsx)(at.Z,{variant:"outlined",sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:(0,n.jsx)(Dr.Z,{sx:{flexGrow:1,flexShrink:1,flexBasis:"10rem",height:"100%",width:"100%",position:"relative"},children:(0,n.jsxs)(Mr.Z,{stickyHeader:!0,size:"small",sx:{width:"100%"},children:[(0,n.jsx)(Lr.Z,{children:(0,n.jsxs)(qr.Z,{children:[(0,n.jsx)(Gr.Z,{align:"right",children:"№"}),r.map((e=>(0,n.jsx)(Gr.Z,{align:u[e].align,children:u[e].name},e)))]})}),(0,n.jsx)(Rr.Z,{children:h.slice(f*p,f*p+p).map(((e,t)=>(0,n.jsxs)(qr.Z,{hover:!0,children:[(0,n.jsx)(Gr.Z,{align:"right",children:t+f*p+1}),r.map((r=>{const s=u[r],o=s.toPrintable?s.toPrintable(e[r]):e[r];return(0,n.jsx)(Gr.Z,{align:s.align,children:o},String(t)+r)}))]},t)))})]})})})}),(0,n.jsx)(y.Z,{sx:{flexGrow:0,width:"100%"},children:(0,n.jsx)(Br.Z,{rowsPerPageOptions:Ar,component:"div",count:h.length,rowsPerPage:i,page:f,onPageChange:c,onRowsPerPageChange:d,labelRowsPerPage:"Показывать:",labelDisplayedRows:e=>{let{from:t,to:r,count:n}=e;return"".concat(t," - ").concat(r," из ").concat(-1!==n?n:">".concat(r))},ActionsComponent:e=>{const{page:t,count:r,rowsPerPage:s,showLastButton:o,getItemAriaLabel:a,showFirstButton:i,onPageChange:l}=e;return(0,fe._T)(e,["page","count","rowsPerPage","showLastButton","getItemAriaLabel","showFirstButton","onPageChange"]),(0,n.jsx)(zr.Z,{siblingCount:2,boundaryCount:1,count:x,page:g,onChange:c,sx:{"& ul":{display:"flex",flexWrap:"nowrap"}}})}})})]})},Fr=e=>{let{data:t}=e;const{exportEnqueue:r}=Zr();return(0,n.jsx)(Y.Z,{onClick:()=>{r(t)},children:"выгрузить в excel"})},Wr=e=>{let{data:t}=e;const{headers:r}=t,s=(0,o.useMemo)((()=>xr(r)),[r]);return(0,n.jsxs)(y.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1},children:[(0,n.jsx)(y.Z,{container:!0,sx:{flexDirection:"column",flexGrow:1,width:"100%"},children:(0,n.jsx)(Nr,{data:t,orderedColumnIds:s})}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(Fr,{data:t})})]})},Hr=()=>{const{data:e}=se();return(0,n.jsx)(Wr,{data:e})},Ur=()=>(0,n.jsxs)(y.Z,{container:!0,spacing:2,sx:{flexDirection:"column",flexGrow:1},children:[(0,n.jsx)(y.Z,{sx:{display:"flex",flexDirection:"column"},children:(0,n.jsx)(w.j3,{})}),(0,n.jsx)(y.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:"100%"},children:(0,n.jsx)(Hr,{})})]}),_r=o.memo(Ur);var Qr=r(3718);const Jr=e=>{let{text:t}=e;const r=dt(),[s,a]=ut(!1,r),i=(0,o.useRef)(null),l=(0,o.useMemo)((()=>t.length>150?t.substring(0,150)+"...":t),[t]);return t.length<=150?(0,n.jsx)(n.Fragment,{children:t}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Qr.Z,{open:s,placement:"bottom",anchorEl:i.current,disablePortal:!0,modifiers:[{name:"flip",enabled:!1,options:{altBoundary:!0,rootBoundary:"document",padding:8}},{name:"preventOverflow",enabled:!0,options:{altAxis:!0,altBoundary:!0,tether:!1,rootBoundary:"document",padding:8}}],sx:{zIndex:10,width:"600px",minWidth:"50%",maxWidth:"80%",height:"250px",maxHeight:"80%",minHeight:"10%"},onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)},children:(0,n.jsx)(at.Z,{sx:{p:2,width:"100%",height:"100%"},children:(0,n.jsx)(P.Z,{multiline:!0,rows:1,fullWidth:!0,value:t,sx:{height:"100%","& .MuiInputBase-multiline":{height:"100%",overflow:"auto","& textarea":{height:"100% !important",overflow:"visible !important"}}}})})}),(0,n.jsx)(C.Z,{ref:i,sx:{mx:-2,my:-.75,px:2,py:.75},onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)},children:l})]})},Vr=o.memo(Jr);var Xr=r(9572);const $r={[ie.pending]:(0,n.jsx)(nt.Z,{size:"1.2rem"}),[ie.done]:(0,n.jsx)(mt.Z,{color:"success"}),[ie.error]:(0,n.jsx)(Xr.Z,{color:"error"})},Kr=e=>{let{status:t}=e;return(0,n.jsx)(C.Z,{sx:{display:"flex",flexDirection:"column",minHeight:"1.5rem",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},children:(0,n.jsx)(C.Z,{sx:{height:"1.5rem",width:"1.5rem",display:"flex",justifyContent:"center",alignItems:"center"},children:$r[t]})})},Yr=o.memo(Kr),en={[M.standard]:"стандартное",[M.statistics]:"статистика"},tn={created:{order:0,name:"Дата создания",align:"center",width:15,toPrintable:e=>e.toLocaleString()},status:{order:10,name:"Статус",align:"center",toPrintable:e=>(0,n.jsx)(Yr,{status:e})},statusDate:{order:20,name:"Дата статуса",align:"center",width:15,toPrintable:e=>e.toLocaleString()},title:{order:30,name:"Задача",width:50,toPrintable:e=>(0,n.jsx)(Vr,{text:e})},component:{order:40,name:"Запрошено компонентом",align:"center",toPrintable:e=>null!=e?e:""},client:{order:50,name:"Тип API",align:"center",toPrintable:e=>en[e],toExcel:e=>en[e]},endpoint:{order:60,name:"URL"}},rn=()=>{const{queue:e}=Ze("apiStatus"),t=(0,o.useMemo)((()=>{const t=[...e];return t.sort(me),t}),[e]),r=(0,o.useMemo)((()=>({filename:"apiTasks",headers:tn,rows:t})),[t,tn]);return(0,n.jsx)(Wr,{data:r})},nn=o.memo(rn),sn=()=>(0,n.jsx)(nn,{}),on=o.memo(sn),an=[{path:"/",Component:S,ErrorBoundary:T,children:[{ErrorBoundary:T,children:[{index:!0,element:(0,n.jsx)(w.Fg,{to:"/supply"})},{Component:_r,children:[{name:"Карточки",order:2,path:"cards",Component:Ot},{name:"Поставки",order:1,path:"supply",Component:Pr}]},{path:"api",children:[{name:"Настройки",order:998,path:"config",Component:U},{name:"Статус",order:999,path:"status",Component:on}]},{path:"*",Component:()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.Z,{variant:"inherit",children:"Такой страницы не существует"}),(0,n.jsx)(b.OL,{to:"/",children:(0,n.jsx)(I.Z,{variant:"inherit",children:"На главную"})})]})}]}]}],ln=Object.keys({caseSensitive:"caseSensitive",path:"path",id:"id",loader:"loader",action:"action",hasErrorBoundary:"hasErrorBoundary",shouldRevalidate:"shouldRevalidate",handle:"handle",index:"index",children:"children",element:"element",errorElement:"errorElement",Component:"Component",ErrorBoundary:"ErrorBoundary",lazy:"lazy"}),cn=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.reduce(((e,r)=>{var n;const s=null!==(n=r.path)&&void 0!==n?n:"",o="/"===s.substring(0,1)?s:"/"===t.substring(t.length-1)?t+s:t+"/"+s,a=Object.keys(r),i={};let l=!1;for(let e=0;e<a.length;e++)ln.indexOf(a[e])<0&&(i[a[e]]=r[a[e]],l=!0);if(l&&(i.path=o,e.push(i)),r.children){const t=cn(r.children,o);t.length&&e.push(...t)}return e}),[])},dn=e=>{var t;const r={};for(let n=0;n<e.length;n++){const s=null!==(t=e[n].menuId)&&void 0!==t?t:e[n].path;if(r[s])throw new Error('duplicate menu item id "'+s+'" found!');r[s]=e[n]}for(const e in r){if(!Object.hasOwn(r,e))continue;const t=r[e].parentId;if(t){if(t==e)throw new Error('circular reference id to parent id "'+t+'" found in menu');if(!r[t])throw new Error('no parent id "'+t+'" found in menu');const n=r[t];n.children||(n.children=[]),n.children.push(r[e])}}const n=[];for(const e in r)Object.hasOwn(r,e)&&(r[e].parentId||n.push(r[e]));return n},un=e=>e.map((e=>{const{parentId:t,children:r,menuId:n}=e,s=(0,fe._T)(e,["parentId","children","menuId"]);return void 0!==n&&(s.id=n),e.children&&(s.children=un(e.children)),s})),hn=e=>{const t=e.toSorted(pn);for(let e=0;e<t.length;e++)t[e].children&&(t[e].children=hn(t[e].children));return t},pn=(e,t)=>{var r,n;const s=null!==(r=e.order)&&void 0!==r?r:0,o=null!==(n=t.order)&&void 0!==n?n:0;return s>o?1:o>s?-1:e.id>t.id?1:t.id>e.id?-1:e.name>t.name?1:t.name>e.name?-1:0},xn=e=>e.map((e=>{const t={};for(let r=0;r<ln.length;r++){const n=ln[r];n in e&&(t[n]=e[n])}return"children"in e&&(t.children=xn(e.children)),t})),mn=xn,fn=o.createContext([]),gn=o.createContext([]),jn=mn(an),vn=(e=>{const t=cn(e),r=dn(t),n=un(r);return hn(n)})(an),bn=(0,b.cP)(jn),wn=()=>(0,n.jsx)(fn.Provider,{value:jn,children:(0,n.jsx)(gn.Provider,{value:vn,children:(0,n.jsx)(b.pG,{router:bn})})}),yn=()=>(0,o.useContext)(gn);var On=r(9164),In=r(6720),Zn=r(9617);const kn=function(){const e="#9398f2",t={palette:{mode:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light",primary:{main:e,contrastText:"#fff"},text:{primary:(0,rt._j)(e,.15),secondary:(0,rt._j)(e,.3),disabled:(0,rt.Fq)(e,.5)},divider:(0,rt.Fq)(e,.5),action:{hover:(0,rt.Fq)(e,.15)}}},r=(0,Zn.Z)(t),n={components:{MuiButton:{defaultProps:{variant:"contained",size:"small",fullWidth:!0}},MuiTextField:{defaultProps:{variant:"outlined",size:"small",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{notchedOutline:{borderColor:r.palette.divider}}},MuiPaper:{defaultProps:{elevation:5}},MuiTablePagination:{styleOverrides:{toolbar:{display:"flex",flexWrap:"wrap",justifyContent:"end"}}}}};return(0,Zn.Z)(r,n)}(),Cn=e=>{let{children:t=null}=e;return(0,n.jsxs)(On.Z,{theme:kn,children:[(0,n.jsx)(In.ZP,{}),t]})},En=e=>{let{children:t=null}=e;return(0,n.jsx)(Ir,{children:(0,n.jsx)(N,{children:(0,n.jsx)(ne,{children:(0,n.jsx)($,{children:(0,n.jsx)(_t,{children:(0,n.jsx)(St,{children:(0,n.jsx)(Ie,{children:t})})})})})})})},Sn=o.memo(En);(0,s.s)(document.getElementById("root")).render((0,n.jsx)(o.StrictMode,{children:(0,n.jsx)((()=>(0,n.jsx)(Cn,{children:(0,n.jsx)(Sn,{children:(0,n.jsx)(wn,{})})})),{})}))},1424:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(8081),s=r.n(n),o=r(3645),a=r.n(o)()(s());a.push([e.id,"* {\n    box-sizing: border-box;\n}\n\nhtml, body {\n    height: 100%;\n    width: 100%;\n    padding: 0;\n    margin: 0;\n}\n\ndiv#root {\n    min-height: 100%;\n    height: auto;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    overflow: auto;\n}\n\nbody {\n    -webkit-user-select: none;\n    -moz-user-select: -moz-none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n}\n\ninput,\ntextarea,\nli *,\ntable {\n    -moz-user-select: text;\n    user-select: text;\n}\n",""]);const i=a}},e=>{e.O(0,[514,992],(()=>(7120,e(e.s=7120)))),e.O()}]);